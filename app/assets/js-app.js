node.require("fs"),node.require("nedb"),node.require("path"),node.require("mkdirp"),_g.animate_duration_delay=320,_g.execPath=node.path.dirname(process.execPath),_g.inputIndex=0,_g.lang="zh_cn",_g.path={db:process.cwd()+"/data/",pics:{ships:process.cwd()+"/pics/ships/",items:process.cwd()+"/pics/items/"},illustrations:{ships:_g.execPath+"/illust/ships/",items:_g.execPath+"/illust/items/"}},_g.pathMakeObj=function(a){for(var e in a)"object"==typeof a[e]?_g.pathMakeObj(a[e]):node.mkdirp.sync(a[e])},_g.pathMakeObj(_g.path),_g.data={entities:{},items:{},item_types:{},ships:{},ship_id_by_type:[],ship_types:{},ship_classes:{}};var _db={entities:new node.nedb({filename:_g.path.db+"/entities.json"}),items:new node.nedb({filename:_g.path.db+"/items.json"}),item_types:new node.nedb({filename:_g.path.db+"/item_types.json"}),item_type_collections:new node.nedb({filename:_g.path.db+"/item_type_collections.json"}),ships:new node.nedb({filename:_g.path.db+"/ships.json"}),ship_types:new node.nedb({filename:_g.path.db+"/ship_types.json"}),ship_type_collections:new node.nedb({filename:_g.path.db+"/ship_type_collections.json"}),ship_type_order:new node.nedb({filename:_g.path.db+"/ship_type_order.json"}),ship_classes:new node.nedb({filename:_g.path.db+"/ship_classes.json"}),ship_series:new node.nedb({filename:_g.path.db+"/ship_series.json"}),ship_namesuffix:new node.nedb({filename:_g.path.db+"/ship_namesuffix.json"})};_g.ship_type_order=[],_g.ship_type_order_map={},_g.statSpeed={5:"低速",10:"高速"},_g.statRange={1:"短",2:"中",3:"长",4:"超长"},_g.getStatSpeed=function(a){return a=parseInt(a),_g.statSpeed[a]},_g.getStatRange=function(a){return a=parseInt(a),_g.statRange[a]},_g.getName=function(a,e){return e=e||"",a?(a[_g.lang]||a.ja_jp)+(a.suffix?e+(_g.data.ship_namesuffix[a.suffix][_g.lang]||_g.data.ship_namesuffix[a.suffix].ja_jp):""):null},_frame.app_main={page:{},page_dom:{},bgimg_dir:"./app/assets/images/homebg",bgimgs:[],loading:["dbs","bgimgs","db_namesuffix"],loaded:function(a,e){_frame.app_main.loading.splice(_frame.app_main.loading.indexOf(a),1),_frame.app_main.loading.length||_frame.app_main.is_loaded||(setTimeout(function(){_frame.app_main.is_loaded&&_frame.dom.layout.addClass("ready")},e?300:1e3),$window.on("hashchange.pagechange",function(){_frame.app_main.load_page_func(_g.uriHash("page"))}),_frame.app_main.load_page_func(_g.uriHash("page")),_frame.app_main.is_loaded=!0)},change_bgimg:function(a){function e(a){setTimeout(function(){a.remove()},_g.animate_duration_delay)}if(!_frame.app_main.bgimgs.length)return!1;var t=a&&a.length?a:_frame.app_main.bgimgs,s=t[_g.randInt(t.length)],i=_frame.app_main.cur_bgimg_el?_frame.app_main.cur_bgimg_el.css("background-image"):null;for(i=i?i.split("/"):null,i=i?i[i.length-1].split(")"):null,i=i?i[0]:null;s==i;)s=t[_g.randInt(t.length-1)];var n="."+_frame.app_main.bgimg_dir+"/blured/"+s;s="."+_frame.app_main.bgimg_dir+"/"+s,i&&e(_frame.app_main.cur_bgimg_el),_frame.app_main.cur_bgimg_el=$("<div/>").css("background-image","url("+s+")").appendTo(_frame.dom.bgimg).add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.nav)).add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.main)),_frame.app_main.change_bgimg_fadein=!0},toggle_hidecontent:function(){_frame.dom.layout.toggleClass("hidecontent")},load_page:function(a){_g.uriHash("page",a)},load_page_func:function(a){return _frame.app_main.cur_page!=a&&a?(_frame.app_main.page_dom[a]||(_frame.app_main.page_dom[a]=$('<div class="page" page="'+a+'"/>').appendTo(_frame.dom.main),node.fs.readFile("./app/page/"+a+".html","utf8",function(e,t){if(e)throw e;_frame.app_main.page_dom[a].html(t),_frame.app_main.page[a]&&_frame.app_main.page[a].init&&_frame.app_main.page[a].init(_frame.app_main.page_dom[a]),_p.initDOM(_frame.app_main.page_dom[a])})),_frame.app_main.page_dom[a].removeClass("off"),_frame.app_main.cur_page&&(_frame.dom.navs[_frame.app_main.cur_page].removeClass("on"),_frame.app_main.page_dom[_frame.app_main.cur_page].addClass("off")),_frame.dom.navs[a].addClass("on"),_frame.dom.layout.hasClass("ready")&&_frame.app_main.change_bgimg(),void(_frame.app_main.cur_page=a)):a},init:function(){function a(a){return $("<button />").on("click",function(){_frame.app_main.load_page(a)})}function e(){function a(){i.length?setTimeout(function(){e()},50):setTimeout(function(){_frame.app_main.loaded("dbs")},500)}var t=i[0];i.shift(),_db[t].loadDatabase(function(e){function s(){for(var a in _g.ship_type_order){var e=parseInt(a);if("object"==typeof _g.ship_type_order[a])for(var t in _g.ship_type_order[a])_g.ship_type_order_map[_g.ship_type_order[a][t]]=e;else _g.ship_type_order_map[_g.ship_type_order[a]]=e}}if(e);else switch(t){case"entities":case"items":case"item_types":case"ship_classes":case"ship_types":_db[t].find({},function(e,s){for(var i in s)_g.data[t][s[i].id]=s[i];a()});break;case"ship_namesuffix":_db.ship_namesuffix.find({}).sort({id:1}).exec(function(e,t){_g.data.ship_namesuffix=[{}].concat(t),_frame.app_main.loaded("db_namesuffix"),a()});break;case"ship_type_order":_db.ship_type_order.find({}).sort({id:1}).exec(function(e,t){for(var i in t)_g.ship_type_order.push(t[i].types.length>1?t[i].types:t[i].types[0]);s(),_db.ships.find({}).sort({type:1,"class":1,class_no:1,time_created:1,"name.suffix":1}).exec(function(e,t){for(var s in t)_g.data.ships[t[s].id]=t[s],"undefined"==typeof _g.data.ship_id_by_type[_g.ship_type_order_map[t[s].type]]&&(_g.data.ship_id_by_type[_g.ship_type_order_map[t[s].type]]=[]),_g.data.ship_id_by_type[_g.ship_type_order_map[t[s].type]].push(t[s].id);a()})});break;default:a()}})}if(_frame.app_main.is_init)return!0;if(_frame.dom.nav=$("<nav/>").appendTo(_frame.dom.layout),_frame.dom.logo=$('<button class="logo" />').on({"animationend, webkitAnimationEnd":function(){$(this).addClass("ready-animated")}}).appendTo(_frame.dom.nav),_frame.dom.navlinks=$("<div/>").appendTo(_frame.dom.nav),_frame.dom.main=$("<main/>").appendTo(_frame.dom.layout),_frame.dom.bgimg=$('<div class="bgimg" />').appendTo(_frame.dom.layout),_frame.app_main.nav&&_frame.app_main.nav.length){_frame.dom.navs={};for(var t in _frame.app_main.nav){var s=_frame.app_main.nav[t];_frame.dom.navs[s.page]=a(s.page).html(s.title).appendTo(_frame.dom.navlinks),0!=t||_g.uriHash("page")||_frame.dom.navs[s.page].trigger("click")}}node.fs.readdir(_frame.app_main.bgimg_dir,function(a,e){var t=_config.get("bgimgs"),s=[];t=t?t.split(","):[];for(var i in e){var n=node.fs.lstatSync(_frame.app_main.bgimg_dir+"/"+e[i]);if(!n.isDirectory())if(_frame.app_main.bgimgs.push(e[i]),t.length)$.inArray(e[i],t)<0&&s.push(e[i]);else{var p=parseInt(n.mtime.valueOf());s.length?p>s[1]&&(s=[e[i],p]):s=[e[i],p]}}t.length||s.pop(),_config.set("bgimgs",_frame.app_main.bgimgs),_frame.app_main.change_bgimg(s),_frame.app_main.loaded("bgimgs")});var i=[];for(var t in _db)i.push(t);e(),_frame.app_main.is_init=!0}},_frame.app_main.page.ships={},_frame.app_main.page.ships.init=function(){},_frame.infos={show:function(a,e){switch(_frame.infos.dom||(_frame.infos.dom={nav:$('<div class="infos"/>').appendTo(_frame.dom.nav),main:$('<div class="page infos"/>').appendTo(_frame.dom.main)},_frame.infos.dom.back=$('<button class="back" icon="arrow-left"/>').html("返回").on("click",function(){_frame.infos.hide()}).appendTo(_frame.infos.dom.nav)),_frame.dom.layout.addClass("infos-show"),a){case"__ship__":a=_frame.infos.__ship(e)}var t=a.append?a[0].outerHTML.hashCode():a.hashCode();_frame.infos.curContent!=t&&(_frame.infos.dom.main.empty(),a.append?a.appendTo(_frame.infos.dom.main):_frame.infos.dom.main.html(a),_p.initDOM(_frame.infos.dom.main),_frame.infos.curContent=t),setTimeout(function(){_frame.dom.layout.addClass("infos-on")},1)},hide:function(){_frame.dom.layout.removeClass("infos-on"),_frame.dom.navlinks.children("button:last-of-type").on("transitionend",function(a){a.currentTarget==a.target&&"top"==a.originalEvent.propertyName&&0==parseInt($(this).css("top"))&&_frame.dom.layout.removeClass("infos-show")})}},_frame.infos.init=function(){return _frame.infos.is_init?!0:($body.on("click._infos","[data-infos]",function(a){if("input"!=a.target.tagName.toLowerCase()||"compare"!=a.target.className){var e=$(this);_frame.infos.show(e.attr("data-infos"),e)}}),_frame.infos.is_init=!0,!0)},_frame.infos.__ship=function(a){function e(a,e){return e||0!=a&&"0"!=a?-1==a||"-1"==a?'<small class="zero">?</small>':a:'<small class="zero">-</small>'}function t(a,e,t,s){$("<span/>").html('<small class="stat-'+a+'">'+e+"</small><em>"+t+"</em>").appendTo(s)}function s(a,e){if(!b.stat[a])return"";switch(a){case"range":return"<span>射程: "+_g.getStatRange(b.stat[a])+"</span>";default:var t=parseInt(b.stat[a]);return"<span>"+(t>0?"+":"")+t+" "+e+"</span>"}}var i=_g.data.ships[a.data("shipid")];debugmode&&console.log(i);var n=$('<div class="ship"/>'),p=_g.getName(i.name,"・")||"舰娘",o=[];$('<div class="title"/>').html('<h2 data-content="'+p+'">'+p+"</h2><small>"+(i["class"]?_g.data.ship_classes[i["class"]].name_zh+"级":"")+(i.class_no?"<em>"+i.class_no+"</em>号舰":"")+(i.type?" / "+_g.data.ship_types[i.type].full_zh:"")+"</small>").appendTo(n);var _=$('<div class="stats"/>').html('<h4 data-content="基础属性">基础属性</h4>').appendTo(n),r=$("<div/>").appendTo(_),d=$("<div/>").appendTo(_),m=$("<div/>").appendTo(_),l=$('<div class="consum"/>').appendTo(_);t("hp","耐久",e(i.stat.hp),r),t("armor","装甲",e(i.stat.armor_max),r),t("evasion","回避",e(i.stat.evasion_max),r),t("carry","搭载",e(i.stat.carry),r),t("fire","火力",e(i.stat.fire_max),d),t("torpedo","雷装",e(i.stat.torpedo_max),d),t("aa","对空",e(i.stat.aa_max),d),t("asw","对潜",e(i.stat.asw_max,/^(5|8|9|12)$/.test(i.type)),d),t("speed","航速",_g.getStatSpeed(i.stat.speed),m),t("range","射程",_g.getStatRange(i.stat.range),m),t("los","索敌",e(i.stat.los_max),m),t("luck","运",i.stat.luck+"<sup>"+i.stat.luck_max+"</sup>",m),t("fuel","油耗",e(i.consum.fuel),l),t("ammo","弹耗",e(i.consum.ammo),l);for(var h=$('<div class="equipments"/>').html('<h4 data-content="初始装备 & 搭载量">初始装备 & 搭载量</h4>').appendTo(n),c=0;4>c;){var f=$("<button/>").appendTo(h),g=$("<i/>").appendTo(f),u=$("<small/>").appendTo(f),v=$("<em/>").appendTo(f);if("undefined"==typeof i.slot[c])f.addClass("no");else if("undefined"!=typeof i.equip[c]&&i.equip[c]&&""!==i.equip[c]){var b=_g.data.items[i.equip[c]],y="assets/images/itemicon/"+_g.data.item_types[b.type].icon+".png";f.attr({"data-itemid":i.equip[c],"data-tip-position":"left","data-tip":'<h3 class="itemstat"><s style="background-image: url('+y+')"></s><strong data-content="'+b.name.zh_cn+'">'+b.name.zh_cn+"</strong><small>"+_g.data.item_types[b.type].name.zh_cn+"</small></h3>"+s("fire","火力")+s("torpedo","雷装")+s("aa","对空")+s("asw","对潜")+s("bomb","爆装")+s("hit","命中")+s("armor","装甲")+s("evasion","回避")+s("los","索敌")+s("range","射程")}),u.html(b.name.zh_cn.replace(/（([^（^）]+)）/g,"<small>($1)</small>")),v.html(i.slot[c]),g.css("background-image","url("+y+")")}else f.addClass("empty"),u.html("--未装备--"),v.html(i.slot[c]);c++}$('<span class="entity"/>').html("<strong>声优</strong><span>"+_g.data.entities[i.rels.cv].name[_g.lang]+"</span>").appendTo(n),$('<span class="entity"/>').html("<strong>画师</strong><span>"+_g.data.entities[i.rels.illustrator].name[_g.lang]+"</span>").appendTo(n);var x=$('<div class="remodels"/>').html('<h4 data-content="改造">改造</h4>').appendTo(n),k=_p.el.flexgrid.create().appendTo(x);i.series&&_db.ship_series.find({id:i.series},function(a,e){function t(a){a=a.replace(/\\/g,"/");try{var e=node.fs.lstatSync(a);e&&e.isFile()&&(h++,$('<input type="radio" name="ship_'+i.id+'_illustrations" value="'+h+'"/>').prop("checked",1==h).insertBefore(w),$('<span class="container"/>').html('<img src="'+a+'"/>').appendTo(w))}catch(t){}}if(!a&&e&&e.length){for(var s in e[0].ships){var n=parseInt(s),p=_g.data.ships[e[0].ships[s].id],_=p.name.zh_cn+(p.name.suffix?"・"+_g.data.ship_namesuffix[p.name.suffix].zh_cn:""),r='<h3 class="shipinfo"><strong data-content="'+_+'">'+_+"</strong>"+(p.type?"<small>"+_g.data.ship_types[p.type].full_zh+"</span>":"")+"</h3>",d=n?e[0].ships[n-1].next_lvl:null,m=n?e[0].ships[n-1].next_blueprint:null;if(k.appendDOM($('<button class="unit" data-shipid="'+e[0].ships[s].id+'" data-infos="__ship__"/>').attr("data-tip",r).addClass(e[0].ships[s].id==i.id?"on":"").addClass(m?"blueprint":"").html('<i><img src="'+_g.path.pics.ships+"/"+e[0].ships[s].id+'/0.webp"/></i>'+(d?"<strong>"+d+"</strong>":""))),e[0].ships[s].id==i.id)if(e[0].ships[s].illust_delete){if(n&&(o.push(e[0].ships[n-1].id),e[0].ships[n-1].illust_extra&&e[0].ships[n-1].illust_extra.length&&e[0].ships[n-1].illust_extra[0]))for(var l in e[0].ships[n-1].illust_extra)o.push("extra_"+e[0].ships[n-1].illust_extra[l])}else if(o.push(e[0].ships[s].id),e[0].ships[s].illust_extra&&e[0].ships[s].illust_extra.length&&e[0].ships[s].illust_extra[0])for(var l in e[0].ships[s].illust_extra)o.push("extra_"+e[0].ships[s].illust_extra[l])}var h=0;for(var s in o)t(_g.path.pics.ships+"/"+o[s]+"/8.webp"),t(_g.path.pics.ships+"/"+o[s]+"/9.webp")}});var T=$('<aside class="illustrations"/>').appendTo(n),w=$("<div/>").appendTo(T);return n},_p.el.tablelist={init_el:function(a){return a.data("tablelist")?!0:void a.data({tablelist:new _tablelist(a)})},init:function(a,e){a=a||$body,e=e||a.find(".tablelist"),e.each(function(){_p.el.tablelist.init_el($(this))})}};var _tablelist=function(a){this.dom={container:a},a.hasClass("ships")&&(this.listtype="ships"),this._index=this.global_index,this.global_index++,this.init()};_tablelist.prototype.global_index=0,_tablelist.prototype._ships_columns=["  ",["火力","fire"],["雷装","torpedo"],["对空","aa"],["对潜","asw"],["耐久","hp"],["装甲","armor"],["回避","evasion"],["搭载","carry"],["航速","speed"],["射程","range"],["索敌","los"],["运","luck"],["油耗","consum_fuel"],["弹耗","consum_ammo"]],_tablelist.prototype._ships_header_checkbox=[],_tablelist.prototype._ships_append_item=function(a,e){function t(a,e){return e||0!=a&&"0"!=a?-1==a||"-1"==a?'<small class="zero">?</small>':a:'<small class="zero">-</small>'}var s=this,i=$('<tr class="row" data-shipid="'+a.id+'" data-header="'+e+'" data-infos="__ship__"/>').attr({"data-shipedit":s.dom.container.hasClass("shiplist-edit")?"true":null}).appendTo(this.dom.tbody),n=0,p=a.name.zh_cn+(a.name.suffix?"<small>"+_g.data.ship_namesuffix[a.name.suffix].zh_cn+"</small>":""),o=$('<input type="checkbox" class="compare"/>').on("click, change",function(a,t){$(this).prop("checked")?i.attr("compare-checked",!0):i.removeAttr("compare-checked"),s._ships_compare_btn_show($(this).prop("checked")),t||s._ships_header_checkbox[e].trigger("docheck")});s._ships_header_checkbox[e].data("ships",s._ships_header_checkbox[e].data("ships").add(i)),i.data("checkbox",o);for(var _ in a.carry)n+=a.carry[_];for(var _ in s._ships_columns)switch(s._ships_columns[_][1]){case" ":$("<th/>").html('<img src="'+_g.path.pics.ships+"/"+a.id+'/0.webp"/><strong>'+p+"</strong>").prepend(o).appendTo(i);break;case"fire":$('<td data-stat="fire" data-value="'+a.stat.fire_max+'"/>').html(t(a.stat.fire_max)).appendTo(i);break;case"torpedo":$('<td data-stat="torpedo" data-value="'+a.stat.torpedo_max+'"/>').html(t(a.stat.torpedo_max)).appendTo(i);break;case"aa":$('<td data-stat="aa" data-value="'+a.stat.aa_max+'"/>').html(t(a.stat.aa_max)).appendTo(i);break;case"asw":$('<td data-stat="asw" data-value="'+a.stat.asw_max+'"/>').html(t(a.stat.asw_max,/^(5|8|9|12)$/.test(a.type))).appendTo(i);break;case"hp":$('<td data-stat="hp" data-value="'+a.stat.hp+'"/>').html(t(a.stat.hp)).appendTo(i);break;case"armor":$('<td data-stat="armor" data-value="'+a.stat.armor_max+'"/>').html(t(a.stat.armor_max)).appendTo(i);break;case"evasion":$('<td data-stat="evasion" data-value="'+a.stat.evasion_max+'"/>').html(t(a.stat.evasion_max)).appendTo(i);break;case"carry":$('<td data-stat="carry" data-value="'+a.stat.carry+'"/>').html(t(a.stat.carry)).appendTo(i);break;case"speed":$('<td data-stat="speed" data-value="'+a.stat.speed+'"/>').html(_g.getStatSpeed(a.stat.speed)).appendTo(i);break;case"range":$('<td data-stat="range" data-value="'+a.stat.range+'"/>').html(_g.getStatRange(a.stat.range)).appendTo(i);break;case"los":$('<td data-stat="los" data-value="'+a.stat.los_max+'"/>').html(t(a.stat.los_max)).appendTo(i);break;case"luck":$('<td data-stat="luck" data-value="'+a.stat.luck+'"/>').html(a.stat.luck+"<sup>"+a.stat.luck_max+"</sup>").appendTo(i);break;case"consum_fuel":$('<td data-stat="consum_fuel" data-value="'+a.consum.fuel+'"/>').html(a.consum.fuel).appendTo(i);break;case"consum_ammo":$('<td data-stat="consum_ammo" data-value="'+a.consum.ammo+'"/>').html(a.consum.ammo).appendTo(i)}return a.remodel_next&&_g.data.ships[a.remodel_next]&&_g.ship_type_order_map[a.type]==_g.ship_type_order_map[_g.data.ships[a.remodel_next].type]&&a.name.ja_jp==_g.data.ships[a.remodel_next].name.ja_jp&&i.addClass("premodeled"),i},_tablelist.prototype._ships_append_all_items=function(){function a(t,s){if(_g.data.ship_id_by_type[t]){if(!s){if("object"==typeof _g.ship_type_order[t])var i=_g.data.ship_types[_g.ship_type_order[t][0]];else var i=_g.data.ship_types[_g.ship_type_order[t]];var n="_input_g"+parseInt(_g.inputIndex),p=$('<tr class="typetitle"><th colspan="'+(e._ships_columns.length+1)+'"><label for="'+n+'">'+i.full_zh+"<small>["+i.code+"]</small></label></th></tr>").appendTo(e.dom.tbody);e._ships_header_checkbox[t]=$('<input type="checkbox" id="'+n+'"/>').on({change:function(){var a=$(this);a.data("ships").filter(":visible").each(function(){$(this).data("checkbox").prop("checked",a.prop("checked")).trigger("change",[!0])})},docheck:function(){var a=$(this).data("ships").filter(":visible"),e=a.filter("[compare-checked=true]");$(this).prop(e.length?e.length<a.length?{checked:!1,indeterminate:!0}:{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!1})}}).data("ships",$()).prependTo(p.find("th")),_g.inputIndex++}e._ships_append_item(_g.data.ships[_g.data.ship_id_by_type[t][s]],t),setTimeout(function(){if(s>=_g.data.ship_id_by_type[t].length-1){for(var i=0;9>i;)$('<tr class="empty"/>').appendTo(e.dom.tbody),i++;a(t+1,0)}else a(t,s+1)},0)}else e.mark_high(),_frame.app_main.loaded("tablelist_"+e._index,!0)}var e=this;a(0,0)},_tablelist.prototype._ships_compare_btn_show=function(a){!a&&this.dom.tbody.find('input[type="checkbox"].compare:checked').length||a?this.dom.msg_container.attr("data-msgs","comparestart"):this.dom.msg_container.removeAttr("data-msgs")},_tablelist.prototype._ships_compare_start=function(){this.dom.msg_container.removeAttr("data-msgs"),this._ships_last_viewtype=this.dom.filter_container.attr("viewtype"),this.dom.filter_container.attr("viewtype","compare"),_config.set("shiplist-viewtype",this._ships_last_viewtype),this.mark_high()},_tablelist.prototype._ships_compare_end=function(){this.dom.tbody.find('input[type="checkbox"].compare:checked').prop("checked",!1).trigger("change"),this.dom.filter_container.attr("viewtype",this._ships_last_viewtype),delete this._ships_last_viewtype,this.dom.msg_container.removeAttr("data-msgs"),this.mark_high()},_tablelist.prototype._ships_compare_continue=function(){this.dom.filter_container.attr("viewtype",this._ships_last_viewtype),delete this._ships_last_viewtype,this.dom.msg_container.attr("data-msgs","comparestart"),this.mark_high()},_tablelist.prototype._ships_init=function(){function a(a){var e=$("<thead/>"),t=$("<tr/>").appendTo(e);for(var s in a)"object"==typeof a[s]?$('<td data-stat="'+a[s][1]+'"/>').html('<div class="th-inner">'+a[s][0]+"</div>").appendTo(t):$("<th/>").html('<div class="th-inner">'+a[s]+"</div>").appendTo(t);return e}var e=this;_frame.app_main.loading.push("tablelist_"+this._index),_frame.app_main.is_loaded=!1,this.dom.filter_container=$('<div class="options"/>').appendTo(this.dom.container),this.dom.filters=$('<div class="filters"/>').appendTo(this.dom.filter_container),this.dom.exit_compare=$('<div class="exit_compare"/>').append($('<button icon="close"/>').html("结束对比").on("click",function(){e._ships_compare_end()})).append($('<button icon="checkbox-checked"/>').html("继续选择").on("click",function(){e._ships_compare_continue()})).appendTo(this.dom.filter_container),this.append_option("checkbox","hide-premodel","仅显示同种同名舰最终版本","false"===_config.get("shiplist-filter-hide-premodel")?null:!0,null,{onchange:function(a,t){_config.set("shiplist-filter-hide-premodel",t.prop("checked")),e.dom.filter_container.attr("filter-hide-premodel",t.prop("checked"))}}),this.append_option("radio","viewtype",null,[["card",""],["list",""]],null,{radio_default:_config.get("shiplist-viewtype"),onchange:function(a,t){t.is(":checked")&&(_config.set("shiplist-viewtype",t.val()),e.dom.filter_container.attr("viewtype",t.val()))}}),this.dom.filters.find("input").trigger("change"),this.dom.table_container=$('<div class="fixed-table-container"/>').appendTo(this.dom.container),this.dom.table_container_inner=$('<div class="fixed-table-container-inner"/>').appendTo(this.dom.table_container),this.dom.table=$('<table class="ships hashover hashover-column"/>').appendTo(this.dom.table_container_inner),a(e._ships_columns).appendTo(this.dom.table),this.dom.tbody=$("<tbody/>").appendTo(this.dom.table),_g.data.ship_types?e._ships_append_all_items():$("<p/>").html("暂无数据...").appendTo(e.dom.table_container_inner),this.dom.msg_container=$('<div class="msgs"/>').appendTo(this.dom.container),_config.get("hide-compareinfos")||this.dom.msg_container.attr("data-msgs","compareinfos");var t=$('<div class="compareinfos"/>').html("点击舰娘查询详细信息，勾选舰娘进行对比").appendTo(this.dom.msg_container);$("<button/>").html("&times;").on("click",function(){e.dom.msg_container.removeAttr("data-msgs"),_config.set("hide-compareinfos",!0)}).appendTo(t);$('<div class="comparestart"/>').html("开始对比").on("click",function(){e._ships_compare_start()}).appendTo(this.dom.msg_container)},_tablelist.prototype.append_option=function(a,e,t,s,i,n){function p(){switch(a){case"text":case"number":case"hidden":var t=$('<input type="'+a+'" name="'+e+'" id="'+_+'" />').val(s);break;case"select":var t=$('<select name="'+e+'" id="'+_+'" />'),i=$('<option value=""/>').html("").appendTo(t);for(var p in s){if("object"==typeof s[p])var o=$('<option value="'+("undefined"==typeof s[p].val?s[p].value:s[p].val)+'"/>').html(s[p].title||s[p].name).appendTo(t);else var o=$('<option value="'+s[p]+'"/>').html(s[p]).appendTo(t);"undefined"!=typeof n["default"]&&o.val()==n["default"]&&o.prop("selected",!0)}s&&s.length||(i.remove(),$('<option value=""/>').html("...").appendTo(t)),n["new"]&&($('<option value=""/>').html("==========").insertAfter(i),$('<option value="___new___"/>').html("+ 新建").insertAfter(i),t.on("change.___new___",function(){var a=$(this);"___new___"==a.val()&&(a.val(""),n["new"](t))}));break;case"checkbox":var t=$('<input type="'+a+'" name="'+e+'" id="'+_+'" />').prop("checked",s);break;case"radio":var t=$();for(var p in s){var r,d,m=!1;s[p].push?(d=s[p][0],r=s[p][1]):(d=s[p].val||s[p].value,r=s[p].title||s[p].name),n.radio_default&&n.radio_default==d&&(m=!0),t=t.add($('<input type="radio" name="'+e+'" id="'+_+"-"+d+'" ischecked="'+m+'" />').val(d).prop("checked",m||!m&&0==p)),t=t.add($('<label for="'+_+"-"+d+'"/>').html(r))}}return n.required&&t.prop("required",!0),n.onchange&&(t.on("change.___onchange___",function(a){n.onchange(a,$(this))}),n["default"]&&t.trigger("change")),e||t.attr("name",null),t}n=n||{};var o=$("<p/>").addClass(e).appendTo(this.dom.filters),_="_input_g"+parseInt(_g.inputIndex),t=t?$('<label for="'+_+'"/>').html(t).appendTo(o):null,r=p().appendTo(o);return"checkbox"==a&&t&&t.insertAfter(r),i&&$('<label for="'+_+'"/>').html(i).appendTo(o),_g.inputIndex++,o},_tablelist.prototype.sort_column=function(a,e,t){if(!t){var s=this.dom.tbody;s&&s.length||(s=this.dom.table.find("tbody")),t=s.find("tr.row:visible")}a=a||1,this._tmp_values=[],this._tmp_value_map_cell={};var i=this;t.find("td:nth-of-type("+a+")").each(function(){var a=$(this),e=$(this).data("value");e=parseFloat(e),$.inArray(e,i._tmp_values)<0&&i._tmp_values.push(e),i._tmp_value_map_cell[e]||(i._tmp_value_map_cell[e]=$()),i._tmp_value_map_cell[e]=i._tmp_value_map_cell[e].add(a)}),this._tmp_values.sort(function(a,t){return e?a-t:t-a});var n=[];for(var p in this._tmp_values)n.push(this._tmp_value_map_cell[this._tmp_values[p]]);return delete this._tmp_values,delete this._tmp_value_map_cell,n},_tablelist.prototype.mark_high=function(){var a=this.dom.tbody;a&&a.length||(a=this.dom.table.find("tbody"));var e=a.find("tr.row:visible");e.find("td[data-value]").removeClass("sort-first sort-second"),e.eq(0).find("td[data-value]").each(function(a){var t=!1;if(!$(this).data("stat").match(/\b(speed|range)\b/)){$(this).data("stat").match(/\b(consum_fuel|consum_ammo)\b/)&&(t=!0);var s=_tablelist.prototype.sort_column(a+1,t,e),i=Math.min(6,Math.ceil(e.length/2)+1);s.length>1&&s[0].length<i&&(s[0].addClass("sort-first"),s.length>2&&s[1].length<i&&s[1].addClass("sort-second"))}})},_tablelist.prototype.init=function(){return this.is_init?!0:(this["_"+this.listtype+"_init"]&&this["_"+this.listtype+"_init"](),void(this.is_init=!0))};