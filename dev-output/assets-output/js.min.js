"use strict";function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _b(e){return _support.check(e)}function addHandler(e,t,i){if("undefined"!=typeof e.addEventListener)e.addEventListener(t,i,!1);else{if("undefined"==typeof e.attachEvent)throw"Incompatible browser";e.attachEvent("on"+t,i)}}function eventName(e,t){return t=t?"."+t:"",_g.event[e]?_g.event[e].split(" ").map(function(e){return e+t}).join(" "):e+t}var _get=function(e,t,i){for(var a=!0;a;){var n=e,o=t,s=i;r=d=l=void 0,a=!1,null===n&&(n=Function.prototype);var r=Object.getOwnPropertyDescriptor(n,o);if(void 0!==r){if("value"in r)return r.value;var l=r.get;return void 0===l?void 0:l.call(s)}var d=Object.getPrototypeOf(n);if(null===d)return void 0;e=d,t=o,i=s,a=!0}},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),$window=$(window),$document=$(document),$html=$("html"),$body=$("body"),$body_preventMouseover=!1,_g={isinit:!1,isload:!1,isfocus:document.hasFocus?document.hasFocus():!0,everfocus:document.hasFocus?document.hasFocus():!0,posttime:[],time_format:"m月d日",time_format2:"Y年m月d日",time_diff_range:3456e5,time_diff_range2:31536e6,last:{width:0,height:0},interval:{},initSize:20,baseSize:10,baseMultiper:1,lastBaseSize:10,pixelRatio:window.devicePixelRatio?window.devicePixelRatio:screen.deviceXDPI?screen.deviceXDPI/72:1,maxMultiper:Math.max(1,Math.ceil((screen.availHeight||screen.height||$window.height())/800*10)/10),strings:{},inputIndex:0,lang:"zh_cn",_:!1},_p={comp:{},el:{}},_frame={dom:{},init_all:function(){for(var e in _frame)_frame[e].init&&_frame[e].init()}},_module={},_page={},_data={};if("undefined"==typeof _huScrolled)var _huScrolled={};if(!_huScrolled.ver||_huScrolled.ver<1.2){_huScrolled.ver=1.2,_huScrolled.timeout=!1,_huScrolled.throttle=_huScrolled.throttle||100;var bIEnew=/\(Windows NT [0-9\.]+.+Trident\/[0-9\.]+.+rv.{1}[0-9\.]+\)/.test(navigator.userAgent),bIE=!(!window.attachEvent||window.opera)||bIEnew,el=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<9?$window:$document;el.on({"scroll.huScrolled":function(){return _huScrolled.timeout?!0:void(_huScrolled.timeout=setTimeout(function(){$document.trigger("huScrolled"),_huScrolled.timeout=null},_huScrolled.throttle))}})}if("undefined"==typeof _huResized)var _huResized={};if((!_huResized.ver||_huResized.ver<2.1)&&(_huResized.ver=2.1,_huResized.throttle=_huResized.throttle||300,_huResized.startSize={},_huResized.viewport=function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},$window.on({"resize.huResized":function(e,t){t=t||{};var i=_huResized.viewport(),a=_huResized.startSize.width||i.width,n=_huResized.startSize.height||i.height,o=Math.abs(i.width-a)>50||Math.abs(i.height-n)>50;_huResized.timeout&&(clearTimeout(_huResized.timeout),_huResized.timeout=null),_huResized.topmask||(_huResized.topmask=$("<div/>").css({"z-index":"16777269",display:"none",position:"fixed",width:"100%",height:"100%",top:0,left:0,"background-color":"rgba(0,0,0,.5)"}).appendTo($body)),!o||t.isInitial||_huResized.maskShowing||(_huResized.topmask.css("display","block"),_huResized.maskShowing=!0),o||_huResized.isChanging||(_huResized.startSize={width:i.width,height:i.height}),_huResized.isChanging=!0,_huResized.timeout=setTimeout(function(){$window.trigger("huResized"),_huResized.timeout=null,_huResized.maskShowing=!1,_huResized.isChanging=!1,_huResized.topmask.css("display","none"),i=_huResized.viewport(),_huResized.startSize={width:i.width,height:i.height}},t.isInitial?0:_huResized.throttle)}})),"undefined"==typeof _huCss)var _huCss={};(!_huCss.ver||_huCss.ver<1.2)&&(_huCss.ver=1.2,_huCss.cssprefix_result={},_huCss.csscheck=function(e){if(_huCss.csscheck_div||(_huCss.csscheck_div=document.createElement("div")),e in _huCss.csscheck_div.style)return!0;var t=e.split("-");e=t[0];for(var i=1;i<t.length;i++)e+=t[1].substr(0,1).toUpperCase()+t[1].substr(1);return e in _huCss.csscheck_div.style},_huCss.csscheck_full=function(e){return _huCss.cssprefix(e,null,!0)},_huCss.cssprefix=function(e,t,i){if(_huCss.cssprefix_result[e])var a=_huCss.cssprefix_result[e];else if(_huCss.cssprefix_result[e]===!1){if(i)return!1;var a=""}else{var a="",n=["-webkit-","-moz-","-ms-","-o-"],o=_huCss.csscheck(e);if(!o){a=!1;for(var s=0;s<n.length;s++)if(_huCss.csscheck(n[s]+e)){a=n[s];break}}if(_huCss.cssprefix_result[e]=a,i)return a=a===!1?!1:!0}return a=a===!1?"":a,t?a:a+e},_huCss.csscheck_3d=function(){return _huCss.csscheck_full("perspective")},_huCss.createSheet=function(e){var t=document.createElement("style");if(e&&(t.title=e),document.getElementsByTagName("head")[0].appendChild(t),window.createPopup||t.appendChild(document.createTextNode("")),e)for(var i=0;i<document.styleSheets.length;i++)if(document.styleSheets[i].title==e)return document.styleSheets[i];return document.styleSheets[document.styleSheets.length-1]},_huCss.getSheet=function(e){return e=e||_huCss.sheet,e||(_huCss.sheet=_huCss.createSheet("__huCss_sheet"),e=_huCss.sheet),e},_huCss.getCssRulesNum=function(e){return e=_huCss.getSheet(e),e.cssRules?e.cssRules.length:0},_huCss.addRule=function(e,t,i,a){var n="";a=_huCss.getSheet(a);for(var o in t)_huCss.csscheck_full(o)?n+=_huCss.cssprefix(o)+":"+t[o]+";":"opacity"==o&&_huCss.csscheck_full("filter")&&(n+="filter:alpha(opacity="+100*t[o]+")");if(i||0===i||(i=a.cssRules?a.cssRules.length:_huCss.getCssRulesNum()),a.insertRule)a.insertRule(e+"{"+n+"}",i);else for(e=e.split(","),o=0;o<e.length;o++)a.addRule(e[o],n,i)},_huCss.removeRule=function(e,t){if(!e&&0!==e)return!1;t=_huCss.getSheet(t);try{t.deleteRule(e)}catch(i){t.removeRule(e)}});var _UA=navigator.userAgent,bChrome=/Chrome/.test(_UA),bChromeVer=bChrome?/Chrome\/([0-9\.]+)/.exec(navigator.appVersion):!1,bSafari=/Safari/.test(_UA)&&!bChrome,bFirefox=/Firefox/.test(_UA),bOpera=/Opera/.test(_UA),bWebkit=/WebKit/.test(_UA),bWebkitVer=bWebkit?/(AppleWebKit|Safari)\/([0-9\.]+)/.exec(navigator.appVersion):!1,bIEnew=/\(Windows NT [0-9\.]+.+Trident\/[0-9\.]+.+rv.{1}[0-9\.]+\)/.test(_UA),bIEnewVer=bIEnew?parseFloat(_UA.split("rv:")[1]):!1,bIE=!(!window.attachEvent||window.opera)||bIEnew,bIE6=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<7,bIE7=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<8,bIE8=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<9,bIE9=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<10,bIE10=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<11,bIE11=bIEnewVer&&12>bIEnewVer,bGecko=!bIE&&!bIEnew&&!bWebkit&&-1!=_UA.indexOf("Gecko"),bIphone=/iPhone/i.test(_UA),bIpad=/iPad/i.test(_UA),bAndroid=/Android/i.test(_UA),bIOS=!1,bIOSver=bIphone||bIpad?/CPU.*OS\s*([0-9_]+)/i.exec(navigator.appVersion):!1,bMobile=bIphone||bIpad||bAndroid,bCSSrem=!bIE8,bCSS3=_huCss.csscheck_full("border-radius"),bCSS3A=_huCss.csscheck_full("animation"),bCSS3flex=_huCss.csscheck_full("flex"),b3D=_huCss.csscheck_full("perspective"),bCSS3calc=bCSSrem,bTouch=/Touch/.test(_UA),bUnsupport=bIE7,bHTML5m3u8=bMobile,bAccessYoutube=!1,bAccessTwitter=!1,bAccessFacebook=!1;if(bWebkitVer&&bWebkitVer.length&&(bWebkitVer=bWebkitVer[2]),bChromeVer&&bChromeVer.length&&(bChromeVer=parseFloat(bChromeVer[1])),bIOSver&&bIOSver.length&&(bIOSver=parseFloat(bIOSver[1].replace(/_/,".")),bIOS=!0),(bChromeVer&&29>bChromeVer||bIOSver&&7>bIOSver)&&(bCSS3flex=!1),bIOSver&&6>bIOSver&&(bCSS3calc=!1),bGecko?$html.addClass("gecko"):bIE11&&!bIE10?$html.removeClass("ie9").addClass("ie11"+(bTouch?" ie-touch":"")):bIE10&&!bIE9?$html.removeClass("ie9").addClass("ie10"+(bTouch?" ie-touch":"")):bMobile?($html.addClass("mobile"),bIOS&&$html.addClass("ios"),bIphone&&$html.addClass("iphone"),bIpad&&$html.addClass("ipad"),bAndroid&&$html.addClass("android")):537>bWebkitVer&&$html.addClass("oldwebkit"),bTouch&&$html.addClass("touch"),navigator.userAgent.match(/IEMobile\/10\.0/)){var msViewportStyle=document.createElement("style");msViewportStyle.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(msViewportStyle)}_g.getUrl=function(){return location.href.split("#")[0]},_g.uriSearchArr={},_g.uriHashArr={},_g.timeHash=function(){var e=new Date;return e=e.getTime()},_g.uriSearch=function(e){if(!_g.uriSearchArr.length){var t=location.search?location.search.split("?")[1]:"";t=t.split("&");for(var i=0;i<t.length;i++){var a=t[i].split("=");_g.uriSearchArr[a[0]]=a[1]||""}}return e?_g.uriSearchArr[e]:location.search.substr(location.search.indexOf("?")+1)},_g.uriHash=function(e,t,i){var a=location.hash,n=a?a.split("#")[1]:"";if(n=n.split("&"),!_g.uriHashInited){_g.uriHashArr={};for(var o in n){var s=n[o].split("=");""!==s[0]&&(_g.uriHashArr[s[0]]=s[1]||!1)}_g.uriHashInited=!0}if("object"==typeof e){for(var r in e)a=_g.uriHash(r,e[r],a);location.hash=a}else if(t===!1||""===t)a=a.replace("&"+e+"="+_g.uriHashArr[e],"").replace(e+"="+_g.uriHashArr[e],""),"#"!=a&&""!=a&&a||(a="_"),location.hash=a;else if("undefined"!=typeof t){if(t==_g.uriHashArr[e])return t;var l=_g.uriHashArr[e]?a.replace(e+"="+_g.uriHashArr[e],e+"="+t):a+(""==a?"#":"&")+e+"="+t;return _g.uriHashArr[e]=t,i?l:(location.hash=l,t)}return e?_g.uriHashArr[e]||!1:location.hash.substr(location.hash.indexOf("#")+1)},_g.randNumber=function(e){var t=new Date;return t=t.getTime(),t=(9301*t+49297)%233280,e||(e=1e3),Math.ceil(t/233280*e)},_g.randInt=function(e,t){return Math.floor(Math.random()*parseInt(e)+(t?parseInt(t):0))},_g.scrollTo=function(e,t){if(isNaN(e)){e=$(e);var i=e.scrollTop()}else{t=e,e=$("html,body");var i=$window.scrollTop()}var a=Math.abs(i-t),n=$window.height(),o=n>=a?200:200*(a/n)*(2/3);e.stop().animate({scrollTop:t},o)},_g.get_em=function(e,t,i){var a=parseFloat(e);return t=t||$body,i=i||0,isNaN(a)?e:a/parseFloat(t.css("font-size"))+i+"em"},_g.get_fontsize=function(e){return e=e||$body,parseInt(e.css("font-size"))},_g.get_basesize=function(){return parseInt($body.css("font-size"))/_g.initSize*10},_g.get_basesize_true=function(){return parseInt($body.css("font-size"))},_g.get_basemultiper=function(){return parseFloat(_g.get_basesize()/10)},_g.get_rem=function(e){var t=parseFloat(e);return isNaN(t)?e:bCSSrem?t/_g.initSize+"rem":e},_g.rem=function(e,t){var i=parseFloat(e);return isNaN(i)?e:bCSSrem?(i=i/(_g.get_basesize()/10)/_g.initSize,t?i+"rem":Math.round(10*i)/10+"rem"):e},_g.px=function(e,t){var i=parseFloat(e);return isNaN(i)?e:bIE8?e:i*_g.initSize+(t?0:"px")},_g.get_animate_duration=function(e){return _g.isfocus?e:0},_g.goto_hash=function(e,t){if(e=e||location.hash,e=e.replace(/^([\#]{0,1})(.+)/,"$2"),"!"==e[0])return!1;var i=$("#"+e);if(!i.length)return!1;var a=i.offset().top,n=$window.scrollTop(),o=Math.abs(n-a),s=$window.height();return t=null==t?s>=o?200:200*(o/s)*(2/3):t,t?$("html,body").stop().animate({scrollTop:a},t,function(){location.hash=e}):($("html,body").scrollTop(a),location.hash=e),e},_g.time=function(e){if(!e)return _g.timeNow();for(var t,i=[{exp:/(\d{4}).(\d{1,2}).(\d{1,2})[^0-9]*(\d{0,2})[:]{0,1}(\d{0,2})[:]{0,1}(\d{0,2})([\+\-])(\d{2})\:(\d{2})/i,p:{year:1,month:2,day:3,hour:4,min:5,sec:6,zoneD:7,zoneH:8,zoneM:9}},{exp:/(\d{1,2}).(\d{1,2}).(\d{4})[^0-9]*(\d{0,2})[:]{0,1}(\d{0,2})[:]{0,1}(\d{0,2})/i,p:{year:3,month:1,day:2,hour:4,min:5,sec:6}},{exp:/(\d{4}).(\d{1,2}).(\d{1,2})[^0-9]*(\d{0,2})[:]{0,1}(\d{0,2})[:]{0,1}(\d{0,2})/i,p:{year:1,month:2,day:3,hour:4,min:5,sec:6}}],a=0;a<i.length;a++){var n=i[a].exp,o=e.match(n);if(!t&&o&&o.length){var s=parseInt(o[i[a].p.year]),r=parseInt(o[i[a].p.month])||0,l=parseInt(o[i[a].p.day])||1,d=parseInt(o[i[a].p.hour])||0,p=parseInt(o[i[a].p.min])||0,m=parseInt(o[i[a].p.sec])||0;if(t=new Date(s,r-1,l,d,p,m,0),i[a].p.zoneD&&o[i[a].p.zoneD]){var u="+"==o[i[a].p.zoneD]?-1:1,d=parseInt(o[i[a].p.zoneH])||0,p=parseInt(o[i[a].p.zoneM])||0,c=u*(p+60*d+t.getTimezoneOffset())*60*1e3;t=new Date(t.valueOf()+c)}}}return t},_g.timeCal=function(e,t){return 6e4>e?Math.floor(e/1e3)+"秒"+(t?"前":""):36e5>e?Math.floor(e/6e4)+"分钟"+(t?"前":""):864e5>e?Math.floor(e/36e5)+"小时"+(t?"前":""):1728e5>e?"昨天":2592e6>e?Math.floor(e/864e5)+"天"+(t?"前":""):31536e6>e?Math.floor(e/2592e6)+"月"+(t?"前":""):Math.floor(e/31536e6)+"年"+(t?"前":"")},_g.timeNow=function(){var e=new Date;return e.getTime()},_g.timeDiff=function(e){var t={time:_g.timeNow(),obj:null,format:_g.time_format,format2:_g.time_format2,range:_g.time_diff_range,range2:_g.time_diff_range2,is_init:!0};return $.extend(t,e),t.obj?e=t:!1},_g.timeDiffInterval=function(){function e(){if(!_g.isfocus)return!1;for(var e=0;e<_g.posttime.length;e++){var t=_g.posttime[e].is_init?_g.posttime[e]:_g.timeDiff(_g.posttime[e]),i=new Date,a=i.getTime()-t.time,n=t.range,o=t.range2;if(n>a)t.obj.html(6e4>a?"刚刚":_g.timeCal(a,!0));else{var s=a>o?t.format2:t.format,r=t.time;s=s.replace(/Y/g,r.getFullYear()),s=s.replace(/M/g,r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1),s=s.replace(/m/g,r.getMonth()+1),s=s.replace(/D/g,r.getDate()<10?"0"+r.getDate():r.getDate()),s=s.replace(/d/g,r.getDate()),t.obj.html(s)}}}clearInterval(_g.interval.posttime),e(),_g.interval.posttime=setInterval(function(){e()},6e4)};var _support={cache:{},check:function(e){return e=e.toLowerCase().replace(/[ :-_]/g,""),"undefined"==typeof _support.cache[e]&&_support["_"+e]&&(_support.cache[e]=_support["_"+e]()),_support.cache[e]}};_support._css3=function(){return _huCss.csscheck_full("border-radius")},_support._css3animation=function(){return _huCss.csscheck_full("animation")},_support._css3transition=function(){return _huCss.csscheck_full("transition")},_support._css3flex=function(){return _huCss.csscheck_full("flex")},_support._css33d=function(){return _huCss.csscheck_full("perspective")},_support._css3d=_support._css33d,_support._css3mediaquery=function(){return window.matchMedia||window.msMatchMedia?!0:!1},_support._mediaquery=_support._css3mediaquery,_support._css3imageset=function(){function e(e){i.css("background-image","image-set(url("+_g.pathImg+"_g-p.gif) 1x)");var t=i.css("background-image");return t&&"none"!=t?!0:e&&(i.css("background-image",e+"image-set(url("+_g.pathImg+"_g-p.gif) 1x)"),t=i.css("background-image"),t&&"none"!=t)?e:!1}var t=null,i=$("<div/>",{style:"background-image:url("+_g.pathImg+"_g-p.gif)"});return t=bWebkit?e("-webkit-"):bGecko?e("-moz-"):bIE?e("-ms-"):e()},_support._pluginflash=function(){var e=!1;try{e="undefined"!=typeof navigator.plugins&&"object"==typeof navigator.plugins["Shockwave Flash"]||window.ActiveXObject&&0!=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){}return e},_support._flash=_support._pluginflash,_support._html5attrdownload=function(){return"download"in document.createElement("a")},_support._html5download=_support._html5attrdownload,_support._html5attributedownload=_support._html5attrdownload,_support._html5videomp4=function(){var e=document.createElement("video"),t=!1;return e.canPlayType&&e.canPlayType("video/mp4").replace(/no/,"")&&(t=!0),t},_support._html5mp4=_support._html5videomp4,_g.init=function(){if(_g.baseSize=_g.get_basesize(),_g.baseMultiper=parseFloat(_g.baseSize/10),_g.lastBaseSize=_g.get_basesize(),_g.isfocus="visible"==Visibility.state(),_g.everfocus=_g.isfocus,Visibility.change(function(e,t){"visible"==t?(_g.isfocus=!0,_g.everfocus||(_g.everfocus=!0,_g.last.width=-1,_g.last.height=-1,_frame.main.last.width=-1,_frame.main.last.height=-1),$window.trigger("resized_check._g"),_g.timeDiffInterval()):_g.isfocus=!1}),$window.on({orientationchange:function(){$window.trigger("resize")},huResized:function(){$window.trigger("resized_check._g")},"resized_check._g":function(){if(!_g.isfocus)return!1;var e=$window,t=e.width(),i=e.height();if(_g.baseSize=_g.get_basesize(),_g.orientation=t>=i?"landscape":"portrait",_g.baseSize!=_g.lastBaseSize&&(_g.baseMultiper=parseFloat(_g.baseSize/10),_g.lastBaseSize=_g.baseSize,_g.isBaseChange=!0,e.trigger("basechange")),t!=_g.last.width||i!=_g.last.height){var a={is_widthchange:t!=_g.last.width,is_heightchange:i!=_g.last.height};e.trigger("resized_before",[a]).trigger("resized",[a]),_g.isEverResized=!0}_g.last.width=t,_g.last.height=i},basechange:function(){_g.isBaseChange&&(_g.isBaseChange=!1,setTimeout(function(){$window.trigger("resized_before").trigger("resized",[{is_basechange:!0}])},_g.animate_duration_delay))},"load.trigger_resized":function(){return _g.isfocus?(setTimeout(function(){$window.trigger("resized_before",[{is_load:!0}]).trigger("resized",[{is_load:!0}])},_g.readyLock?4*_g.animate_duration+10:0),void(_g.isload=!0)):!1},"hashchange._global":function(e){_g.uriHashArr={};var t=(location.hash?location.hash.split("#")[1]:"").split("&");for(var i in t){var a=t[i].split("=");""!==a[0]&&(_g.uriHashArr[a[0]]=a[1]||!1)}_g.uriHashInited=!0,_g.uriHash()&&""!=_g.uriHash()||(e.preventDefault(),e.stopPropagation())},"unload.focuswindow":function(){$(this).focus()}}),setTimeout(function(){$window.trigger("hashchange")},_g.animate_duration_delay+10),$document.on({huScrolled:function(){$window.trigger("scrolled")}}),$body.data("preventMouseover",!1).on({"touchstart.preventMouseover":function(){$body.removeClass("hover"),$body_preventMouseover=!0},"touchend.preventMouseover":function(){setTimeout(function(){$body_preventMouseover=!1},1)},pointerover:function(e){"touch"==e.originalEvent.pointerType&&$body.trigger("touchstart.preventMouseover")},pointerleave:function(e){"touch"==e.originalEvent.pointerType&&$body.trigger("touchend.preventMouseover")},mouseenter:function(){$body_preventMouseover?$body_preventMouseover=!1:$body.addClass("hover")},mouseleave:function(){$body.removeClass("hover")}}),top!=self)try{self.location.host!=top.location.host&&top.location.replace(self.location.href),self.location.host==top.location.host&&($body.addClass("only-content"),_g.changeTheme(top._g.getTheme())),$html.css("font-size",top.$html.css("font-size")),$window.on({"resized.iframe_resize":function(){$html.css("font-size",top.$html.css("font-size"))}})}catch(e){}_hotkey.init(),_frame.init_all(),_p.init_document_ready(),$html.addClass("ready"),$window.trigger("resize",[{isInitial:!0}]),_g.readyLock=!0,setTimeout(function(){_g.readyLock=null},4*_g.animate_duration+10);try{window.external.msSiteModeClearBadge()}catch(e){}return _g.isinit=!0,!1},jQuery.cookie=function(e,t,i){if("undefined"==typeof t){var a=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var s=jQuery.trim(n[o]);if(s.substring(0,e.length+1)==e+"="){a=decodeURIComponent(s.substring(e.length+1));break}}return a}i=i||{},null===t&&(t="",i.expires=-1);var r="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var l;"number"==typeof i.expires?(l=new Date,l.setTime(l.getTime()+24*i.expires*60*60*1e3)):l=i.expires,r="; expires="+l.toUTCString()}var d="; path="+(i.path?i.path:"/"),p=i.domain?"; domain="+i.domain:/(.*)([\.]*)acgdb\.com/.test(location.host)?"; domain=.acgdb.com":"",m=i.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),r,d,p,m].join("")},function(e){e.fn.innerWidth=function(){return parseFloat(this.css("width"))},e.fn.innerHeight=function(){return parseFloat(this.css("height"))}}(jQuery),$.fn.serializeObject=function(){function e(i,a,n){if(!a.length)return i;var o=a[0];"undefined"==typeof i[o]?i[o]=a.length>1?{}:n:1==a.length&&(i[o].push||(i[o]=[i[o]]),i[o].push(t(n))),a.shift(),e(i[o],a,n)}function t(e){return"number"==typeof e&&0===e?e:e||""}var i={},a=this.serializeArray();return $.each(a,function(){if(!/^_tabview\-/.test(this.name))if(this.value=isNaN(this.value)||!this.value?this.value:parseFloat(this.value),this.name.indexOf(".")>-1){var a=this.name.split(".");e(i,a,this.value)}else i[this.name]||0===i[this.name]?(i[this.name].push||(i[this.name]=[i[this.name]]),i[this.name].push(t(this.value))):i[this.name]=t(this.value)}),i},_p.initDOM=function(e){return e=e||_frame.dom.layout||_frame.dom.layout||$body,e.initAll()},_p.initAll=_p.initDOM,$.fn.initDOM=function(){for(var e in _p.el)_p.el[e].init&&_p.el[e].init(this);return this},$.fn.initAll=$.fn.initDOM,_p.init_document_ready=function(){_p.is_init_document_ready||(_p.initDOM($body),_p.is_init_document_ready=!0)},_p.getSummary=function(){var e=$("#summary").text()||!1;return!e&&$("head").find("meta[name=keywords]").length&&(e=$("head").find("meta[name=Description]").attr("content"),e=e.substr(0,e.indexOf(" - ACGDB"))),e},_p.get_tar=function(e,t,i){return e=e||_frame.dom.layout||$("#layout")||$body,"."==t.substr(0,1)&&(t=t.substr(1)),e.hasClass(t)?e:i?e.find('[class^="'+t+'"]'):e.find("."+t)},_p.hashlinks=function(e){e=e||$body,e.find("a[href^=#]").each(function(){$(this).off("click.hashlink").on({"click.hashlink":function(){return _g.goto_hash($(this).attr("href")),!1}})})},_p.get_lines=function(e,t){return t=t||e,Math.max(1,Math.floor(Math.min(e.innerHeight(),e.height())/parseFloat(t.css("line-height"))))},_p.el.time={init:function(e){var t=_p.get_tar(e,".time");t.each(function(){var e=$(this),t=e.text();time=t?_g.time(t):null,time&&_g.posttime.push({time:time,obj:e})}),_g.timeDiffInterval()}},_p.el.timeSec={init:function(e){var t=_p.get_tar(e,".time-sec");t.each(function(){var e=$(this);if(e.data("acgdb-time-sec"))return e.data("acgdb-time-sec");var t=e.text(),i=/\s*([0-9]+)/.exec(t);if(i&&i.length>1){i=parseInt(i[1]);var a=Math.floor(i/60),n=i%60,o=(10>a?"0":"")+a+":"+(10>n?"0":"")+n+"'";e.text(o)}e.data("acgdb-time-sec",i)})}},_p.removeEmptyTextNode=function(e){return e=$(e),e.length?void e.contents().filter(function(){return 3===this.nodeType}).remove():!1},Object.defineProperty(Array.prototype,"mergeFrom",{enumerable:!1,value:function(e){return Array.prototype.push.apply(this,e instanceof Array?e:[e]),this}}),Date.prototype.format=function(e,t){return _g.formatTime(this,e,t)},_g.formatTime_string={zh_CN:{Midnight:"深夜",Sunday:"周日",Monday:"周一",Tuesday:"周二",Wednesday:"周三",Thursday:"周四",Friday:"周五",Saturday:"周六"}},_g.formatTime_weekdaymappding=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_g.formatTime=function(e,t,i){function a(e){return 10>e?"0"+e:e}if(!e)return!1;i=i||{},t=t||"%Y年%m月%d日","date"!=typeof e&&(e=new Date(e));var n=e.valueOf();"undefined"!=typeof i.output_timezone&&(n+=60*(i.output_timezone+e.getTimezoneOffset()/60)*60*1e3,e=new Date(n));var o=e.getHours(),s=a(o);return i.midnight_astoday&&(6>o||24==o)?(o+=24,s=o,n-=864e5,e=new Date(n),t=t.replace(/\%midnight/g,"Midnight"._(_g.formatTime_string))):t=t.replace(/\%midnight/g,""),t.replace(/\%Y/g,e.getFullYear()).replace(/\%m/g,a(e.getMonth()+1)).replace(/\%n/g,e.getMonth()+1).replace(/\%d/g,a(e.getDate())).replace(/\%j/g,e.getDate()).replace(/\%G/g,o).replace(/\%H/g,s).replace(/\%i/g,a(e.getMinutes())).replace(/\%s/g,a(e.getSeconds())).replace(/\%l/g,_g.formatTime_weekdaymappding[e.getDay()]._(_g.formatTime_string))},Object.defineProperty(Object.prototype,"_size",{enumerable:!1,get:function(){var e=0;for(var t in this)e++;return e}}),String.prototype.getText=function(e,t){return _g.getText(this,e,t,!0)},String.prototype._=String.prototype.getText,_g.getText=function(e,t,a,n){function o(e){return"object"==typeof e&&e.length?e[0]:e}if(!e||!t)return e;a=a||_g.lang;if(t[e]){if("string"==typeof t[e])return o(t[e]);if(t[e][a])return o(t[e][a])}if(t[a]&&t[a][e])return o(t[a][e]);if("string"!=typeof e&&n){for(_t="",i=0;i<e.length;i++)_t+=e[i];e=_t}return o(e)},_g.hashCode=function(e){var t=5;e=encodeURIComponent(e);try{return e.split("").reduce(function(e,i){return e=(e<<t)-e+i.charCodeAt(0),e&e},0).toString(16)}catch(i){var a,n,o=0;if(0==e.length)return o;for(a=0,l=e.length;a<l;a++)n=e.charCodeAt(a),o=(o<<t)-o+n,o|=0;return o.toString(16)}},String.prototype.hashCode=function(){return _g.hashCode(this)},String.prototype.filter=function(){return _g.stringFilter(this)},String.prototype.filterCensored=function(){return _g.stringFilterCensored(this)},String.prototype.escape=function(){return $("<div />").text(this).html()};var _tmpl={"export":function(e,t){return e.attr&&t?e.prop("outerHTML"):e.attr&&!t?e:!e.attr&&t?e:e.attr||t?void 0:$(e)}},_hotkey={allowed:!0,keyCodeBindings:{}};_hotkey.bind=function(e,t,i,a){if("function"==typeof t)return _hotkey.bind(e,null,t,i);if(!e||!i)return!1;e=parseInt(e),t="text"==typeof t?[t]:t||[],a=a||{},"undefined"==typeof _hotkey.keyCodeBindings[e]&&(_hotkey.keyCodeBindings[e]={"default":[],meta:[],alt:[],shift:[],"meta+alt":[],"meta+shift":[],"alt+shift":[],"meta+alt+shift":[]});var n=!1,o=!1,s=!1;for(var r in t)t[r]=t[r].toLowerCase(),("ctrl"==t[r]||"meta"==t[r])&&(n=!0),"alt"==t[r]&&(o=!0),"shift"==t[r]&&(s=!0);return n&&o&&s?_hotkey.keyCodeBindings[e]["meta+alt+shift"].push(i):n&&o?_hotkey.keyCodeBindings[e]["meta+alt"].push(i):n&&s?_hotkey.keyCodeBindings[e]["meta+shift"].push(i):o&&s?_hotkey.keyCodeBindings[e]["alt+shift"].push(i):n?_hotkey.keyCodeBindings[e].meta.push(i):o?_hotkey.keyCodeBindings[e].alt.push(i):s?_hotkey.keyCodeBindings[e].shift.push(i):_hotkey.keyCodeBindings[e]["default"].push(i),!0},_hotkey._run=function(e){for(var t in e)e[t]()},_hotkey.init=function(){return _hotkey.is_init?_hotkey:($window.on("keydown._hotkey",function(e){if("INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&"SELECT"!=document.activeElement.tagName&&!document.activeElement.hasAttribute("contenteditable")&&_hotkey.allowed){var t=parseInt(e.keyCode||e.which);_hotkey.keyCodeBindings[t]&&((e.ctrlKey||e.metaKey)&&e.altKey&&e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t]["meta+alt+shift"]):(e.ctrlKey||e.metaKey)&&e.altKey?_hotkey._run(_hotkey.keyCodeBindings[t]["meta+alt"]):(e.ctrlKey||e.metaKey)&&e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t]["meta+shift"]):e.altKey&&e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t]["alt+shift"]):e.ctrlKey||e.metaKey?_hotkey._run(_hotkey.keyCodeBindings[t].meta):e.altKey?_hotkey._run(_hotkey.keyCodeBindings[t].alt):e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t].shift):e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||_hotkey._run(_hotkey.keyCodeBindings[t]["default"]))}}),void(_hotkey.is_init=!0))};var _form={};_form.section=function(e,t,i,a,n,o){if(!e)return!1;if("object"==typeof e)return _form.section(e.type,e.name||null,e.label||null,e.value||null,e.suffix||null,e);if("object"==typeof t)return _form.section(e,t,t.label||null,t.value||null,t.suffix||null,t);if("object"==typeof i)return _form.section(e,t,i.label||null,i.value||null,i.suffix||null,i);if("object"==typeof a)return _form.section(e,t,d,a.value||null,a.suffix||null,a);if("object"==typeof n)return _form.section(e,t,d,a||null,n.suffix||null,n);o=o||{};var s=$("<dl/>").addClass(e,o.className),r=$("<dt/>").appendTo(s),l=$("<dd/>").appendTo(s),d="_input_g"+_g.inputIndex;switch(_g.inputIndex++,e){case"directory":$("<label/>").html(i).appendTo(r);break;default:n?$("<label/>").html(i).appendTo(r):$('<label for="'+d+'"/>').html(i).appendTo(r)}return _form.element(e,t,d,a,o).appendTo(l),n&&$('<label for="'+d+'"/>').html(n).appendTo(l),o.add&&l.append(o.add),l},_form.line=_form.section,_form.element=function(e,t,i,a,n){if(!e)return!1;if("object"==typeof e)return _form.element(e.type,e.name||null,e.id||null,e.value||null,e);if("object"==typeof t)return _form.element(e,t,t.id||null,t.value||null,t);if("object"==typeof i)return _form.element(e,t,i.id||null,i.value||null,i);if("object"==typeof a)return _form.element(e,t,i,a.value||null,a);n=n||{},i=i||null,null===i&&(i="_input_g"+_g.inputIndex,_g.inputIndex++);var o=$(),s=n["default"]||n.defaultValue;switch(e){default:o=$("<input/>",{type:e,name:t,id:i}).val(a);break;case"select":o=$("<select/>",{name:t,id:i}).val(a);var r=$('<option value=""/>').appendTo(o);for(var l in a){if("object"==typeof a[l])var d=a[l].value||a[l].val,p=$('<option value="'+d+'"/>').html(a[l].title||a[l].name).appendTo(o);else var d=a[l],p=$('<option value="'+d+'"/>').html(d).appendTo(o);"undefined"!=typeof s&&d==s&&p.prop("selected",!0),p.val()||p.attr("disabled",!0)}a&&a.length||r.html("..."),n["new"]&&($('<option value="" disabled/>').html("==========").insertAfter(r),$('<option value="___new___"/>').html("+ 新建").insertAfter(r),o.on("change.___new___",function(){"___new___"==o.val()&&(o.val(""),n["new"](o))}));break;case"select_group":case"selectGroup":o=$("<select/>",{name:t,id:i}).val(a);var r=$('<option value=""/>').appendTo(o);for(var l in a){var m=$('<optgroup label="'+a[l][0]+'"/>').appendTo(o);for(var u in a[l][1]){var c=a[l][1][u];if("object"==typeof c)var p=$('<option value="'+("undefined"==typeof c.val?c.value:c.val)+'"/>').html(c.title||c.name).appendTo(m);else var p=$('<option value="'+c+'"/>').html(c).appendTo(m);"undefined"!=typeof s&&p.val()==s&&p.prop("selected",!0),p.val()||p.attr("disabled",!0)}}a&&a.length||r.html("..."),n["new"]&&($('<option value="" disabled/>').html("==========").insertAfter(r),$('<option value="___new___"/>').html("+ 新建").insertAfter(r),o.on("change.___new___",function(){"___new___"==o.val()&&(o.val(""),n["new"](o))}));break;case"checkbox":o=$("<input/>",{type:e,name:t,id:i}),"string"==typeof a&&"true"!==a.toLowerCase()?o.val(a).prop("checked",n.checked):o.prop("checked","undefined"==typeof n.checked?a:n.checked);break;case"checkboxes":for(var l in a){var d=a[l];"object"!=typeof d&&(d=[d,!1]),parseInt(l)&&(_g.inputIndex++,i="_input_g"+_g.inputIndex),o=o.add($('<input type="checkbox" name="'+t+'" id="'+i+'" value="'+d[0]+'" />').prop("checked",d[1])).add($('<label for="'+i+'"/>').html(d[2]||d[0]))}break;case"directory":case"file":o=$('<input type="text" name="'+t+'" id="'+i+'" />').on({input:function(){o.trigger("change")},click:function(){o.val()||_.trigger("click")}}).val(a);var h=$('<input type="file" class="none"'+("directory"==e?" nwdirectory":"")+" />").on("change",function(){o.val($(this).val()).trigger("change")}),_=$('<button type="button" value="Browse..."/>').html("Browse...").on("click",function(){h.trigger("click")}),f=o.add(h).add(_);n.accept&&h.attr("accept",n.accept)}return n.required&&o.prop("required",!0),n.onchange&&(o.on("change.___onchange___",n.onchange),n["default"]&&o.trigger("change")),f?f:o},_frame.dom={},_frame.main={last:{}},_frame.global={key_registerd:[],esc_funcs:[],allowKeyNav:!0,esc_register:function(e){_frame.global.esc_funcs.push(e)},disableBodyScroll:function(){$(document.body).on("touchmove.disableBodyScroll mousewheel.disableBodyScroll",function(e){e.preventDefault(),e.stopPropagation()})},enableBodyScroll:function(){$(document.body).off("touchmove.disableBodyScroll mousewheel.disableBodyScroll")}},_frame.global.init=function(){return _frame.global.is_init?!0:(_frame.dom={layout:$("#layout")},$body.on({"keydown.esckey":function(e){if("INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&"SELECT"!=document.activeElement.tagName&&!$(document.activeElement).attr("contenteditable")&&_frame.global.allowKeyNav){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var t=window.event?e.keyCode:e.which;t=t.toString()}}else if(!_frame.global.allowKeyNav&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var t=window.event?e.keyCode:e.which;switch(t=t.toString()){case"27":for(var i=0;i<_frame.global.esc_funcs.length;i++)_frame.global.esc_funcs[i]()}}}}),_frame.dom.hidden=$("<div/>",{"class":"none"}).appendTo($body),_frame.dom.hiddenVisible=$("<div/>",{"class":"none-visible"}).appendTo($body),_frame.dom.hiddenIframe=$("<iframe/>",{"class":"none",name:"hiddeniframe"}).appendTo($body),$body.on("submit.check_submitting_status","form",function(e){var t=$(this);(t.hasClass("submitting")||t.hasClass("loading")||t.hasClass("disabled"))&&e.preventDefault();
}),_frame.global.is_init=!0,!0)};var _menu=function(e){this.settings||(this.settings=$.extend(!0,{},this.defaults,e||{}),this.init())};_menu.prototype.defaults={items:[],target:null,className:null,showBlured:!0},_menu.prototype.init=function(){var e=this;this.dom={},this.dom.menu=$('<div class="menu"/>').addClass(this.settings.className).on("click",function(){e.timeout_hideself||(e.timeout_hideself=setTimeout(function(){e.timeout_hideself=null,e.hide()},10))}).appendTo(_frame.menu.dom.container),this.dom.body=$('<div class="body"/>').appendTo(this.dom.menu),this.dom.menu.on({"transitionend.menu_hide webkitTransitionEnd.menu_hide mozTransitionEnd.menu_hide":function(t){t.currentTarget==t.target&&"opacity"==t.originalEvent.propertyName&&0===parseFloat(e.dom.menu.css("opacity"))&&e.hideTrue()}});for(var t in this.settings.items){var i=e.settings.items[t];switch(i){case"separator":i=$("<hr/>")}i.hasClass("donot_hide")&&i.on("click",function(){setTimeout(function(){clearTimeout(e.timeout_hideself),e.timeout_hideself=null},1)}),e.appendItem(i)}_frame.menu.menus.push(this)},_menu.prototype.show=function(e,t,i){if(this.showing)return this;if("number"==typeof e)return this.show("mouse",e,t);var a,n,o,s,r,l;if(e=e||this.settings.target,clearTimeout(_frame.menu.timeout_hideall),_frame.menu.timeout_hideall=null,this.dom.menu.addClass("show"),_frame.menu.dom.container.addClass("on"),this.showing=!0,this.dom.body.children().trigger("show"),e&&e instanceof jQuery){var d=e.offset();a=d.top+e.height()-$body.scrollTop(),n=d.left-$body.scrollLeft()}else("mouse"==e||!e&&"number"==typeof t)&&(n=t||0,a=i+5||0);o=$window.height()-10,s=$window.width()-10,r=this.dom.menu.outerHeight(),l=this.dom.menu.outerWidth(),this.dom.menu.css({top:a+r>o?o-r:a,left:n+l>s?s-l:n}),this.settings.showBlured&&"undefined"!=typeof node?node.win.capturePage(this.capturePage_callback.bind(this),"jpg","datauri"):this.dom.menu.addClass("on")},_menu.prototype.hide=function(){return this.showing?void this.dom.menu.removeClass("on"):!1},_menu.prototype.hideTrue=function(){this.dom.menu.removeClass("show").css({top:"",left:""}),this.dom.blured instanceof jQuery&&(this.dom.blured.remove(),delete this.dom.blured),this.showing=!1,_frame.menu.dom.container.removeClass("on")},_menu.prototype.appendItem=function(e){return e instanceof jQuery?e.appendTo(this.dom.body):void 0},_menu.prototype.capturePage_callback=function(e){console.log(this),this.showing&&(this.dom.blured=$('<s class="blured"/>').css("background-image","url("+e+")").appendTo(this.dom.menu.addClass("on")))},_frame.menu={dom:{},menus:[],init:function(){return this.is_init?this:(this.dom.container=$('<div class="menus"/>').on({click:function(e,t){_frame.menu.timeout_hideall=setTimeout(function(){for(var e in _frame.menu.menus)_frame.menu.menus[e].hide&&_frame.menu.menus[e].hide();_frame.menu.timeout_hideall=null},t||1)},contextmenu:function(){_frame.menu.dom.container.trigger("click")}}).appendTo($body),$body.on("click.cancel_hideall",".menus>.menu",function(e){clearTimeout(_frame.menu.timeout_hideall),_frame.menu.timeout_hideall=null}),void(this.is_init=!0))}},_frame.modal={dom:{},defaults:{classname:"",showBlured:!0},show:function(e,t,i,a){clearTimeout(_frame.modal.hide_timeout),_frame.modal.hide_timeout=null,_frame.modal.dom.container.addClass("show"),_frame.modal.showing=!0;var n=$.extend({},_frame.modal.defaults,i);e.appendTo(_frame.modal.dom.content),t?(_frame.modal.dom.titlebar.html(t),_frame.modal.dom.container.addClass("hastitle")):(_frame.modal.dom.titlebar.html(""),_frame.modal.dom.container.removeClass("hastitle")),_frame.modal.dom.box.css({width:n.width||null,height:n.height||null}),n.showBlured&&(_frame.modal.dom.blured||node.win.capturePage(function(e){_frame.modal.dom.blured=$("<img/>").attr("src",e).appendTo(_frame.modal.dom.bg)},"jpg","datauri"),_frame.modal.dom.container.addClass("bluredbg")),_frame.modal.dom.container.addClass("on "+n.classname).data("customclass",n.classname),_p.initDOM(_frame.modal.dom.content),_frame.modal.dom.bg.off("click.blank_to_close").on("click.blank_to_close",function(){n.blank_to_close&&_frame.modal.dom.btn_close.trigger("click")}),a&&a(_frame.modal.dom.content)},hide:function(){return _frame.modal.showing?(clearTimeout(_frame.modal.hide_timeout),_frame.modal.hide_timeout=null,void _frame.modal.dom.container.removeClass("on")):!1},reset:function(){_frame.modal.resetContent(),_frame.modal.dom.blured&&(parseInt(_frame.modal.dom.container.css("opacity"))||(_frame.modal.dom.blured.remove(),_frame.modal.dom.blured=null),_frame.modal.dom.container.removeClass("bluredbg"))},resetContent:function(){_frame.modal.dom.content.empty(),_frame.modal.dom.container.removeClass(_frame.modal.dom.container.data("customclass")),_frame.modal.dom.container.data("customclass",""),_frame.modal.dom.titlebar.html(""),_frame.modal.dom.container.removeClass("hastitle")}},_frame.modal.init=function(){return _frame.modal.is_init?!0:(_frame.modal.dom.container=$('<div class="modal" />').on({"transitionend.modal_hide webkitTransitionEnd.modal_hide mozTransitionEnd.modal_hide":function(e){_frame.modal.showing&&e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&parseFloat($(this).css("opacity"))<=0&&(_frame.modal.hide_timeout=setTimeout(function(){_frame.modal.reset(),_frame.modal.dom.container.removeClass("show"),_frame.modal.showing=!1},10))}}).prependTo($body),_frame.modal.dom.box=$("<div/>").appendTo(_frame.modal.dom.container),_frame.modal.dom.titlebar=$("<header/>").appendTo(_frame.modal.dom.box),_frame.modal.dom.content=$("<section/>").appendTo(_frame.modal.dom.box),_frame.modal.dom.btn_close=$('<button class="close" />').html("&times;").on("click",function(){_frame.modal.hide()}).appendTo(_frame.modal.dom.box),_frame.modal.dom.bg=$("<s/>").appendTo(_frame.modal.dom.container),_hotkey.bind("27",function(){_frame.modal.hide()}),_frame.modal.is_init=!0,!0)},_p.tip={pos:"bottom",size_indicator:8,filters:[],countdown_fade:250,init_global:function(){return _p.tip.is_init?!1:(_p.tip.dom=$('<div id="tip"/>').on("transitionend webkitTransitionEnd mozTransitionEnd",function(e){e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&0==parseFloat(_p.tip.dom.css("opacity"))&&(_p.tip.dom.removeClass("show").css({top:"",left:""}).attr({"data-tip-indicator-pos":"","data-tip-indicator-offset-x":"","data-tip-indicator-offset-y":""}),_p.tip.dom_bluredbg.css("background-image",""))}).appendTo($body),_p.tip.dom_body=$('<div class="body"/>').appendTo(_p.tip.dom),_p.tip.dom_bluredbg=$("<div/>").appendTo($('<div class="bluredbg"/>').appendTo(_p.tip.dom)),void(_p.tip.is_init=!0))},show:function(e,t,i){return $("body").data("preventMouseover")||!e?!1:(clearTimeout(_p.tip.timeout_fade),_p.tip.timeout_fade=null,t=t||"body",_p.tip.el=$(t),i=i||_p.tip.pos,e=_p.tip.content(e),_p.tip.init_global(),_p.tip.dom.hasClass("show")||("undefined"!=typeof node&&node.win.capturePage(function(e){_p.tip.dom_bluredbg.css("background-image","url("+e+")")},"jpg","datauri"),_p.tip.dom.addClass("show")),_p.tip.position(e,i),void(_p.tip.is_showing=!0))},position:function(e,t){var i=e.hashCode();_p.tip.curContent!=i&&(_p.tip.dom.css({top:"-1000px",left:"-1000px"}),_p.tip.dom_body.html(e),_p.initDOM(_p.tip.dom_body),_p.tip.curContent=i);var a=_p.tip["pos_"+t](_p.tip.dom.outerWidth(),_p.tip.dom.outerHeight());a&&_p.tip.move(a.x,a.y)},hide:function(e){return _p.tip.is_init&&_p.tip.is_showing?void(_p.tip.timeout_fade=setTimeout(function(){_p.tip.el=null,_p.tip.dom.removeClass("on"),_p.tip.is_showing=!1,_p.tip.curContent=null},e?0:_p.tip.countdown_fade)):!1},content:function(e,t){return t=t||_p.tip.el,e},move:function(e,t){_p.tip.dom.css({top:t,left:e}).addClass("on")},get_indicator_size:function(){return _p.tip.size_indicator*_g.baseMultiper},pos_mouse:function(e,t){_p.tip.el.unbind("mousemove.tooltip").bind("mousemove.tooltip",function(i){var a=25,n=i.pageX+a,o=i.pageY+20,s=jQuery(window).innerWidth(),r=jQuery(window).innerHeight(),l=jQuery(window).scrollTop(),d=jQuery(window).scrollLeft();n+e+a>s+d&&(n=n-e-a-20),o+10+t>r+l&&(o=r+l-t-10),_p.tip.move(n,o)})},pos_bottom:function(e,t){var i=_p.tip.el,a=_p.tip.dom,n=i.offset(),o=n.left+(i.outerWidth()-a.outerWidth())/2,s=n.top+i.outerHeight()+_p.tip.get_indicator_size();return _p.tip.dom.attr("data-tip-indicator-pos","top"),_p.tip.checkpos(o,s,e,t)},pos_top:function(e,t){var i=_p.tip.el,a=_p.tip.dom,n=i.offset(),o=n.left+(i.outerWidth()-a.outerWidth())/2,s=n.top-t-_p.tip.get_indicator_size();return _p.tip.dom.attr("data-tip-indicator-pos","bottom"),_p.tip.checkpos(o,s,e,t)},pos_left:function(e,t){var i=_p.tip.el,a=_p.tip.dom,n=i.offset(),o=n.left-e-_p.tip.get_indicator_size(),s=n.top+(i.outerHeight()-a.outerHeight())/2;return _p.tip.dom.attr("data-tip-indicator-pos","right"),_p.tip.checkpos(o,s,e,t)},pos_right:function(e,t){var i=_p.tip.el,a=_p.tip.dom,n=i.offset(),o=n.left+i.outerWidth()+_p.tip.get_indicator_size(),s=n.top+(i.outerHeight()-a.outerHeight())/2;return _p.tip.dom.attr("data-tip-indicator-pos","left"),_p.tip.checkpos(o,s,e,t)},checkpos:function(e,t,i,a){var n=_p.tip.el,o=_p.tip.dom,s=n.offset(),r=e,l=t,d={x:r,y:l},p=$document.width()||$window.width();return e+i>p?d=i>s.left?{x:p-i-2,y:t}:_p.tip.pos_left(i,a):0>e&&(d=_p.tip.pos_right(i,a)),t+a>$(window).scrollTop()+$(window).height()?d=_p.tip.pos_top(i,a):t<$(window).scrollTop()&&(d=_p.tip.pos_bottom(i,a)),o.attr({"data-tip-indicator-offset-x":e-r+"px","data-tip-indicator-offset-y":t-l+"px"}),d}},_p.el.tip={init:function(){return _p.el.tip.isInit?!1:($body.on("mouseenter._tip","[data-tip]",function(){if($body_preventMouseover)return!1;var e=$(this),t=e.data("tip");e.data("tip-filtered")||(_p.tip.filters.forEach(function(e){t=e(t)||t}),e.data({tip:t,"tip-filtered":!0})),_p.tip.show(t,e,e.data("tip-position"))}).on("mouseleave._tip","[data-tip]",function(){_p.tip.hide()}).on("click._tip","[data-tip]",function(){_p.tip.hide(!0)}),void(_p.el.tip.isInit=!0))}},_p.el.links={is_init:!1,click:function(e,t){e.attr("href");return e.hasClass("disabled")?(t&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),!1):void 0},init:function(e){_p.el.links.is_init||($body.on("click.link_delegate","a",function(e){var t=$(this),i=t.attr("target");return this.hostname!=window.location.hostname&&(i="_external"),"_external"==i||"_blank"==i?(node.gui.Shell.openExternal($(this).attr("href")),e.preventDefault(),!0):void _p.el.links.click($(this),e)}),_p.el.links.is_init=!0)}},_p.el.form={init_el:function(e){return e.data("is_init_form_el")?!0:(e.find("textarea").on({"keyup.ctrl_enter_submit":function(t){var i=window.event?t.keyCode:t.which;switch(i=i.toString()){case"13":(t.metaKey||t.ctrlKey)&&e.submit()}}}),void e.data("is_init_form_el",!0))},init:function(e,t){e=e||$body,t=t||e.find("form"),t.each(function(){_p.el.form.init_el($(this))})}},_p.el.flexgrid={create:function(){var e=$('<div class="flexgrid"/>');return _p.el.flexgrid.init_el(e),e},init_el:function(e){if(e.data("is_init_flexgrid"))return!0;if(!e.data("append_before_this")){e.data("append_before_this",$('<div class="unit"/>').appendTo(e));for(var t=0;9>t;)$('<div class="unit"/>').appendTo(e),t++}e.data("is_init_flexgrid",!0)},init:function(e,t){e=e||$body,t=t||e.find(".flexgrid"),t.each(function(){_p.el.flexgrid.init_el($(this))})}},jQuery.fn.extend({appendDOM:function(e){return"function"==typeof e&&(e=e()),e&&e.insertBefore(this.data("append_before_this")),this}}),_p.el.table={dom:{},hover_column_getTable:function(e){function t(t){for(var i=!0;i;){var a=t;if(i=!1,"table"==e[a].tagName.toLowerCase())return $(e[a]);t=a+1,i=!0}}return t(0)},hover_column_getTr:function(e){function t(t){for(var i=!0;i;){var a=t;if(i=!1,"tr"==e[a].tagName.toLowerCase())return $(e[a]);t=a+1,i=!0}}return t(0)},hover_column_mouseenter:function(e,t){e.find("tbody tr td:nth-of-type("+(parseInt(t)+1)+")").addClass("state-hover-column")},hover_column_mouseleave:function(e,t){e.find("tbody tr td:nth-of-type("+(parseInt(t)+1)+")").removeClass("state-hover-column")},init_el:function(e){return e.data("is_init_table")?!0:void e.data("is_init_table",!0)},init:function(e,t){e=e||$body,t=t||e.find("table"),_p.el.table.is_init||($html.on("mouseenter.tablehover-column","body.hover table.hashover-column tbody td",function(e){var t=e.originalEvent.path,i=$(this).on("mouseleave.tablehover-column",function(){_p.el.table.hover_column_mouseleave(a,o),i.off("mouseleave.tablehover-column")}),a=_p.el.table.hover_column_getTable(t),n=_p.el.table.hover_column_getTr(t),o=$.inArray(i[0],n.find("td"));_p.el.table.hover_column_mouseenter(a,o)}),_p.el.table.is_init=!0),t.each(function(){_p.el.table.init_el($(this))})}},_p.el.tabview={dom:{},index:0,init_el:function(e){if(e.data("is_init_tabview"))return!0;var t="tabv"+_p.el.tabview.index,i=e.children("section"),a=$("<header/>").prependTo(e);_p.el.tabview.dom[t]=e,i.each(function(i){var n="_tabview-"+t+"-"+(i+1),o=$(this),s=o.data("tabname");$("<input />",{type:"radio",name:"_tabview-"+t,id:n,value:i+1,"class":"tabview-switch"}).data("tabview-content",o).prop("checked",0==i).on("change",function(){$(this).prop("checked")?($(this).data("tabview-content").trigger("tabview-show"),_g.uriHash("tv_"+t,i+1)):$(this).data("tabview-content").trigger("tabview-hide")}).prependTo(e),$("<label/>",{"for":n,html:s}).appendTo(a),i||o.trigger("tabview-show")}),_p.el.tabview.index++,$window.on("hashchange.tabview-"+t,function(){var e=_g.uriHash("tv_"+t);e&&_p.el.tabview.dom[t].children('input[type="radio"].tabview-switch[value="'+e+'"]').prop("checked")}),e.data("is_init_tabview",!0)},init:function(e,t){e=e||$body,t=t||e.find(".tabview"),t.each(function(){_p.el.tabview.init_el($(this))})}},$document.ready(function(){var e=_g.timeNow();$body=$("body");for(var t in _g.func_first)_g.func_first[t]();_g.init();for(var t in _g.func_last)_g.func_last[t]();var i=_g.timeNow(),a=i-e;(a>5e3||bMobile)&&$html.addClass("no-transition")}),_g.animate_duration_delay=320,_g.inputIndex=0,_g.lang="zh_cn",_g.joint="・",_g.isClient="undefined"==typeof node&&"undefined"==typeof nw?!1:!0;var _ga={counter:function(e,t,i){return debugmode?!0:this.init_count?void ga("send","pageview",{location:location.href,page:location.pathname}):void(this.init_count=!0)}},_config={getFullKeyname:function(e){return"config_"+e},get:function(e){if(!localStorage)return!1;var t=localStorage[_config.getFullKeyname(e)];return"true"===t?!0:"undefined"===t?(delete localStorage[_config.getFullKeyname(e)],null):t},set:function(e,t){return localStorage?void(null===t&&localStorage[_config.getFullKeyname(e)]?delete localStorage[_config.getFullKeyname(e)]:localStorage[_config.getFullKeyname(e)]=t):!1}};if(_frame.app_config={init:function(){return _frame.app_config.is_init?!0:void(_frame.app_config.is_init=!0)}},"undefined"==typeof _g)var _g={};_g.lang=_g.lang||"zh_cn";var Formula={equipmentType:{SmallCaliber:1,SmallCaliberHigh:2,SmallCaliberAA:3,MediumCaliber:4,LargeCaliber:5,SuperCaliber:6,SecondaryGun:7,SecondaryGunHigh:8,SecondaryGunAA:9,APShell:11,Torpedo:12,SubmarineTorpedo:13,MidgetSubmarine:14,ReconSeaplane:15,ReconSeaplaneNight:16,SeaplaneBomber:17,CarrierFighter:18,TorpedoBomber:19,DiveBomber:20,CarrierRecon:21,SmallRadar:24,LargeRadar:25,DepthCharge:26,Sonar:27,LargeSonar:28,AAGun:29,AAGunConcentrated:30,Searchlight:39,SearchlightLarge:46,SuparRadar:47},shipType:{Carriers:[9,10,11],LightCruisers:[2,3,21,28],Submarines:[13,14]},calculate:function(e,t,i,a,n,o){if(!e||!t)return 0;t instanceof Ship||(t=_g.data.ships[t]);var s=0,r={main:0,secondary:0,torpedo:0,seaplane:0,apshell:0,radar:0},l=function(){var e=0,n=!1;if($.inArray(t.type,Formula.shipType.Carriers)>-1?n=!0:i.forEach(function(e){e&&!n&&$.inArray(e.type,Formula.equipmentType.AircraftBased)>-1&&(n=!0)}),n){var o=0,s=0;return t.slot.map(function(t,n){i[n]&&(e+=1.5*i[n].stat.fire||0,i[n].type==Formula.equipmentType.TorpedoBomber&&(o+=i[n].stat.torpedo||0),i[n].type==Formula.equipmentType.DiveBomber&&(s+=i[n].stat.bomb||0),$.inArray(i[n].type,Formula.equipmentType.SecondaryGuns)>-1&&(e+=Math.sqrt(1.5*(a[n]||0))))}),o||s?e+=1.5*(1.3*s+o+t.stat.fire_max)+50:-1}e=t.stat.fire_max||0;var r=0,l=0;return t.slot.map(function(n,o){if(i[o]&&(e+=i[o].stat.fire||0,$.inArray(t.type,Formula.shipType.LightCruisers)>-1&&((4==i[o].id||65==i[o].id)&&(r+=1),(119==i[o].id||139==i[o].id)&&(l+=1)),a[o]&&$.inArray(i[o].type,Formula.equipmentType.Torpedos.concat(Formula.equipmentType.Radars))<0)){var s=1;$.inArray(i[o].type,Formula.equipmentType.AntiSubmarines)>-1&&(s=.75),$.inArray(i[o].type,Formula.equipmentType.LargeCalibers)>-1&&(s=1.5),e+=Math.sqrt(a[o])*s}}),e+2*Math.sqrt(l)+Math.sqrt(r)},d=function(){var e=0;return $.inArray(t.type,Formula.shipType.Carriers)>-1?-1:(e=t.stat.torpedo_max||0,t.slot.map(function(t,n){if(i[n]&&(e+=i[n].type==Formula.equipmentType.TorpedoBomber?0:i[n].stat.torpedo||0,a[n])){var o=0;$.inArray(i[n].type,Formula.equipmentType.Torpedos)>-1&&(o=1.2),$.inArray(i[n].type,Formula.equipmentType.AAGuns)>-1&&(o=1),e+=Math.sqrt(a[n])*o}}),e)},p=0;switch(i=i.map(function(e){return e?e instanceof Equipment?e:_g.data.items[e]:null})||[],a=a||[],n=n||[],o=o||{},i.forEach(function(e){e&&($.inArray(e.type,Formula.equipmentType.MainGuns)>-1?r.main+=1:$.inArray(e.type,Formula.equipmentType.SecondaryGuns)>-1?r.secondary+=1:$.inArray(e.type,Formula.equipmentType.Torpedos)>-1?r.torpedo+=1:$.inArray(e.type,Formula.equipmentType.Seaplanes)>-1?r.seaplane+=1:e.type==Formula.equipmentType.APShell?r.apshell+=1:$.inArray(e.type,Formula.equipmentType.Radars)>-1&&(r.radar+=1))}),e){case"fighterPower":return p=0,t.slot.map(function(e,t){if(i[t]&&$.inArray(i[t].type,Formula.equipmentType.Fighters)>-1&&e){if(p=Math.sqrt(e)*(i[t].stat.aa||0),i[t].type==Formula.equipmentType.CarrierFighter)switch(n[t]){case 1:case"1":p+=1;break;case 2:case"2":p+=4;break;case 3:case"3":p+=6;break;case 4:case"4":p+=11;break;case 5:case"5":p+=16;break;case 6:case"6":p+=17;break;case 7:case"7":p+=25}else if(-1==$.inArray(i[t].type,Formula.equipmentType.Recons)){var a=i[t].type==Formula.equipmentType.SeaplaneBomber?9:3;p+=1==n[t]?1:a/6*(n[t]-1)}s+=Math.floor(p)}}),s;case"shelling":case"shellingDamage":return $.inArray(t.type,Formula.shipType.Submarines)>-1?"-":(s=l(),s&&s>-1?Math.floor(s)+5:"-");case"torpedo":case"torpedoDamage":return s=d(),s&&s>-1?Math.floor(s)+5:"-";case"nightBattle":return $.inArray(t.type,Formula.shipType.Carriers)>-1?"-":(console.log(r),s=l()+d(),r.torpedo>=2?"雷击CI "+Math.floor(1.5*s)+" x 2":r.main>=3?"炮击CI "+Math.floor(2*s):2==r.main&&r.secondary>=1?"炮击CI "+Math.floor(1.75*s):r.main>=1&&1==r.torpedo?"炮雷CI "+Math.floor(1.3*s)+" x 2":2==r.main&&r.secondary<=0&&r.torpedo<=0||1==r.main&&r.secondary>=1&&r.torpedo<=0||0==r.main&&r.secondary>=2&&r.torpedo>=0?"连击 "+Math.floor(1.2*s)+" x 2":"通常 "+Math.floor(s));case"addHit":return t.slot.map(function(e,t){i[t]&&(s+=i[t].stat.hit||0)}),s>=0?"+"+s:s;case"addArmor":return t.slot.map(function(e,t){i[t]&&(s+=i[t].stat.armor||0)}),s;case"addEvasion":return t.slot.map(function(e,t){i[t]&&(s+=i[t].stat.evasion||0)}),s}return"-"}};Formula.equipmentType.MainGuns=[Formula.equipmentType.SmallCaliber,Formula.equipmentType.SmallCaliberHigh,Formula.equipmentType.SmallCaliberAA,Formula.equipmentType.MediumCaliber,Formula.equipmentType.LargeCaliber,Formula.equipmentType.SuperCaliber],Formula.equipmentType.LargeCalibers=[Formula.equipmentType.LargeCaliber,Formula.equipmentType.SuperCaliber],Formula.equipmentType.SecondaryGuns=[Formula.equipmentType.SecondaryGun,Formula.equipmentType.SecondaryGunHigh,Formula.equipmentType.SecondaryGunAA],Formula.equipmentType.Torpedos=[Formula.equipmentType.Torpedo,Formula.equipmentType.SubmarineTorpedo],Formula.equipmentType.Seaplanes=[Formula.equipmentType.ReconSeaplane,Formula.equipmentType.ReconSeaplaneNight,Formula.equipmentType.SeaplaneBomber],Formula.equipmentType.Fighters=[Formula.equipmentType.SeaplaneBomber,Formula.equipmentType.CarrierFighter,Formula.equipmentType.TorpedoBomber,Formula.equipmentType.DiveBomber,Formula.equipmentType.CarrierRecon],Formula.equipmentType.Recons=[Formula.equipmentType.ReconSeaplane,Formula.equipmentType.ReconSeaplaneNight,Formula.equipmentType.CarrierRecon],Formula.equipmentType.AircraftBased=[Formula.equipmentType.CarrierFighter,Formula.equipmentType.TorpedoBomber,Formula.equipmentType.DiveBomber,Formula.equipmentType.CarrierRecon],Formula.equipmentType.Radars=[Formula.equipmentType.SmallRadar,Formula.equipmentType.LargeRadar,Formula.equipmentType.SuparRadar],Formula.equipmentType.AntiSubmarines=[Formula.equipmentType.DepthCharge,Formula.equipmentType.Sonar,Formula.equipmentType.LargeSonar],Formula.equipmentType.AAGuns=[Formula.equipmentType.AAGun,Formula.equipmentType.AAGunConcentrated],Formula.equipmentType.Searchlights=[Formula.equipmentType.Searchlight,Formula.equipmentType.SearchlightLarge],Formula.shellingDamage=function(e,t,i,a){return this.calculate("shellingDamage",e,t,i,a)},Formula.torpedoDamage=function(e,t,i,a){return this.calculate("torpedoDamage",e,t,i,a)},Formula.fighterPower=function(e,t,i,a){return this.calculate("fighterPower",e,t,i,a)},Formula.nightBattle=function(e,t,i,a){return this.calculate("nightBattle",e,t,i,a)},Formula.addHit=function(e,t,i,a){return this.calculate("addHit",e,t,i,a)},Formula.addArmor=function(e,t,i,a){return this.calculate("addArmor",e,t,i,a)},Formula.addEvasion=function(e,t,i,a){return this.calculate("addEvasion",e,t,i,a)};var ItemBase=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getName",value:function(e){return e=e||_g.lang,this.name?this.name[e]||this.name:null}},{key:"_name",get:function(){return this.getName()}}]),e}(),Entity=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),$.extend(!0,this,e)}return _inherits(t,e),t}(ItemBase),Equipment=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),$.extend(!0,this,e)}return _inherits(t,e),_createClass(t,[{key:"getName",value:function(e,t){t=t||_g.lang;var i=ItemBase.prototype.getName.call(this,t),a=e&&!e==!0?e:"small";return e?i.replace(/（([^（^）]+)）/g,"<"+a+">($1)</"+a+">"):i}},{key:"getType",value:function(e){return e=e||_g.lang,this.type?_g.data.item_types[this.type].name[e]:null}},{key:"getIconId",value:function(){return _g.data.item_types[this.type].icon}},{key:"getCaliber",value:function(){var e=this.getName(!1,"ja_jp"),t=parseFloat(e);return t}},{key:"getPower",value:function(){return this.stat[_g.data.item_types[this.type].main_attribute||"fire"]}},{key:"_icon",get:function(){return"assets/images/itemicon/"+this.getIconId()+".png"}}]),t}(ItemBase),Ship=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),$.extend(!0,this,e)}return _inherits(t,e),_createClass(t,[{key:"getName",value:function(e,t){e=e||"",t=t||_g.lang;var i=this.getSuffix(t);return(this.name[t]||this.name.ja_jp)+(i?(e===!0?_g.joint:e)+i:"")}},{key:"getNameNoSuffix",value:function(e){return e=e||_g.lang,this.name[e]||this.name.ja_jp}},{key:"getSuffix",value:function(e){return e=e||_g.lang,this.name.suffix?_g.data.ship_namesuffix[this.name.suffix][e]||_g.data.ship_namesuffix[this.name.suffix].ja_jp||"":""}},{key:"getType",value:function(e){return e=e||_g.lang,this.type?_g.data.ship_types[this.type].full_zh:null}},{key:"getSeriesData",value:function(){return this.series?_g.data.ship_series[this.series].ships:[{id:this.id}]}},{key:"getPic",value:function(e){var t=this.getSeriesData();e=parseInt(e||0);for(var i=0;i<t.length;i++)if(t[i].id==this.id){switch(e){case 0:case 1:case 2:case 3:case 12:case 13:case 14:return node.path.join(_g.path.pics.ships,this.id+"/"+e+".webp");default:return t[i].illust_delete?node.path.join(_g.path.pics.ships,t[i-1].id+"/"+e+".webp"):node.path.join(_g.path.pics.ships,this.id+"/"+e+".webp")}break}}},{key:"getSpeed",value:function(e){return e=e||_g.lang,_g.statSpeed[parseInt(this.stat.speed)]}},{key:"getRange",value:function(e){return e=e||_g.lang,_g.statRange[parseInt(this.stat.range)]}},{key:"getEquipmentTypes",value:function(){return _g.data.ship_types[this.type].equipable.concat(this.additional_item_types||[]).sort(function(e,t){return e-t})}},{key:"getAttribute",value:function(e,t){t=t||1,t>150&&(t=150);var i=function(e,t,i){return e=e||1,t=parseFloat(t),i=parseFloat(i)||t,0>t||0>i?-1:Math.floor(t+(i-t)*e/99)},a=void 0;switch(e){case"hp":return a=this.stat.hp,t>99&&(a=this.stat.hp>=90?this.stat.hp+9:this.stat.hp>=70?this.stat.hp+8:this.stat.hp>=50?this.stat.hp+7:this.stat.hp>=40?this.stat.hp+6:this.stat.hp>=30?this.stat.hp+5:this.stat.hp+4,a>this.stat.hp_max&&(a=this.stat.hp_max)),a;case"speed":return _g.getStatSpeed(this.stat.speed);case"range":return _g.getStatRange(this.stat.range);case"luck":return t>99?this.stat.luck+3:this.stat.luck;case"fuel":case"ammo":return t>99?Math.floor(.85*this.consum[e]):this.consum[e];case"aa":case"armor":case"fire":case"torpedo":return this.stat[e+"_max"]||this.stat[e];default:return i(t,this.stat[e],this.stat[e+"_max"])}}},{key:"getRel",value:function(e){if(e){if(!this.rels[e]&&this.remodel&&this.remodel.prev)for(var t=_g.data.ships[this.remodel.prev];t;){if(t.rels&&t.rels[e])return t.rels[e];t=t.remodel&&t.remodel.prev?_g.data.ships[t.remodel.prev]:null}return this.rels[e]}return this.rels}},{key:"getCV",value:function(e){var t=this.getRel("cv");return t?_g.data.entities[t].getName(e||_g.lang):void 0}},{key:"getIllustrator",value:function(e){var t=this.getRel("illustrator");return t?_g.data.entities[t].getName(e||_g.lang):void 0}},{key:"_type",get:function(){return this.getType()}},{key:"_pics",get:function(){for(var e=[],t=0;15>t;t++)e.push(this.getPic(t));return e}},{key:"_speed",get:function(){return this.getSpeed()}},{key:"_range",get:function(){return this.getRange()}},{key:"_cv",get:function(){return this.getCV()}},{key:"_illustrator",get:function(){return this.getIllustrator()}}]),t}(ItemBase);_g.kancolle_calc={version:3,decode:function(e,t){if(e&&("string"==typeof e&&(e=JSON.parse(e)),"object"==typeof e)){t=parseInt(e.version)||this.version;var i=void 0,a=0,n=0,o=0,s=void 0,r=void 0,l=void 0;switch(t){case 3:for(i=[],a=0;s=e["f"+(a+1)];){for(i[a]=[],n=0;r=s["s"+(n+1)];){if(r.id&&(i[a][n]=[r.id,[r.lv||null,r.luck||-1],[],[],[]]),r.items)for(o=0;l=r.items["i"+(o+1)];)l.id&&(i[a][n][2][o]=l.id,i[a][n][3][o]=l.rf||null,i[a][n][4][o]=l.rp||null),o++;n++}a++}}return i}},encode:function(e,t){if(e&&(e.length&&e.push||(e=JSON.parse(e)),e.length&&e.push)){t=parseInt(t)||this.version;var i=void 0;switch(t){case 3:i={version:3},e.forEach(function(e,t){i["f"+(t+1)]={},e.forEach(function(e,a){e[0]&&(i["f"+(t+1)]["s"+(a+1)]={id:parseInt(e[0]),lv:parseInt(e[1][0])||null,luck:parseInt(e[1][1])||-1,items:{ix:{}}},e[2].forEach(function(n,o){n&&(i["f"+(t+1)]["s"+(a+1)].items["i"+(o+1)]={id:parseInt(n)},e[3]&&(i["f"+(t+1)]["s"+(a+1)].items["i"+(o+1)].rf=parseInt(e[3][o])||0),e[4]&&(i["f"+(t+1)]["s"+(a+1)].items["i"+(o+1)].rp=parseInt(e[4][o])||0))}))})})}return i}}},_g.bgimg_count=0,_g.event={animationend:"animationend webkitAnimationEnd",animationiteration:"animationiteration webkitAnimationIteration",transitionend:"transitionend webkitTransitionEnd mozTransitionEnd"},_g.path={db:"/!/db/",bgimg_dir:"/!/assets/images/homebg/",pics:{ships:"/!/pics/ships/",items:"/!/pics/items/"}},_g.dbs=["ships","ship_types","ship_series","ship_namesuffix","items","item_types"],_g.data={};var _db={fleets:new Nedb({filename:"fleets"})};Nedb.prototype.updateById=function(e,t,i){this._updateByIdQueue||(this._updateByIdQueue={},Object.defineProperty(this._updateByIdQueue,"running",{enumerable:!1,value:!1,writable:!0})),t=t||{},t._id=e,this._updateByIdQueue[e]={docReplace:t,callback:i||function(){}},this._updateById()},Nedb.prototype._updateById=function(){if(!this._updateByIdQueue||this._updateByIdQueue.running)return!1;var e=void 0;for(var t in this._updateByIdQueue)if(this._updateByIdQueue[t]){e=t;break}if(!e)return!1;var i=this._updateByIdQueue[e];this._updateByIdQueue[e]=null,delete this._updateByIdQueue[e],this._updateByIdQueue.running=!0,this.update({_id:e},i.docReplace,{},function(e,t){i.callback.call(this,e,t),this._updateByIdQueue.running=!1,this._updateById()}.bind(this))},_g.statSpeed={5:"低速",10:"高速"},_g.statRange={1:"短",2:"中",3:"长",4:"超长"},_g.textRank={1:"|",2:"||",3:"|||",4:"\\",5:"\\\\",6:"\\\\\\",7:"》"},_g.getStatSpeed=function(e){return e=parseInt(e),_g.statSpeed[e]},_g.getStatRange=function(e){return e=parseInt(e),_g.statRange[e]},_g.log=function(){console.log.apply(console,arguments)},_g.parseURI=function(e){e=e||location.pathname;var t=e.split("/").filter(function(e){return e});if(1==t.length)return{page:t[0]};if(2==t.length){var i=t[0];switch(i){case"ships":i="ship";break;case"equipments":i="equipment";break;case"entities":i="entity";break;case"fleets":i="fleet"}return{infos:i,id:t[1]}}},_g.state2URI=function(e){if(!e)return"/";if(e.page)return"/"+e.page+"/";if(e.infos){var t=e.infos;switch(t){case"ship":t="ships";break;case"equipment":t="equipments";break;case"entity":t="entities";break;case"fleet":t="fleets"}return"/"+t+"/"+e.id+"/"}},_frame.app_main={page:{},page_dom:{},page_html:{},page_title:{},bgimgs:[],loading:["dbs","bgimgs"],functions_on_ready:[],loaded:function(e,t){if(_g.log(e+" loaded."),e){var i=_frame.app_main.loading.indexOf(e);i>-1&&(_frame.app_main.loading.splice(_frame.app_main.loading.indexOf(e),1),_frame.app_main.is_loaded=!1)}_frame.app_main.loading.length||_frame.app_main.is_loaded||(setTimeout(function(){!_frame.app_main.is_loaded||_frame.app_main.loading.length||$html.hasClass("app-ready")||(_frame.dom.layout.addClass("ready"),$html.addClass("app-ready"),setTimeout(function(){for(var e=0;e<_frame.app_main.functions_on_ready.length;e++)_frame.app_main.functions_on_ready[e]()},1500))},t?300:1e3),this.window_event_bound||($window.on("popstate._global",function(e){e.originalEvent&&e.originalEvent.state?_frame.app_main.state(e.originalEvent.state):_frame.app_main.state(_g.parseURI())}).trigger("popstate._global"),this.window_event_bound=!0),_frame.app_main.is_loaded=!0)},pushState:function(e,t,i){history.pushState(e,t,i),console.log(e)},state:function(e){e.infos?_frame.infos.show_func(e.infos,e.id,null,e.infosHistoryIndex):_frame.infos.hide(),e.page&&this.load_page_func(e.page)},change_bgimg:function(e){if(!_frame.app_main.bgimgs.length)return!1;var t=e&&e.length?e:_frame.app_main.bgimgs,i=t[_g.randInt(t.length)],a=_frame.app_main.cur_bgimg_el?_frame.app_main.cur_bgimg_el.css("background-image"):null;for(a=a?a.split("/"):null,a=a?a[a.length-1].split(")"):null,a=a?a[0]:null;i==a;)i=t[_g.randInt(t.length-1)];var n=_g.path.bgimg_dir+"blured/"+i;this.bgimg_path=_g.path.bgimg_dir+i,i=this.bgimg_path,a&&(this.change_bgimg_oldEl=_frame.app_main.cur_bgimg_el),_frame.app_main.cur_bgimg_el=$("<div/>").css("background-image","url("+i+")").appendTo(_frame.dom.bgimg).add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.nav)).add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.main)),_frame.dom.bg_controls&&(_frame.app_main.cur_bgimg_el=_frame.app_main.cur_bgimg_el.add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.bg_controls))),_frame.app_main.change_bgimg_fadein=!0},change_bgimg_after:function(e){e=e||this.change_bgimg_oldEl,e&&(this.change_bgimg_oldEl.remove(),this.change_bgimg_oldEl=null)},toggle_hidecontent:function(){_frame.dom.layout.toggleClass("hidecontent")},loading_queue:[],loading_state:{},loading_start:function(e,t,i){e=e||location.pathname,t=t||function(){},i=i||function(){},this.loading_cur=e,"undefined"==typeof this.loading_state[e]||"fail"==this.loading_state[e]?("fail"!=this.loading_state[e]&&(this.loading_state[e]="loading"),this.loading_queue.push(e),
_frame.dom.layout.addClass("is-loading"),$.ajax({url:e,type:"get",dataType:"html",success:function(i){var a=/\<main\>(.+)\<\/main\>/.exec(i),n=/\<title\>([^\<]+)\<\/title\>/.exec(i);n&&n.length>1&&(_frame.app_main.page_title[e]=n[1]),e==_frame.app_main.loading_cur&&t(a&&a.length>1?a[1]:""),_frame.app_main.loading_state[e]="complete"},error:function(t,a,n){return n=n||"",_g.log("Loading Fail: "+e+" ["+a+"] ("+n+")"),"fail"==_frame.app_main.loading_state[e]||["Bad Request","Not Found","Forbidden"].indexOf(n)>-1?_frame.app_main.loading_fail(e,a,n,i):void(_frame.app_main.loading_state[e]="fail")},complete:function(){_frame.app_main.loading_complete(e),"fail"==_frame.app_main.loading_state[e]&&(console.log("retry"),_frame.app_main.loading_start(e,t,i))}})):"complete"==this.loading_state[e]&&t()},loading_complete:function(e){if(e){e==this.loading_cur&&(this.loading_cur=null);var t=this.loading_queue.indexOf(e);t>=0&&this.loading_queue.splice(t,1),this.loading_queue.length||_frame.dom.layout.removeClass("is-loading")}},loading_fail:function(e,t,i,a){return e?(this.loading_state&&delete this.loading_state[e],_frame.dom.layout.attr("data-errorbadge",e+" 载入失败 ("+i+")"),clearTimeout(this.loading_fail_timeout_errorbadge),this.loading_fail_timeout_errorbadge=setTimeout(function(){_frame.dom.layout.removeAttr("data-errorbadge"),delete _frame.app_main.loading_fail_timeout_errorbadge},3e3),console.log(a),a(e,t,i)):void 0},load_page:function(e,t){return _frame.app_main.cur_page!=e&&e?(t=t||{},this.pushState({page:e},null,_g.state2URI({page:e})),this.load_page_func(e,t),void(t.callback_modeSelection_select?_frame.app_main.page_dom[e].trigger("modeSelectionEnter",[t.callback_modeSelection_select||function(){},t.callback_modeSelection_enter||function(){}]):_frame.app_main.mode_selection_off())):e},load_page_func:function(e,t){function i(){return _frame.app_main.page_dom[e].trigger("show"),_frame.infos.hide(),t.callback_modeSelection_select||(_frame.app_main.title=_frame.app_main.navtitle[e],_frame.infos.last=null,console.log("/"+e+"/",_frame.app_main.page_title["/"+e+"/"]),document.title=_frame.app_main.page_title["/"+e+"/"],_ga.counter(location.search)),_frame.app_main.cur_page==e?e:(_frame.app_main.page_dom[e].removeClass("off").trigger("on"),_frame.app_main.cur_page&&(_frame.dom.navs[_frame.app_main.cur_page]&&_frame.dom.navs[_frame.app_main.cur_page].removeClass("on"),_frame.app_main.page_dom[_frame.app_main.cur_page]&&setTimeout(function(e){_frame.app_main.page_dom[e].addClass("off").trigger("pageoff")}(_frame.app_main.cur_page),100)),_frame.dom.navs[e]&&_frame.dom.navs[e].addClass("on"),t.callback_modeSelection_select||"about"!=e&&Lockr.set("last_page",e),_frame.dom.main.attr("data-theme",e),_frame.app_main.cur_page=e,void _g.log("LOADED: "+e))}if(_g.log("PREPARE LOADING: "+e),t=t||{},!e)return e;var a=!1;return"donate"==e&&(a=!0),_frame.app_main.cur_page?a=!0:_frame.app_main.nav.forEach(function(t){e==t.page&&(a=!0)}),a?void(_frame.app_main.page_dom[e]?i():(_frame.app_main.page_dom[e]=_frame.dom.main.find('.page-container[page="'+e+'"]'),_frame.app_main.page_dom[e].length?(_frame.app_main.page_init(e),_frame.app_main.page_title["/"+e+"/"]=document.title,i()):this.loading_start("/"+e+"/",function(t){_frame.app_main.page_dom[e]=$(t).appendTo(_frame.dom.main),_frame.app_main.page_init(e),i()},function(t,i,a){delete _frame.app_main.page_dom[e],history.back()}))):(e=_frame.app_main.nav[0].page,_frame.app_main.load_page(e,t),e)},only_bg_on:function(){return this.only_bg?!0:(_frame.dom.bg_controls||(_frame.dom.bg_controls=$('<div class="bg_controls"/>').on(eventName("transitionend","only_bg_off"),function(e){console.log(e),e.currentTarget==e.target&&"bottom"==e.originalEvent.propertyName&&_frame.dom.layout.hasClass("only_bg")&&_frame.dom.bg_controls.offset().top>=$body.height()&&(_frame.dom.layout.removeClass("only_bg"),_frame.app_main.only_bg=!1)}).appendTo(_frame.dom.layout),_frame.app_main.cur_bgimg_el=_frame.app_main.cur_bgimg_el.add(_frame.app_main.cur_bgimg_el.eq(0).clone().appendTo(_frame.dom.bg_controls)),$('<button class="prev" icon="arrow-left"/>').on("click",function(){var e=_frame.app_main.bgimg_path.split("/"),t=$.inArray(e[e.length-1],_frame.app_main.bgimgs)-1;0>t&&(t=_frame.app_main.bgimgs.length-1),_frame.app_main.change_bgimg([_frame.app_main.bgimgs[t]])}).appendTo(_frame.dom.bg_controls),$('<button class="back"/>').html("返回").on("click",function(){_frame.app_main.only_bg_off()}).appendTo(_frame.dom.bg_controls),$('<button class="back"/>').html("保存图片").on("click",function(){window.open(_frame.app_main.bgimg_path)}).appendTo(_frame.dom.bg_controls),$('<button class="next" icon="arrow-right"/>').on("click",function(){var e=_frame.app_main.bgimg_path.split("/"),t=$.inArray(e[e.length-1],_frame.app_main.bgimgs)+1;t>=_frame.app_main.bgimgs.length&&(t=0),_frame.app_main.change_bgimg([_frame.app_main.bgimgs[t]])}).appendTo(_frame.dom.bg_controls)),_frame.dom.layout.addClass("only_bg"),setTimeout(function(){_frame.dom.bg_controls.addClass("on")},10),void(this.only_bg=!0))},only_bg_off:function(){return this.only_bg?void _frame.dom.bg_controls.removeClass("on"):!0},only_bg_toggle:function(){return this.only_bg?this.only_bg_off():this.only_bg_on()},init:function(){if(_frame.app_main.is_init)return!0;_frame.dom.nav=_frame.dom.layout.children("nav"),_frame.dom.logo=$('<button class="logo"/>').on(_g.event.animationend,function(e){_frame.dom.logo.addClass("ready-animated")}).appendTo(_frame.dom.nav),_frame.dom.navlinks=_frame.dom.nav.children(".pages"),_frame.dom.globaloptions=_frame.dom.nav.children("section.options"),_frame.dom.btnShowOnlyBg=$('<button class="show_only_bg" icon="images"/>').on("click",function(){_frame.app_main.only_bg_toggle()}).appendTo(_frame.dom.globaloptions),_frame.dom.btnShowOnlyBgBack=$('<button class="show_only_bg_back" icon="arrow-set2-left"/>').on("click",function(){_frame.app_main.only_bg_off()}).appendTo(_frame.dom.nav),_frame.dom.main=_frame.dom.layout.children("main"),_frame.dom.bgimg=$('<div class="bgimg" />').appendTo(_frame.dom.layout);var e=Q.fcall(function(){});e.then(function(){return _frame.app_main.nav=[],_frame.app_main.navtitle={},_frame.dom.navs={},_frame.dom.navlinks.children("a").each(function(e,t){t=$(t);var i=_g.parseURI(t.attr("href")).page,a=t.text();_frame.app_main.nav.push({title:a,state:t.attr("mod-state"),page:i}),_frame.app_main.navtitle[i]=a,_frame.dom.navs[i]=t}),_frame.app_main.nav}).then(function(){for(var e=0;e<_g.bgimg_count;e++)_frame.app_main.bgimgs.push(e+".jpg");return _frame.app_main.change_bgimg(),_frame.app_main.loaded("bgimgs"),_g.log("BGs: "+_frame.app_main.bgimgs.join(", ")),_frame.app_main.bgimgs}).then(function(){_g.log("Preload All DBs (JSON ver.): START");var e=Q(),t=Q.defer();return _g.dbs.forEach(function(t){e=e.then(function(){var e=Q.defer();return $.ajax({url:"/!/db/"+t+".json",dataType:"text",success:function(e){e=LZString.decompressFromBase64(e);var i=e.split("\n");switch(t){default:"undefined"==typeof _g.data[t]&&(_g.data[t]={}),i.forEach(function(e){if(e){var i=JSON.parse(e);switch(t){case"ships":_g.data[t][i.id]=new Ship(i);break;case"items":_g.data[t][i.id]=new Equipment(i);break;case"entities":_g.data[t][i.id]=new Entity(i);break;default:_g.data[t][i.id]=i}}})}},complete:function(t,i){e.resolve()}}),e.promise})}),e=e["catch"](function(e){console.log(e)}).done(function(){_g.log("Preload All DBs (JSON ver.): DONE"),t.resolve()}),t.promise}).then(function(){_g.log("Preload All DBs: START");var e=[],t=[],i=0;for(var a in _db)t.push(a);return t.forEach(function(a){function n(e){_g.log("DB "+e+" DONE"),o.resolve(),i++,i>=t.length&&(_g.log("Preload All DBs: DONE"),setTimeout(function(){_frame.app_main.loaded("dbs")},100))}var o=Q.defer();_db[a].loadDatabase(function(e){e?o.reject(new Error(e)):_db[a].find({},function(e,t){e?o.reject(new Error(e)):("undefined"==typeof _g.data[a]&&(_g.data[a]={}),t.forEach(function(e){_g.data[a][e.id]=e}),n(a))})}),e.push(o.promise)}),Q.all(e)}).then(function(){var e=function(e){e.preventDefault(),_frame.app_main.load_page($(this).attr("href").substr("?page=".length))},t=function(e){e.preventDefault();var t=$(this);if(!t.attr("data-infos")){var i=/^[\?]{0,1}infos\=([^\&]+)\&id\=([^\&]+)/gi.exec(t.attr("href"));t.attr("data-infos","[["+i[1].toUpperCase()+"::"+i[2]+"]]"),_frame.infos.click(t)}},i=function(e){e.preventDefault();var t=$(this),i=_g.parseURI(t.attr("href"));i.page?_frame.app_main.load_page(i.page):i.infos&&_frame.infos.click(t.attr("data-infos","[["+i.infos.toUpperCase()+"::"+i.id+"]]"))};return $body.on("click.global_delegate_page",'a[href^="?page="]',e).on("click.global_delegate_infos",'a[href^="?infos="]',t).on("click.global_delegate_default",'a[href^="/"]',i),_frame.dom.bgimg.on(_g.event.animationend,"div",function(){_frame.app_main.change_bgimg_after()}),!0})["catch"](function(e){_g.error(e)}).done(function(){_g.log("Global initialization DONE")}),_frame.app_main.is_init=!0}},_g.error=function(e){e instanceof Error||(e=new Error(e)),_g.log(e)};var debugmode=!1;_frame.app_main.page_init=function(e,t){t=t||_frame.app_main.page_dom[e],_frame.app_main.page[e]&&_frame.app_main.page[e].init&&_frame.app_main.page[e].init(t),_p.initDOM(t)},_tmpl.improvement=function(e,t,i,a){if("undefined"==typeof e)return!1;if("object"!=typeof e&&!(e=_g.data.items[e]))return!1;t=t||0,i=i||[0],a=a||!1;var n=e.improvement[t],o=n.upgrade?_g.data.items[n.upgrade[0]]:!1,s=[],r="";if(i.forEach(function(e){var t=n.req[e];t[1]&&s.mergeFrom(t[1])}),s.length){var l=[];s.forEach(function(e){l.push('<a href="?infos=ship&id='+e+'" data-infos="[[SHIP::'+e+']]" data-tip="[[SHIP::'+e+']]">'+_g.data.ships[e].getName()+"</a>")}),r="<font>"+l.join(" / ")+"</font>"}else r='<font class="no">无秘书舰要求</font>';return _tmpl["export"]('<span class="improvement">'+_tmpl.improvement__title(e,o,n.upgrade[1])+r+_tmpl.improvement__resource(n,o?!0:!1)+"</span>",a)},_tmpl.improvement_detail=function(e,t){if("undefined"==typeof e)return!1;if("object"!=typeof e&&!(e=_g.data.items[e]))return!1;var i="",a=e.improvement||[];return a.forEach(function(t){var a=t.upgrade?_g.data.items[t.upgrade[0]]:!1,n=this.improvement__reqdetails(t.req);i+='<span class="improvement improvement-details">'+_tmpl.improvement__title(e,a,t.upgrade[1])+n+_tmpl.improvement__resource(t,a?!0:!1)+"</span>"},this),_tmpl["export"](i,t)},_tmpl.improvement_inEquipmentInfos=function(e,t){if("undefined"==typeof e)return!1;if("object"!=typeof e&&!(e=_g.data.items[e]))return!1;var i="",a=e.improvement||[];return a.forEach(function(e){var t=e.upgrade?_g.data.items[e.upgrade[0]]:!1,a=this.improvement__reqdetails(e.req);i+='<span class="unit improvement improvement-details"><b>'+(t?'<span class="indicator true">可升级为</span><a style="background-image:url(../app/assets/images/itemicon/'+t.getIconId()+'.png)" href="?infos=equipment&id='+t.id+'" data-infos="[[EQUIPMENT::'+t.id+']]" data-tip="[[EQUIPMENT::'+t.id+']]">'+t.getName(!0)+"</a>"+(e.upgrade[1]?"<i>+"+e.upgrade[1]+"</i>":""):'<span class="indicator false">不可升级</span>')+"</b>"+a+_tmpl.improvement__resource(e,t?!0:!1)+"</span>"},this),_tmpl["export"](i,t)},_tmpl.improvement__title=function(e,t,i){return'<strong><a style="background-image:url(../app/assets/images/itemicon/'+e.getIconId()+'.png)" href="?infos=equipment&id='+e.id+'" data-infos="[[EQUIPMENT::'+e.id+']]" data-tip="[[EQUIPMENT::'+e.id+']]">'+e.getName(!0)+"</a>"+(t?'<b></b><a style="background-image:url(../app/assets/images/itemicon/'+t.getIconId()+'.png)" href="?infos=equipment&id='+t.id+'" data-infos="[[EQUIPMENT::'+t.id+']]" data-tip="[[EQUIPMENT::'+t.id+']]">'+t.getName(!0)+"</a>"+(i?"<i>+"+i+"</i>":""):"")+"</strong>"},_tmpl.improvement__resource=function(e,t){function i(e){return e=parseInt(e),0>e?"?":e}var a={};a.all='<span><em>必要资源</em><i class="fuel">'+i(e.resource[0][0])+'</i><i class="ammo">'+i(e.resource[0][1])+'</i><i class="steel">'+i(e.resource[0][2])+'</i><i class="bauxite">'+i(e.resource[0][3])+"</i></span>";for(var n=1;4>n;n++){var o="";switch(n){case 1:o="★+0 ~ +6";break;case 2:o="★+6 ~ MAX";break;case 3:o="升级"}a[n]="<span><em>"+o+"</em>"+(3!=n||t?'<i class="dev_mat">'+i(e.resource[n][0])+"<i>("+i(e.resource[n][1])+')</i></i><i class="imp_mat">'+i(e.resource[n][2])+"<i>("+i(e.resource[n][3])+")</i></i>"+(e.resource[n][4]?'<a class="equipment" style="background-image:url(../app/assets/images/itemicon/'+_g.data.items[e.resource[n][4]].getIconId()+'.png)" href="?infos=equipment&id='+e.resource[n][4]+'" data-infos="[[EQUIPMENT::'+e.resource[n][4]+']]" data-tip="[[EQUIPMENT::'+e.resource[n][4]+']]">'+_g.data.items[e.resource[n][4]].getName(!0)+"<i>x"+i(e.resource[n][5])+"</i></a>":""):'<i class="no">-</i>')+"</span>"}return"<span>"+a.all+a[1]+a[2]+a[3]+"</span>"},_tmpl.improvement__reqdetails=function(e){if(!e||!e.push||!e.length)return"";var t="<font>";return e.forEach(function(e){var i,a=[];t+="<b>";for(var n=0;7>n;n++){switch(n){case 0:i="日";break;case 1:i="一";break;case 2:i="二";break;case 3:i="三";break;case 4:i="四";break;case 5:i="五";break;case 6:i="六"}t+="<i"+(e[0][n]?' class="on"':"")+">"+i+"</i>"}e[1]?(e[1].forEach(function(e){a.push('<a href="?infos=ship&id='+e+'" data-infos="[[SHIP::'+e+']]" data-tip="[[SHIP::'+e+']]">'+_g.data.ships[e].getName()+"</a>")}),t+=a.join(" / ")):t+="<b>无秘书舰要求</b>",t+="</b>"}),t+="</font>"},_tmpl.link_entity=function(e,t,i,a){if(!e)return!1;if(t&&"object"==typeof t)return _tmpl.link_entity(e,t.tagName||null,t.returnHTML||null,t.count||null);if(t=t||"a",i=i||!1,a="undefined"==typeof a?!1:a,"object"!=typeof e){var n=parseInt(e);e=_g.data.entities[n]}else var n=e.id;return _tmpl["export"]("<"+t+("a"==t?' href="?infos=entity&id='+n+'"':"")+' class="link_entity" data-entityid="'+n+'" data-infos="[[ENTITY::'+n+']]">'+(e.picture&&e.picture.avatar?'<i style="background-image:url('+e.picture.avatar+')"></i>':"<i></i>")+"<span>"+e._name+("undefined"==typeof a?"":" <small>("+a+")</small>")+"</span></"+t+">",i)},_tmpl.link_equipment=function(e,t,i,a){if(!e)return!1;if(t&&"object"==typeof t)return _tmpl.link_equipment(e,t.tagName||null,t.returnHTML||null,"undefined"==typeof t.improvementStar?null:t.improvementStar);if(t=t||"a",i=i||!1,a="undefined"==typeof a?null:a,"object"!=typeof e){var n=parseInt(e);e=_g.data.items[n]}else var n=e.id;return _tmpl["export"]("<"+t+("a"==t?' href="?infos=equipment&id='+n+'"':"")+' class="link_equipment" data-equipmentid="'+n+'" data-tip-position="right" data-infos="[[EQUIPMENT::'+n+']]" data-tip="[[EQUIPMENT::'+n+']]"><i style="background-image:url(assets/images/itemicon/'+e.getIconId()+'.png)"></i><span>'+e.getName(!0)+"</span>"+(null!==a?"<em"+(0>=a?' class="zero"':"")+">+"+a+"</em>":"")+"</"+t+">",i)},_tmpl.link_ship=function(e,t,i,a){if(!e)return!1;if(t&&"object"==typeof t)return _tmpl.link_ship(e,t.tagName||null,t.returnHTML||null,t.mode||null);if(t=t||"a",i=i||!1,a=a||"default","object"!=typeof e){var n=parseInt(e);e=_g.data.ships[n]}else var n=e.id;var o="",s=e.getType();switch(a){case"names":var r=[];e.getSeriesData().forEach(function(e){var t=_g.data.ships[e.id].getNameNoSuffix();$.inArray(t,r)<0&&r.push(t)}),o=r.join(" / ");break;default:o=(s?"<small>"+s+"</small>":"")+e.getName(_g.joint)}return _tmpl["export"]("<"+t+("a"==t?' href="?infos=ship&id='+n+'"':"")+' class="link_ship" data-shipid="'+n+'" data-infos="[[SHIP::'+n+']]"><img src="'+node.path.normalize(_g.path.pics.ships)+"/"+n+'/0.webp"/><span>'+o+"</span></"+t+">",i)},_tmpl.textlink_entity=function(e,t,i){if(!e)return!1;if(t&&"object"==typeof t)return _tmpl.textlink_entity(e,t.tagName||null,t.returnHTML||null);if(t=t||"a",i=i||!1,"object"!=typeof e){var a=parseInt(e);e=_g.data.entities[a]}else var a=e.id;return _tmpl["export"]("<"+t+("a"==t?' href="?infos=entity&id='+a+'"':"")+' data-entityid="'+a+'" data-infos="[[ENTITY::'+a+']]">'+e._name+"</"+t+">",i)},_tmpl.textlink_ship=function(e,t,i){if(!e)return!1;if(t&&"object"==typeof t)return _tmpl.textlink_ship(e,t.tagName||null,t.returnHTML||null);if(t=t||"a",i=i||!1,"object"!=typeof e){var a=parseInt(e);e=_g.data.ships[a]}else var a=e.id;var n=e.getType();return _tmpl["export"]("<"+t+("a"==t?' href="?infos=ship&id='+a+'"':"")+' data-shipid="'+a+'" data-infos="[[SHIP::'+a+']]">'+(n?"["+n+"] ":"")+e.getName(_g.joint)+"</"+t+">",i)};var PAGE=function(){function e(t){_classCallCheck(this,e)}return _createClass(e,[{key:"modeSelectionEnter",value:function(e,t){var i=void 0;return e=e||function(){},i=function(){e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10]),this.modeSelectionExit()}.bind(this),_frame.app_main.mode_selection_callback=i,_frame.app_main.mode_selection_on(t),i}},{key:"modeSelectionExit",value:function(){return _frame.dom.layout.hasClass("mode-selection")?void _frame.app_main.mode_selection_off():!1}}]),e}();_frame.app_main.page.fleets={init:function(e){this.object=new(function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),e.on({show:function(){this.inited&&(e.html(_frame.app_main.page_html.fleets),_p.initDOM(e)),this.inited=!0}})}return _inherits(t,e),t}(PAGE))(e)}},_frame.app_main.page.ships={init:function(e){this.object=new(function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.tablelist=e.find(".tablelist"),this.tablelistObj=this.tablelist.data("tablelist"),e.on({on:function(){this.tablelistObj||(this.tablelistObj=this.tablelist.data("tablelist")),this.tablelistObj&&this.tablelistObj.thead_redraw()}.bind(this),modeSelectionEnter:function(e,t){this.modeSelectionEnter(t)}.bind(this)})}return _inherits(t,e),t}(PAGE))(e)}},_frame.app_main.page.equipments={init:function(e){this.object=new(function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.tablelist=e.find(".tablelist"),this.tablelistObj=this.tablelist.data("tablelist"),e.on({on:function(){this.tablelistObj||(this.tablelistObj=this.tablelist.data("tablelist")),this.tablelistObj&&(this.tablelistObj.thead_redraw(),this.tablelistObj.apply_types())}.bind(this),modeSelectionEnter:function(e,t,i){this.modeSelectionEnter(t,i)}.bind(this),show:function(){this.tablelistObj&&(this.tablelistObj.thead_redraw(),this.tablelistObj.apply_types())}.bind(this)})}return _inherits(t,e),t}(PAGE))(e)}},_frame.app_main.page.arsenal={},_frame.app_main.page.arsenal.init=function(e){var t=e.find(".akashi");t.attr({animation:Math.floor(3*Math.random()+1)}).on(_g.event.animationiteration,function(){t.attr("animation",Math.floor(3*Math.random()+1))}),this.elMain=e.children(".main"),this.parse_weekday(this.elMain.children(".body-weekday")),this.parse_all(this.elMain.children(".body-all")),e.find('input[type="radio"]').on("change",function(){_frame.app_main.page.arsenal.elMain.scrollTop(0)})},_frame.app_main.page.arsenal.parse_weekday=function(e){var t=e.find("#arsenal_weekday-showmeterials");t.prop("checked",Lockr.get("arsenal_weekday-showmeterials",!0)?!0:!1).on("change",function(){Lockr.set("arsenal_weekday-showmeterials",t.prop("checked")?1:0)});var i=new Date;return i.setTime(i.getTime()+60*i.getTimezoneOffset()*1e3),i.setTime(i.getTime()+324e5),e.find("#arsenal_weekday-"+i.getDay()).prop("checked",!0),e},_frame.app_main.page.arsenal.parse_all=function(e){},_frame.app_main.page.about={},_frame.app_main.page.about.journal_parse=function(e){for(var t,i=/\[\[([^\:]+)\:([0-9]+)\]\]/gi,a=markdown.toHTML(e);null!==(t=i.exec(e));)try{a=a.replace(t[0],_tmpl["link_"+t[1].toLowerCase()](t[2],null,!0))}catch(n){}for(t=null,i=/\[\[([^\:]+)\:([0-9]+)\:TEXT\]\]/gi;null!==(t=i.exec(e));)try{a=a.replace(t[0],_tmpl["textlink_"+t[1].toLowerCase()](t[2],null,!0))}catch(n){}return a},_frame.app_main.page.about.journaltitle=function(e,t){return e=e||{},t=t||"h3","<h3>"+(e.hotfix?"HOTFIX - ":"")+("app"==e.type?"":("app-db"==e.type?"DB":e.type).toUpperCase()+" / ")+e.version+"<small>"+(e.date?e.date:"WIP")+"</small></h3>"},_frame.app_main.page.about.init=function(e){function t(t){var i=$('<section class="update_journal" data-version-'+t.type+'="'+t.version+'"/>').html(_frame.app_main.page.about.journaltitle(t)).appendTo(e);try{$(_frame.app_main.page.about.journal_parse(t.journal)).appendTo(i)}catch(a){_g.error(a),i.remove()}}var i=Q.fcall(function(){});i.then(function(){var e=Q.defer();return _db.updates.find({date:""}).sort({date:-1,version:-1}).exec(function(i,a){a.forEach(function(e){t(e)}),e.resolve(i)}),e.promise}).then(function(){var e=Q.defer();return _db.updates.find({$not:{date:""}}).sort({date:-1,version:-1}).exec(function(i,a){a.forEach(function(e){t(e)}),e.resolve(i)}),e.promise})},_frame.infos={historyLength:-1,historyCurrent:-1,contentCache:{},getContent:function(e,t,i){function a(e){return i&&i(e),e}function n(i){return _p.initDOM(i.addClass("infosbody").attr({"data-infos-type":e,"data-infos-id":t}))}if(this.contentCache[e]||(this.contentCache[e]={}),!this.firstrun){var o=_frame.infos.dom.container.children(".infosbody").eq(0);if(this.firstrun=!0,o.attr("data-infos-type")==e&&o.attr("data-infos-id")==t)return this.contentCache[e][t]=_p.initDOM(o),_frame.app_main.page_title[_g.state2URI({infos:e,id:t})]=document.title,a(this.contentCache[e][t])}return"__NEW__"==t?a(n(_frame.infos["__"+e](t))):this.contentCache[e][t]?a(this.contentCache[e][t]):void _frame.app_main.loading_start(_g.state2URI({infos:e,id:t}),function(i){var o=/\<div class\=\"wrapper\"\>(.+)\<\/div\>/.exec(i);return _frame.infos.contentCache[e][t]=n($(o.length>1?o[1]:"")),a(_frame.infos.contentCache[e][t])},function(i,a,n){"undefined"!=typeof _frame.infos.contentCache[e][t]&&delete _frame.infos.contentCache[e][t],history.back()})},show:function(e,t,i){var a=/^\[\[([^\:]+)\:\:(.+)\]\]$/.exec(e),n=null,o=null;if(!(a&&a.length>2))return!1;switch(n=a[1].toLowerCase(),o=isNaN(a[2])?a[2]:parseInt(a[2]),n){case"item":case"equip":case"equipments":n="equipment"}return this.curContent==n+"::"+o?_frame.infos.dom.container.children("div:first-child"):(i||(this.historyCurrent++,this.historyLength=this.historyCurrent,_frame.app_main.pushState({infos:n,id:o,infosHistoryIndex:_frame.infos.historyCurrent},null,_g.state2URI({infos:n,id:o}))),void this.show_func(n,o,i))},show_func:function(e,t,i,a){if(!e||!t)return!1;if(this.curContent==e+"::"+t)return _frame.infos.dom.container.children("div:first-child");e=e.toLowerCase(),t=isNaN(t)?t:parseInt(t);var n=null;_frame.infos.dom||(_frame.infos.dom={main:_frame.dom.main.children(".page-container.infos")},_frame.infos.dom.main.length?_frame.infos.dom.container=_frame.infos.dom.main.children(".wrapper"):(_frame.infos.dom.main=$('<div class="page-container infos"/>').appendTo(_frame.dom.main),_frame.infos.dom.container=$('<div class="wrapper"/>').appendTo(_frame.infos.dom.main)),_frame.dom.btnHistoryBack&&_frame.dom.btnHistoryBack.on(eventName("transitionend","infos_hide"),function(e){e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&0==parseFloat(_frame.dom.btnHistoryBack.css("opacity"))&&_frame.infos.hide_finish()})),_frame.dom.btnHistoryForward&&(a="undefined"!=typeof a?a:this.historyCurrent,this.historyCurrent=a,this.historyCurrent==this.historyLength&&this.historyCurrent>-1&&_frame.dom.btnHistoryForward.addClass("disabled")),_frame.dom.layout.addClass("is-infos-show"),this.curContent=e+"::"+t,this.getContent(e,t,function(i){switch(e){case"ship":case"equipment":case"entity":_frame.infos.dom.main.attr("data-infostype",e),n=i.attr("data-infos-title");break;case"fleet":_frame.infos.dom.main.attr("data-infostype","fleet"),_frame.app_main.mode_selection_off(),TablelistEquipments.types=[]}i.data("is_infosinit")||("ship"==e&&!function(){var e=parseInt(_config.get("ship_infos_lvl")||99);i.find('input[type="radio"][name^="ship_infos_lvl_"]').each(function(){var t=$(this),i=t.val();t.prop("checked",e==i).on("change",function(){_config.set("ship_infos_lvl",i)})})}(),i.data("is_infosinit",!0).on(eventName("transitionend","hide"),function(e){e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&0==parseInt(i.css("opacity"))&&i.detach()})),this.curContent==e+"::"+t&&(i.prependTo(_frame.infos.dom.container),_frame.app_main.cur_page&&(_frame.dom.navs[_frame.app_main.cur_page]&&_frame.dom.navs[_frame.app_main.cur_page].removeClass("on"),_frame.app_main.page_dom[_frame.app_main.cur_page]&&_frame.app_main.page_dom[_frame.app_main.cur_page].addClass("off").trigger("pageoff"),_frame.app_main.cur_page=null),_frame.dom.main.attr("data-theme",i.attr("data-theme")||e),setTimeout(function(){_frame.dom.layout.addClass("is-infos-on"),_frame.app_main.title=n,document.title=_frame.app_main.page_title[_g.state2URI({infos:e,id:t})],_frame.infos.last!=n&&_ga.counter(location.search),_frame.infos.last=n},1))}.bind(this))},hide:function(){return _frame.infos.dom&&this.curContent?(_frame.dom.layout.removeClass("is-infos-on"),_frame.dom.btnHistoryForward&&_frame.dom.btnHistoryForward.addClass("disabled"),void(this.curContent=null)):!1},hide_finish:function(){return _frame.infos.curContent?!1:(_frame.dom.layout.removeClass("is-infos-show"),_frame.infos.dom.main.attr({"data-infostype":"","data-theme":""}),this.historyLength=-1,void(this.historyCurrent=-1))},historyback:function(){_frame.infos.dom.main.children().slice(1).remove(),_frame.infos.dom.main.children().eq(0).removeClass("off").addClass("fadein"),_frame.infos.dom.historyback.empty().removeClass("show"),_frame.infos.dom.main.children().eq(0).hasClass("ship")?_frame.infos.dom.main.attr("data-infostype","ship"):_frame.infos.dom.main.children().eq(0).hasClass("equipment")?_frame.infos.dom.main.attr("data-infostype","equipment"):_frame.infos.dom.main.children().eq(0).hasClass("fleet")?_frame.infos.dom.main.attr("data-infostype","fleet"):_frame.infos.dom.main.children().eq(0).hasClass("entity")&&_frame.infos.dom.main.attr("data-infostype","entity")},click:function(e){_frame.infos.show(e.attr("data-infos"),e,e.attr("data-infos-nohistory"))}},_frame.infos.init=function(){return _frame.infos.is_init?!0:($body.on("click._infos","[data-infos]",function(e){("input"!=e.target.tagName.toLowerCase()||"compare"!=e.target.className)&&(_frame.infos.click($(this)),"a"==e.target.tagName.toLowerCase()&&e.preventDefault())}),_frame.infos.is_init=!0,!0)},_frame.infos.__fleet=function(e){return new InfosFleet(e).el};var InfosFleet=function(){function e(t){_classCallCheck(this,e),this.el=$('<div class="infos-fleet loading"/>').attr("data-infos-title","舰队 ("+t+")"),this.doms={},this.fleets=[],"__NEW__"==t?_db.fleets.insert(_tablelist.prototype._fleets_new_data(),function(e,t){e?_g.error(e):"fleet::__NEW__"==_frame.infos.curContent&&_frame.infos.show("[[FLEET::"+t._id+"]]")}.bind(this)):_db.fleets.find({_id:t},function(e,i){e||!i?_g.error(e):_frame.infos.curContent=="fleet::"+t&&this.init(i[0])}.bind(this))}return _createClass(e,[{key:"init",value:function(t){if(!t)return!1;this.data=t;var i=0;for(this.el.attr({"data-fleetid":t._id,"data-infos-id":t._id}).removeClass("loading"),$("<header/>").append(this.doms.name=$("<h3 contenteditable/>").html("点击编辑标题").on({input:function(){this.update_data({}),this.doms.name.trigger("namechange")}.bind(this),focus:function(){"点击编辑标题"==this.doms.name.text()&&this.doms.name.html("")}.bind(this),blur:function(){this.doms.name.text()||this.doms.name.html("点击编辑标题")}.bind(this),namechange:function(e,t){return"undefined"==typeof t&&(t=this.doms.name.text()),this._name=t,this.doms.name}.bind(this),keydown:function(e){13==e.keyCode&&(this.doms.name.blur(),setTimeout(function(){this.doms.name.blur()}.bind(this),1))}.bind(this)})).append(this.doms.user=$("<button/>")).appendTo(this.el),$('<div class="fleets"/>').append(this.doms.tabs=$('<div class="tabs"/>')).append(this.doms.options=$('<div class="options"/>').append(this.doms.theme=$('<select class="option option-theme-value"/>').on("change",function(){this._theme=this.doms.theme.val()}.bind(this)).append(function(){for(var e=$(),t=1;11>t;t++)e=e.add($("<option/>",{value:t,html:"主题-"+t}));return e})).append(this.doms.themeOption=$('<button class="option option-theme"/>').html("主题").on("click",function(){var t=this;if(!e.menuTheme){e.menuThemeItems=$("<div/>");for(var i=function(i){$('<button class="theme-'+i+'"/>').html(i).on("click",function(){e.menuThemeCur._theme=i,this.el.attr("data-theme",this._theme)}.bind(t)).appendTo(e.menuThemeItems)},a=1;11>a;a++)i(a);e.menuTheme=new _menu({className:"contextmenu-infos_fleet_themes",items:[e.menuThemeItems]})}e.menuThemeCur=this,e.menuTheme.show(this.doms.themeOption)}.bind(this))).append($('<button class="option"/>').html("导出代码").on("click",function(){this.modalExport_show()}.bind(this))).append($('<button class="option"/>').html("导出文本").on("click",function(){this.modalExportText_show()}.bind(this))).append($('<button class="option"/>').html("导出图片").on("click",function(){this.exportPic()}.bind(this))).append(this.doms.optionOptions=$('<button class="icon" icon="cog"/>').on("click",function(){TablelistFleets.menuOptions_show(this.doms.optionOptions)}.bind(this)))).appendTo(this.el),this.doms.ships=$('<div class="ships"/>').appendTo(this.el);4>i;)this.fleets[i]=new InfosFleetSubFleet(this,[]),$("<input/>",{type:"radio",name:"fleet_"+t._id+"_tab",id:"fleet_"+t._id+"_tab_"+i,value:i}).prop("checked",0==i).prependTo(this.el),$("<label/>",{"for":"fleet_"+t._id+"_tab_"+i,"data-fleet":i,html:"#"+(i+1)}).appendTo(this.doms.tabs),this.fleets[i].el.attr("data-fleet",i).appendTo(this.doms.ships),i++;this.update(t),this._theme=this._theme}},{key:"update",value:function(e){this._updating=!0,e=e||{},"undefined"!=typeof e.theme&&(_frame.infos.dom.main.attr("data-theme",e.theme),this.doms.theme.val(e.theme).attr("value",e.theme)),"undefined"!=typeof e.name&&this.doms.name.trigger("namechange",[e.name]).trigger("blur"),e.data&&e.data.push&&e.data.forEach(function(e,t){this.fleets[t].updateEl(e)},this),this._updating=!1}},{key:"update_data",value:function(e){e=e||{},this.update(e)}},{key:"save",value:function(e){return this._updating?this:(this.fleets.forEach(function(e,t){this.data.data[t]=e.data},this),this.data.time_modify=_g.timeNow(),e||_db.fleets.updateById(this.data._id,this.data,function(){_g.log("saved")}),this)}},{key:"modalExport_show",value:function(){e.modalExport_show(this.data)}},{key:"modalExportText_show",value:function(){e.modalExportText_show(this.data)}},{key:"exportPic",value:function(){e.fileDialog_export||(e.fileDialog_export=$('<input type="file" accept=".png" nwsaveas/>').on({click:function(t,i,a){e.fileDialog_export.data({windowWidth:i,windowHeight:a}),e.fileDialog_export_showing=!0},change:function(){var t=e.fileDialog_export.val();e.fileDialog_export.val(""),_g.log("changed"),setTimeout(function(){node.win.capturePage(function(e){var i=node.fs.createWriteStream(t);i.write(e),i.end()},{format:"png",datatype:"buffer"})},0)},resetCaptureMode:function(){!e.fileDialog_export.val()&&$body.hasClass("mod-capture")&&($body.removeClass("mod-capture"),node.win.resizeTo(e.fileDialog_export.data("windowWidth"),e.fileDialog_export.data("windowHeight")),e.fileDialog_export.data({windowWidth:null,windowHeight:null}))}}).appendTo(_frame.dom.hidden),$window.on("focus.resetCaptureMode",function(){e.fileDialog_export_showing&&setTimeout(function(){e.fileDialog_export.trigger("resetCaptureMode"),e.fileDialog_export_showing=!1},100)}));var t=$window.width(),i=$window.height();$body.addClass("mod-capture"),node.win.resizeTo(1280,720),e.fileDialog_export.trigger("click",[t,i])}},{key:"_name",get:function(){return this.data.name},set:function(e){this.data.name=e,this.doms.name.html(e),e?this.doms.name.attr("data-content",e):this.doms.name.removeAttr("data-content"),this.save()}},{key:"_theme",get:function(){return this.data.theme},set:function(e){this.data.theme=e||1,this.doms.theme.val(this.data.theme).attr("value",this.data.theme),_frame.infos.dom.main.attr("data-theme",this.data.theme),this.el.attr("data-theme",this.data.theme),
_frame.dom.main.attr("data-theme",this.data.theme),this.save()}}]),e}();InfosFleet.modalExport=function(e){return InfosFleet.elModalExport||(InfosFleet.elModalExport=$("<div/>").append(InfosFleet.elModalExportTextarea=$("<textarea/>",{readonly:!0})).append($('<p class="note-codeusage"/>').html('* 该配置代码可用于<a href="http://www.kancolle-calc.net/deckbuilder.html">艦載機厨デッキビルダー</a>')).append($('<button class="button"/>').html("复制到剪切板").on("click",function(){node.clipboard.set(InfosFleet.elModalExportTextarea.val(),"text")}))),InfosFleet.elModalExportTextarea.val(e||""),InfosFleet.elModalExport},InfosFleet.modalExport_show=function(e){e=e.data||[],e=JSON.stringify(_g.kancolle_calc.encode(e)),_frame.modal.show(InfosFleet.modalExport(e),"导出配置代码",{classname:"infos_fleet infos_fleet_export"})},InfosFleet.modalExportText_show=function(e){if(!e)return!1;var t="",i=e.data.filter(function(e){return e.length})||[];t+=e.name||"",i.forEach(function(e,a){console.log(e),t+=(t?"\n":"")+(i.length>1?"\n第 "+(a+1)+" 舰队":""),e.filter(function(e){return e.length>0&&e[0]}).forEach(function(e,i){t+="\n("+(a?a+1+"-":"")+(i+1)+")"+_g.data.ships[e[0]]._name+(e[1]&&e[1][0]?" Lv."+e[1][0]:"");var n=e[2]||[],o=e[3]||[],s=e[4]||[];n.filter(function(e){return e}).forEach(function(e,i){t+=(i?", ":" | ")+_g.data.items[e]._name+(o[i]?"★"+o[i]:"")+(s[i]?"["+_g.textRank[s[i]]+"]":"")})})}),t+=(t?"\n\n":"")+"* 创建自 是谁呼叫舰队 (fleet.diablohu.com)",_frame.modal.show(InfosFleet.modalExport(t),"导出配置文本",{classname:"infos_fleet infos_fleet_export mod-text"})};var InfosFleetSubFleet=function(){function e(t,i){_classCallCheck(this,e),i=i||[],this.data=i,this.el=$('<dl class="fleetinfos-ships"/>'),this.ships=[];for(var a=0;6>a;)this.ships[a]=new InfosFleetShip(t,this,a),this.ships[a].getEl().appendTo(this.el),a++;this.elSummary=$('<span class="summary"/>').appendTo(this.el).append($('<span class="summary-item"/>').html("航速").append(this.elSummarySpeed=$("<strong/>").html("-"))).append($('<span class="summary-item"/>').html("制空战力").append(this.elSummaryFighterPower=$("<strong/>").html("-"))).append($('<span class="summary-item summary-item-consummation"/>').html("总消耗").append(this.elSummaryConsummation=$("<strong/>").html("-"))),this.infosFleet=t,this.updateEl()}return _createClass(e,[{key:"updateEl",value:function(e){this.data=e||this.data,e&&e.forEach(function(e,t){this.ships[t].updateEl(e)},this)}},{key:"getData",value:function(){return this.data}},{key:"summaryCalc",value:function(){return this.summaryCalculating?!1:void(this.summaryCalculating=setTimeout(function(){var e=0,t="fast",i=0,a=0;this.ships.forEach(function(n){if(n.data[0]){var o=_g.data.ships[n.data[0]];o.stat.speed<10&&(t="slow"),e+=n.calculate("fighterPower"),i+=o.getAttribute("fuel",n.shipLv)||0,a+=o.getAttribute("ammo",n.shipLv)||0}}),this.elSummarySpeed.html("fast"==t?"高速":"低速"),this.elSummaryFighterPower.html(e>0?Math.floor(e):"-"),e>0?this.elSummaryFighterPower.removeClass("empty"):this.elSummaryFighterPower.addClass("empty"),this.elSummaryConsummation.html(i||a?'<span class="fuel">'+i+'</span><span class="ammo">'+a+"</span>":"-"),this.summaryCalculating=null}.bind(this),10))}},{key:"save",value:function(){var e=!0;this.data=this.data||[],this.ships.forEach(function(t,i){this.data[i]=t.data,t.data[0]&&(e=!1)},this),e&&(this.data=null),this.infosFleet&&this.infosFleet.save()}}]),e}(),InfosFleetShip=function(){function e(t,i,a,n){return _classCallCheck(this,e),this.el?this.el:(n=n||[null,[null,-1],[],[],[]],this.data=n,this.infosFleet=t,this.infosFleetSubFleet=i,this.equipments=[],this.index=a,this.el=$('<dd class="noship"/>').append($("<dt/>").append(this.elAvatar=$("<s/>").on({mousedown:function(t){t.preventDefault(),this.data[0]&&e.dragStart(this)}.bind(this)})).append(this.elInfos=$("<div/>").html("<span>选择舰娘...</span>").append(this.elInfosTitle=$('<div class="title"/>')).append($('<div class="info"/>').append($("<label/>").html("Lv.").append(this.elInputLevel=$("<input/>",{type:"number",min:0,max:150}).on({change:function(e){var t=this.elInputLevel.val();"undefined"!=typeof t&&""!==t||!this.data[1][0]||(this.shipLv=null),t=parseInt(t),0>t?(t=0,this.elInputLevel.val(0)):t>150&&(t=150,this.elInputLevel.val(150)),isNaN(t)||this.data[1][0]==t||(this.shipLv=t)}.bind(this),input:function(){this.elInputLevel.trigger("change")}.bind(this)}))).append(this.elInfosInfo=$("<span/>"))))).append($('<div class="equipments"/>').append(function(){for(var e=$(),t=0;4>t;t++)this.equipments[t]=new InfosFleetShipEquipment(this,t),e=e.add(this.equipments[t].el);return e}.bind(this))).append($('<div class="attributes"/>').append(this.elAttrShelling=$('<span class="shelling"/>')).append(this.elAttrTorpedo=$('<span class="torpedo"/>')).append(this.elAttrHitSum=$('<span class="hitsum"/>')).append(this.elAttrHp=$('<span class="hp"/>')).append(this.elAttrArmor=$('<span class="armor"/>')).append(this.elAttrEvasion=$('<span class="evasion"/>')).append(this.elAttrNightBattle=$('<span class="nightbattle" data-text="夜战"/>'))).append($('<div class="options"/>').append(this.elBtnOptions=$('<button class="options"/>').on("click",function(e){this.showMenu()}.bind(this)))).on({click:function(){this.data[0]||this.selectShipStart()}.bind(this),mouseenter:function(t){e.dragEnter(this)}.bind(this)}),this.after=$("<s/>"),void(this.els=this.el.add(this.after)))}return _createClass(e,[{key:"getEl",value:function(){return this.els}},{key:"selectShipStart",value:function(){_g.log("开始选择舰娘"),_frame.app_main.load_page("ships",{callback_modeSelection_select:function(e){history.back(),this.shipId=e,this.shipLv=null,this.infosFleet&&_frame.infos.dom.main.attr("data-theme",this.infosFleet.data.theme)}.bind(this)})}},{key:"changeLuck",value:function(e){this.data[1][1]=e||-1}},{key:"updateAttrs",value:function(){this.elAttrShelling.html(this.calculate("shellingDamage")),this.elAttrTorpedo.html(this.calculate("torpedoDamage"));var e=this.calculate("addHit");e>=0?this.elAttrHitSum.removeClass("negative"):this.elAttrHitSum.addClass("negative"),this.elAttrHitSum.html(e),this.elAttrHp.html(this.calculate("attribute","hp")),this.elAttrArmor.html(this.calculate("attribute","armor")+this.calculate("addArmor")),this.elAttrEvasion.html(this.shipLv?this.calculate("attribute","evasion")+this.calculate("addEvasion"):"-"),this.elAttrNightBattle.html(this.calculate("nightBattle"))}},{key:"calculate",value:function(e,t){return this.shipId?"attribute"==e?_g.data.ships[this.shipId].getAttribute(t,this.shipLv):Formula[e]?Formula[e](this.shipId,this.data[2],this.data[3],this.data[4]):"-":"-"}},{key:"updateEl",value:function(e){this._updating=!0,this.data=e||this.data,"string"==typeof this.data[0]&&(this.data[0]=parseInt(this.data[0])),this.data[2]||(this.data[2]=[]),this.data[3]||(this.data[3]=[]),this.data[4]||(this.data[4]=[]),this.data[0]&&(this.shipId=this.data[0]),this.data[1][0]&&(this.shipLv=this.data[1][0]);for(var t=0;4>t;t++)this.equipments[t].id=this.data[2][t],this.equipments[t].star=this.data[3][t],this.equipments[t].rank=this.data[4][t];this.updateAttrs(),this._updating=!1}},{key:"getData",value:function(){return this.data}},{key:"showMenu",value:function(){e.menuCurObj=this,e.menu||(e.menuItems=[$('<menuitem class="move move-up"/>').html(" ").on({click:function(t){e.menuCurObj.moveUp()},show:function(){e.menuCurObj.index?e.menuItems[0].removeClass("disabled"):e.menuItems[0].addClass("disabled")}}),$('<menuitem class="move move-down"/>').html(" ").on({click:function(t){e.menuCurObj.moveDown()},show:function(){e.menuCurObj.index<5?e.menuItems[1].removeClass("disabled"):e.menuItems[1].addClass("disabled")}}),$("<hr/>"),$("<menuitem/>").html("查看资料").on({show:function(){e.menuItems[3].attr("data-infos","[[SHIP::"+e.menuCurObj.shipId+"]]")}}),$("<menuitem/>").html("移除").on({click:function(t){e.menuCurObj.shipId=null}}),$("<menuitem/>").html("替换为 ...").on({click:function(t){e.menuCurObj.selectShipStart()}}),$("<div/>").on("show",function(){var t=e.menuItems[6].empty();if(e.menuCurObj.shipId){var i=_g.data.ships[e.menuCurObj.shipId].getSeriesData()||[];i.length>1&&i.forEach(function(i,a){a||t.append($("<hr/>")),i.id!=e.menuCurObj.shipId&&t.append($("<menuitem/>").html("替换为 "+_g.data.ships[i.id].getName(!0)).on({click:function(){e.menuCurObj.shipId=i.id}}))})}})],e.menu=new _menu({className:"contextmenu-ship",items:e.menuItems})),e.menu.show(this.elBtnOptions)}},{key:"swap",value:function(e,t){"number"==typeof e&&(e=this.infosFleetSubFleet.ships[e]),this.index>e.index?this.el.insertBefore(e.el):this.el.insertAfter(e.after),this.after.insertAfter(this.el);var i=e.index,a=this.index;console.log(i,a),this.index=i,e.index=a,this.infosFleetSubFleet.ships[i]=this,this.infosFleetSubFleet.ships[a]=e,t&&this.save()}},{key:"moveUp",value:function(){this.index<=0||this.swap(this.index-1,!0)}},{key:"moveDown",value:function(){this.index>=5||this.swap(this.index+1,!0)}},{key:"save",value:function(){return this._updating?!1:(this._updateTimeout||(this._updateTimeout=setTimeout(function(){this.updateAttrs(),this.infosFleetSubFleet.summaryCalc(),this._updateTimeout=null}.bind(this),10)),void(this._saveTimeout||(this._saveTimeout=setTimeout(function(){this.infosFleetSubFleet&&this.infosFleetSubFleet.save(),this._saveTimeout=null}.bind(this),1e3))))}},{key:"shipId",get:function(){return this.data[0]},set:function(e){if(e!=this.data[0]&&(this.data[0]=e,this.shipLv=null),e){var t=_g.data.ships[e],i=t.getSuffix(),a=t._speed,n=t._type;n=n.replace(a,""),this.el.attr("data-shipId",e),this.el.removeClass("noship"),this.elAvatar.html('<img src="'+t.getPic(10)+'"/>'),this.elInfosTitle.html('<h4 data-content="'+t.name[_g.lang]+'">'+t.name[_g.lang]+"</h4>"+(i?'<h5 data-content="'+i+'">'+i+"</h5>":"")),this.elInfosInfo.html(a+" "+n);for(var o=0;4>o;o++)this.equipments[o].carry=t.slot[o],this._updating||(this.equipments[o].id=null,this.equipments[o].star=null,this.equipments[o].rank=null)}else this.el.removeAttr("data-shipId"),this.el.addClass("noship"),this.elAvatar.html(""),this.data[2]=[],this.data[3]=[],this.data[4]=[];this.save()}},{key:"shipLv",get:function(){return this.data[1][0]},set:function(e){this.data[1][0]=e||null,e&&e>0?this.elInputLevel.val(e):this.elInputLevel.val(""),this.save()}}]),e}();InfosFleetShip.dragStart=function(e){return InfosFleetShip.dragging||!e?!1:(InfosFleetShip.dragging=e,e.el.addClass("moving"),void(InfosFleetShip.isInit||($body.on({"mouseup.InfosFleetShip_dragend":function(){InfosFleetShip.dragging&&(InfosFleetShip.dragging.el.removeClass("moving"),InfosFleetShip.dragging.save(),InfosFleetShip.dragging=null)}}),InfosFleetShip.isInit=!0)))},InfosFleetShip.dragEnter=function(e){return InfosFleetShip.dragging&&e&&InfosFleetShip.dragging!=e?void InfosFleetShip.dragging.swap(e):!1};var InfosFleetShipEquipment=function(){function e(t,i){return _classCallCheck(this,e),this.index=i||0,this.infosFleetShip=t,this.el?this.el:void(this.el=$('<div class="equipment"/>').append(this.elCarry=$('<div class="equipment-layer equipment-add"/>').on("click",function(){this.selectEquipmentStart()}.bind(this))).append($('<div class="equipment-layer equipment-infos"/>').append(this.elName=$('<span class="equipment-name"/>')).append(this.elStar=$('<span class="equipment-star"/>').html(0)).append(this.elRank=$('<span class="equipment-rank"/>')).append(function(){var e=$('<span class="equipment-carry"/>').html(0);return this.elCarry=this.elCarry.add(e),e}.bind(this))).append($('<div class="equipment-layer equipment-options"/>').append(this.elInputStar=$("<input/>",{"class":"equipment-starinput",type:"number",placeholder:0}).on("input",function(){var e=this.elInputStar.val();"undefined"!=typeof e&&""!==e||!this.star||(this.star=null),e=parseInt(e),isNaN(e)||this.star==e||(this.star=e)}.bind(this))).append(this.elSelectRank=$("<div/>",{"class":"equipment-rankselect",html:"<span>无</span>"}).on("click",function(){if(!InfosFleet.menuRankSelect){InfosFleet.menuRankSelectItems=$("<div/>");for(var e=function(e){$('<button class="rank-'+e+'"/>').html(e?"":"无").on("click",function(){InfosFleet.menuRankSelectCur.rank=e}).appendTo(InfosFleet.menuRankSelectItems)},t=0;8>t;t++)e(t);InfosFleet.menuRankSelect=new _menu({className:"contextmenu-infos_fleet_rank_select",items:[InfosFleet.menuRankSelectItems]})}InfosFleet.menuRankSelectCur=this,InfosFleet.menuRankSelect.show(this.elSelectRank)}.bind(this))).append(this.elButtonInspect=$('<button class="inspect" icon="search"/>').on("click",function(){this.id&&_frame.infos.show("[[EQUIPMENT::"+this.id+"]]")}.bind(this))).append($('<button class="change" icon="loop"/>').on("click",function(){this.selectEquipmentStart()}.bind(this))).append($('<button class="remove"/>').html("×").on("click",function(){this.id=null}.bind(this)))))}return _createClass(e,[{key:"getEl",value:function(){return this.el}},{key:"selectEquipmentStart",value:function(){_g.log("开始选择装备"),_frame.app_main.load_page("equipments",{callback_modeSelection_select:function(e){history.back(),this.id=e,this.star=0,this.rank=Lockr.get("fleetlist-option-aircraftdefaultmax")&&e&&$.inArray(_g.data.items[e].type,_g.data.item_type_collections[3].types)>-1?7:0,TablelistEquipments.types=[],TablelistEquipments.shipId=null,this.infosFleetShip.infosFleet&&_frame.infos.dom.main.attr("data-theme",this.infosFleetShip.infosFleet.data.theme)}.bind(this),callback_modeSelection_enter:function(){TablelistEquipments.types=_g.data.ships[this.infosFleetShip.shipId].getEquipmentTypes(),TablelistEquipments.shipId=this.infosFleetShip.shipId,_frame.app_main.page.equipments.object.tablelistObj.apply_types()}.bind(this)})}},{key:"getData",value:function(){return this.data}},{key:"save",value:function(){return this._updating?!1:void(this.infosFleetShip&&this.infosFleetShip.save())}},{key:"id",get:function(){return this.infosFleetShip.data[2][this.index]},set:function(e){e=parseInt(e)||null,_p.tip.hide(),this.el.removeData(["tip","tip-filtered"]),e!=this.infosFleetShip.data[2][this.index]&&(this.star=0),e&&!isNaN(e)?(this.infosFleetShip.data[2][this.index]=e,this.improvable=_g.data.items[e].improvable||!1,this.el.attr({"data-equipmentid":e,"data-tip":"[[EQUIPMENT::"+e+"]]"}).css("background-image","url("+_g.data.items[e]._icon+")"),this.elName.html(_g.data.items[e]._name),$.inArray(_g.data.items[e].type,_g.data.item_type_collections[3].types)>-1?this.el.addClass("is-aircraft"):this.el.removeClass("is-aircraft")):(this.infosFleetShip.data[2][this.index]=null,this.improvable=!1,this.el.removeAttr("data-equipmentId").removeAttr("data-tip").css("background-image","").removeClass("is-aircraft"),this.elName.html("")),this.infosFleetShip.infosFleetSubFleet.summaryCalc(),this.save()}},{key:"star",get:function(){return this.infosFleetShip.data[3][this.index]},set:function(e){this._improvable?(e=parseInt(e)||null,e>10&&(e=10),0>e&&(e=0),e?(this.infosFleetShip.data[3][this.index]=e,this.elInputStar.val(e),this.elStar.html(e),this.el.attr("data-star",e)):(this.infosFleetShip.data[3][this.index]=null,this.elInputStar.val(""),this.elStar.html(0),this.el.attr("data-star",""))):(this.infosFleetShip.data[3][this.index]=null,this.el.removeAttr("data-star")),this.infosFleetShip.infosFleetSubFleet.summaryCalc(),this.save()}},{key:"rank",get:function(){return this.infosFleetShip.data[4][this.index]},set:function(e){this.id&&$.inArray(_g.data.items[this.id].type,_g.data.item_type_collections[3].types)>-1?(e=parseInt(e)||null,e>7&&(e=7),0>e&&(e=0),e?(this.infosFleetShip.data[4][this.index]=e,this.el.attr("data-rank",e)):(this.infosFleetShip.data[4][this.index]=null,this.el.attr("data-rank",""))):(this.infosFleetShip.data[4][this.index]=null,this.el.removeAttr("data-rank")),this.infosFleetShip.infosFleetSubFleet.summaryCalc(),this.save()}},{key:"carry",set:function(e){"undefined"==typeof e?(this.el.removeAttr("data-carry"),this.elCarry.html(0)):(e=parseInt(e)||0,this.el.attr("data-carry",e),this.elCarry.html(e))}},{key:"improvable",set:function(e){e?(this.el.attr("data-star",""),this.elInputStar.prop("disabled",!1).attr("placeholder","0"),this._improvable=!0):(this.el.removeAttr("data-star"),this.elInputStar.prop("disabled",!0).attr("placeholder","--"),this._improvable=!1)}}]),e}();_frame.app_main.is_mode_selection=function(){return $html.hasClass("mode-selection")||_frame.dom.layout.hasClass("mode-selection")},_frame.app_main.mode_selection_callback=null,_frame.app_main.mode_selection_on=function(e){_frame.dom.navSelectionInfo||(_frame.dom.navSelectionInfo=$('<div class="selection-info"/>').html("请选择……").appendTo(_frame.dom.nav)),e=e||function(){},e(),_frame.dom.layout.addClass("mode-selection")},_frame.app_main.mode_selection_off=function(){_frame.app_main.cur_page&&_frame.app_main.page_dom[_frame.app_main.cur_page].trigger("modeSelectionExit"),_frame.dom.layout.removeClass("mode-selection")},"undefined"!=typeof _p.tip&&(_p.tip.filters.push(function(e){var t=/^\[\[EQUIPMENT\:\:([0-9]+)\]\]$/.exec(e);return t&&t.length>1?_p.tip.content_equipment(_g.data.items[parseInt(t[1])]):void 0}),_p.tip.content_equipment=function(e){function t(t,i){if(!e.stat[t])return"";switch(t){case"range":return"<span>射程: "+_g.getStatRange(e.stat[t])+"</span>";default:var a=parseInt(e.stat[t]);return"<span>"+(a>0?"+":"")+a+" "+i+"</span>"}}var i="assets/images/itemicon/"+e.getIconId()+".png",a=e.getName(),n='<h3 class="itemstat"><s style="background-image: url('+i+')"></s><strong data-content="'+a+'">'+a+"</strong><small>"+_g.data.item_types[e.type].name.zh_cn+"</small></h3>"+t("fire","火力")+t("torpedo","雷装")+t("aa","对空")+t("asw","对潜")+t("bomb","爆装")+t("hit","命中")+t("armor","装甲")+t("evasion","回避")+t("los","索敌")+t("range","射程");return n}),"undefined"!=typeof _p.tip&&(_p.tip.filters.push(function(e){var t=/^\[\[SHIP\:\:([0-9]+)\]\]$/.exec(e);return t&&t.length>1?_p.tip.content_ship(_g.data.ships[parseInt(t[1])]):void 0}),_p.tip.content_ship=function(e){var t=e.getName(_g.joint),i='<h3 class="shipinfo"><img src="'+_g.path.pics.ships+"/"+e.id+'/0.webp" width="160" height="40"/><strong data-content="'+t+'">'+t+"</strong>"+(e.type?"<small>"+_g.data.ship_types[e.type].full_zh+"</span>":"")+"</h3>";return i}),_p.el.tablelist={init_el:function(e){return e.data("tablelist")?!0:void(e.hasClass("ships")?e.data({tablelist:new TablelistShips(e)}):e.hasClass("tablelist-equipments")?e.data({tablelist:new TablelistEquipments(e)}):e.hasClass("fleets")?e.data({tablelist:new TablelistFleets(e)}):e.hasClass("entities")&&e.data({tablelist:new TablelistEntities(e)}))},init:function(e,t){e=e||$body,t=t||e.find(".tablelist"),t.each(function(){_p.el.tablelist.init_el($(this))})}};var Tablelist=function(){function e(t,i){_classCallCheck(this,e),this.dom={container:t},i=i||{},this._index=e.index++,this.trIndex=0,this.flexgrid_empty_count=i.flexgrid_empty_count||8,this.sort_data_by_stat=i.sort_data_by_stat||{},this.sort_default_order_by_stat=i.sort_default_order_by_stat||{}}return _createClass(e,[{key:"append_option",value:function(t,i,a,n,o,s){function r(){var a=void 0,o=void 0,r=void 0,l=e.genId();switch(t){case"text":case"number":case"hidden":a=$('<input type="'+t+'" name="'+i+'" id="'+l+'" />').val(n);break;case"select":a=$('<select name="'+i+'" id="'+l+'" />'),o=$('<option value=""/>').html("").appendTo(a),n.forEach(function(e,t){r="object"==typeof e?$('<option value="'+("undefined"==typeof e.val?e.value:e.val)+'"/>').html(e.title||e.name).appendTo(a):$('<option value="'+e+'"/>').html(e).appendTo(a),"undefined"!=typeof s["default"]&&r.val()==s["default"]&&r.prop("selected",!0)}),n&&n.length||(o.remove(),$('<option value=""/>').html("...").appendTo(a)),s["new"]&&($('<option value=""/>').html("==========").insertAfter(o),$('<option value="___new___"/>').html("+ 新建").insertAfter(o),a.on("change.___new___",function(){var e=$(this);"___new___"==e.val()&&(e.val(""),s["new"](a))}));break;case"checkbox":a=$('<input type="'+t+'" name="'+i+'" id="'+l+'" />').prop("checked",n);break;case"radio":a=$(),n.forEach(function(e,t){var o,r,d=!1;n[t].push?(r=n[t][0],o=n[t][1]):(r=n[t].val||n[t].value,o=n[t].title||n[t].name),s.radio_default&&s.radio_default==r&&(d=!0),a=a.add($('<input type="radio" name="'+i+'" id="'+l+"-"+r+'" ischecked="'+d+'" />').val(r).prop("checked",d||!d&&0==t)),a=a.add($('<label for="'+l+"-"+r+'"/>').html(o))})}return s.required&&a.prop("required",!0),s.onchange&&(a.on("change.___onchange___",function(e){s.onchange(e,$(this))}),s["default"]&&a.trigger("change")),i||a.attr("name",null),a}s=s||{};var l=$("<p/>").addClass(i).appendTo(this.dom.filters),d=r().appendTo(l),p=d.attr("id")||e.genId();return a=a?$('<label for="'+p+'"/>').html(a).appendTo(l):null,"checkbox"==t&&a&&a.insertAfter(d),o&&$('<label for="'+p+'"/>').html(o).appendTo(l),l}},{key:"thead_redraw",value:function(e){if(this.dom.thead&&this.dom.thead.length){var t=this.dom.thead;setTimeout(function(){t.hide().show(0)},e||10)}}},{key:"sort_column",value:function(e,t,i){if(!i){var a=this.dom.tbody;a&&a.length||(a=this.dom.table.find("tbody")),i=a.find("tr.row:visible").not("[data-donotcompare]")}e=e||1,this._tmp_values=[],this._tmp_value_map_cell={},i.find("td:nth-of-type("+e+")").each(function(e,t){var i=$(t),a=i.data("value");a=parseFloat(a),$.inArray(a,this._tmp_values)<0&&this._tmp_values.push(a),this._tmp_value_map_cell[a]||(this._tmp_value_map_cell[a]=$()),this._tmp_value_map_cell[a]=this._tmp_value_map_cell[a].add(i)}.bind(this)),this._tmp_values.sort(function(e,i){return t?e-i:i-e});var n=[];return this._tmp_values.forEach(function(e){n.push(this._tmp_value_map_cell[e])},this),delete this._tmp_values,delete this._tmp_value_map_cell,n}},{key:"mark_high",value:function(e){var t=this.dom.tbody;t&&t.length||(t=this.dom.table.find("tbody"));var i=t.find("tr.row:visible").not("[data-donotcompare]");return i.find("td[data-value]").removeClass("sort-first sort-second"),i.eq(0).find("td[data-value]").each(function(t,a){var n=!1,o=$(a),s=o.data("stat"),r=s.match(/\b(speed|range|extra_illust)\b/);"undefined"==typeof this.sort_default_order_by_stat[s]?(s.match(/\b(consum_fuel|consum_ammo)\b/)&&(n=!0),this.sort_default_order_by_stat[s]=n?"asc":"desc"):n="asc"==this.sort_default_order_by_stat[s]?!0:!1;var l=this.sort_column(t+1,n,i),d=Math.min(6,Math.ceil(i.length/2)+1);!r&&l.length>1&&l[0].length<d&&(l[0].addClass("sort-first"),l.length>2&&l[1].length<d&&l[1].addClass("sort-second")),e?this.sort_data_by_stat[s]=l:delete this.sort_data_by_stat[s]}.bind(this)),i}},{key:"sort_table_from_theadcell",value:function(e){if(e){var t=e.data("stat"),i=this.sort_data_by_stat[t];if(console.log(t,i),!t||!i)return!1;t!=this.lastSortedStat&&(this.lastSortedHeader&&this.lastSortedHeader.removeClass("sorting desc asc"),e.addClass("sorting"));var a=t==this.lastSortedStat&&"obverse"==this.lastSortedOrder?"reverse":"obverse",n="reverse"==a?i.length-1:0;if(this.sort_default_order_by_stat[t]){var o="asc"==this.sort_default_order_by_stat[t]?"desc":"asc";"obverse"==a?e.removeClass(o).addClass(this.sort_default_order_by_stat[t]):e.removeClass(this.sort_default_order_by_stat[t]).addClass(o)}for(this.sortedRow=$();i[n];)this._tmpDOM=i[n].parent(),this.sortedRow=this.sortedRow.add(this._tmpDOM),this._tmpDOM.appendTo(this.dom.tbody),n="reverse"==a?n-1:n+1;this.dom.btn_compare_sort.removeClass("disabled").html("取消排序"),this.lastSortedStat=t,this.lastSortedOrder=a,this.lastSortedHeader=e,delete this._tmpDOM}}},{key:"sort_table_restore",value:function(){if(!this.sortedRow)return!0;var e=void 0,t=[];return this.sortedRow.each(function(i,a){var n=$(a),o=parseInt(n.data("trindex"));e=e||n.parent(),t.push({index:o,el:n,prev:e.children('tr[data-trindex="'+(o-1)+'"]')})}),t.sort(function(e,t){return e.index-t.index}),t.forEach(function(e){e.el.insertAfter(e.prev)}),this.dom.btn_compare_sort.addClass("disabled").html("点击表格标题可排序"),this.lastSortedHeader.removeClass("sorting desc asc"),delete this.sortedRow,delete this.lastSortedStat,delete this.lastSortedOrder,delete this.lastSortedHeader,!0}}]),e}();Tablelist.index=0,Tablelist.genId=function(e){var t,i,a,n=0;if(e=e||(new Date).toISOString()+_g.randInt(1e4),0==e.length)return n;for(t=0,a=e.length;a>t;t++)i=e.charCodeAt(t),n=(n<<5)-n+i,n|=0;return"tablelist"+n};var TablelistEntities=function(e){function t(e,i){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),_frame.app_main.loading.push("tablelist_"+this._index),_frame.app_main.is_loaded=!1,e.children(".tablelist-list").length?this.init_parse():this.init_new&&this.init_new()}return _inherits(t,e),_createClass(t,[{key:"init_parse",value:function(){this.generated=!0,_frame.app_main.loaded("tablelist_"+this._index,!0)}}]),t}(Tablelist),TablelistEquipments=function(e){function t(e,i){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.columns=["  ",["火力","fire"],["雷装","torpedo"],["对空","aa"],["对潜","asw"],["爆装","bomb"],["命中","hit"],["装甲","armor"],["回避","evasion"],["索敌","los"],["射程","range"],["可改修","improvable"]],_frame.app_main.loading.push("tablelist_"+this._index),_frame.app_main.is_loaded=!1,e.children(".fixed-table-container").length?this.init_parse():this.init_new&&this.init_new()}return _inherits(t,e),_createClass(t,[{key:"apply_types",value:function(){console.log("types: "+t.types),this.dom.filter_types.removeAttr("class"),t.types.length&&(this.dom.filter_types.addClass("type"+t.types.join(" type")),this.generated&&this.apply_types_check())}},{key:"apply_types_check",value:function(){if(!t.shipIdLast||t.shipIdLast!=t.shipId){if(t.shipIdLast=t.shipId,t.shipId&&$.inArray(_g.data.ships[t.shipId].type,[9,10,11])>-1){for(var e=0,i=void 0;3!=this.dom.types[e++].attr("data-equipmentcollection")||$.inArray(parseInt(this.dom.types[e].attr("data-type"))||null,t.types)<=-1;)i=this.dom.types[e+1];return i=i||this.dom.types[0],this.dom.type_radios[3].prop("checked",!0).trigger("change"),void this.dom.table_container_inner.scrollTop(i[0].offsetTop||0)}if(t.types.length){for(var e=0,a=void 0;$.inArray(parseInt(this.dom.types[e++].attr("data-type"))||null,t.types)<=-1;)a=this.dom.types[e];a=a||this.dom.types[0],this.dom.type_radios[parseInt(a.attr("data-equipmentcollection"))||1].prop("checked",!0).trigger("change"),this.dom.table_container_inner.scrollTop(a[0].offsetTop||0)}}}},{key:"init_parse",value:function(){this.dom.filter_container=this.dom.container.children(".options"),this.dom.filters=this.dom.filter_container.children(".filters"),this.dom.type_radios={},this.dom.container.children('input[type="radio"][name="equipmentcollection"]').each(function(e,t){t=$(t);var i=parseInt(t.val());this.dom.type_radios[i]=t.prop("checked",1==i).on("change",function(){this.dom.table_container_inner.scrollTop(0),this.thead_redraw()}.bind(this))}.bind(this)),this.dom.filter_types=this.dom.container.children('input[name="types"][type="hidden"]'),this.dom.table_container=this.dom.container.children(".fixed-table-container"),this.dom.table_container_inner=this.dom.table_container.children(".fixed-table-container-inner"),this.dom.table=this.dom.table_container_inner.children(".equipments.hashover.hashover-column"),this.dom.thead=this.dom.table.children("thead"),this.dom.tbody=this.dom.table.children("tbody"),this.parse_all_items(),this.dom.msg_container=this.dom.container.children(".msgs"),_config.get("hide-equipmentsinfos")?this.dom.msg_container.removeAttr("data-msgs"):this.dom.msg_container.attr("data-msgs","equipmentsinfos");var e=this.dom.msg_container.children(".equipmentsinfos");e.children("button").on("click",function(){this.dom.msg_container.removeAttr("data-msgs"),_config.set("hide-equipmentsinfos",!0)}.bind(this))}},{key:"parse_all_items",value:function(){this.generated=!1,this.dom.types=[];var e=-1;this.dom.tbody.children("tr.typetitle,tr.row").each(function(i,a){a=$(a),a.hasClass("typetitle")?(e++,this.dom.types[e]=a):!function(){var e=parseInt(a.attr("data-equipmenttype"))||-1,i=a.attr("data-equipmentid");a.on("click",function(a,n){!n&&_frame.app_main.is_mode_selection()&&(a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),$.inArray(e,t.types)>-1&&_frame.app_main.mode_selection_callback(i))})}()}.bind(this)),this.thead_redraw(),this.generated=!0,this.apply_types_check(),_frame.app_main.loaded("tablelist_"+this._index,!0)}}]),t}(Tablelist);TablelistEquipments.gen_helper_equipable_on=function(e){var t="";return _g.data.item_types[e].equipable_on_type.forEach(function(i,a){var n=_g.data.item_types[e].equipable_on_type[a];t+="<span>"+_g.data.ship_types[n].full_zh+(a<_g.data.item_types[e].equipable_on_type.length-1?",&nbsp;":"")+"</span>"}),'<em class="helper" data-tip="<h4 class=item_equipable_on>可装备于</h4>'+t+'">?</em>'},TablelistEquipments.types=[],TablelistEquipments.shipId=null,TablelistEquipments.shipIdLast=null;var TablelistFleets=function(e){function t(e,i){function a(e){this.dom.thead=$("<thead/>");var t=$("<tr/>").appendTo(this.dom.thead);return e.forEach(function(e){"object"==typeof e?$('<td data-stat="'+e[1]+'"/>').html('<div class="th-inner-wrapper"><span><span>'+e[0]+"</span></span></div>").appendTo(t):$("<th/>").html('<div class="th-inner-wrapper"><span><span>'+e[0]+"</span></span></div>").appendTo(t)}),this.dom.thead}_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.columns=["  ",["创建者","user"],["修改时间","time_modify"],["评价","rating"],["","options"]],this.kancolle_calc={_ApplicationId:"l1aps8iaIfcq2ZzhOHJWNUU2XrNySIzRahodijXW",_ClientVersion:"js1.2.19",_InstallationId:"62522018-ec82-b434-f5a5-08c3ab61d932",_JavaScriptKey:"xOrFpWEQZFxUDK2fN1DwbKoj3zTKAEkgJHzwTuZ4"},_frame.app_main.loading.push("tablelist_"+this._index),_frame.app_main.is_loaded=!1,this.dom.filter_container=$('<div class="options" viewtype="card"/>').appendTo(this.dom.container),this.dom.filters=$('<div class="filters"/>').appendTo(this.dom.filter_container),this.dom.btn_new=$('<button class="new" icon="import"/>').html("新建/导入").on("click",function(){this.btn_new()}.bind(this)).appendTo(this.dom.filters),this.dom.btn_exportFile=$('<button class="export" icon="floppy-disk"/>').html("导出配置文件").on("click",function(){_db.fleets.persistence.compactDatafile(),_g.file_save_as(_db.fleets.filename,"fleets.json")}).appendTo(this.dom.filters),this.dom.buttons_right=$('<div class="buttons_right"/>').appendTo(this.dom.filters),this.dom.btn_settings=$('<button icon="cog"/>').on("click",function(){this.btn_settings()}.bind(this)).appendTo(this.dom.buttons_right),this.dom.table_container=$('<div class="fixed-table-container"/>').appendTo(this.dom.container),this.dom.table_container_inner=$('<div class="fixed-table-container-inner"/>').appendTo(this.dom.table_container),this.dom.table=$('<table class="fleets hashover hashover-column"/>').appendTo(this.dom.table_container_inner),a=a.bind(this),a(this.columns).appendTo(this.dom.table),this.dom.tbody=$("<tbody/>").appendTo(this.dom.table),$('<div class="nocontent container"/>').append($($("<div/>").append($("<span>").html("暂无舰队配置")).append($("<button>").html("新建/导入").on("click",function(){this.dom.btn_new.click()}.bind(this))))).appendTo(this.dom.table_container_inner),this.dom.table.on("contextmenu.contextmenu_fleet","tr[data-fleetid]",function(e){this.contextmenu_show($(e.currentTarget),null,e)}.bind(this)).on("click.contextmenu_fleet","tr[data-fleetid]>th>em",function(e){this.contextmenu_show($(e.currentTarget).parent().parent(),$(e.currentTarget)),e.stopImmediatePropagation(),e.stopPropagation()}.bind(this)),this.genlist()}return _inherits(t,e),_createClass(t,[{key:"new_data",value:function(e){return $.extend({data:[],time_create:(new Date).valueOf(),time_modify:(new Date).valueOf(),hq_lv:-1,name:"",note:"",user:{},rating:-1,theme:_g.randNumber(10)},e||{})}},{key:"loaddata",value:function(){var e=Q.defer();return _db.fleets.find({}).sort({name:1}).exec(function(t,i){t?e.resolve([]):e.resolve(i)}),e.promise}},{key:"validdata",value:function(e){for(var t=Q.defer(),i=[],a=0,n=function(e){if(e.hq_lv>-1||e.name||e.note||e.rating>-1)return!0;if(!e.data||!e.data.length||!e.data.push)return!1;var t=!0,i=!1,a=void 0;
try{for(var n,o=e.data[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var s=n.value;if(!s||!s.length||!s.push)return!1;var r=!0,l=!1,d=void 0;try{for(var p,m=s[Symbol.iterator]();!(r=(p=m.next()).done);r=!0){var u=p.value;if("undefined"!=typeof u&&"undefined"!=typeof u[0]&&u[0])return!0}}catch(c){l=!0,d=c}finally{try{!r&&m["return"]&&m["return"]()}finally{if(l)throw d}}}}catch(c){i=!0,a=c}finally{try{!t&&o["return"]&&o["return"]()}finally{if(i)throw a}}return!1};a<e.length;)n(e[a])?a++:(i.push(e[a]._id),e.splice(a,1));return i.length?_db.fleets.remove({_id:{$in:i}},{multi:!0},function(i,a){t.resolve(e)}):t.resolve(e),t.promise}},{key:"datacheck",value:function(e){return e=e||[],e.length||this.dom.container.addClass("nocontent"),e}},{key:"append_all_items",value:function(e){var t=this;e=e||[],e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),_g.log(e),this.trIndex=0,"undefined"==typeof Lockr.get("fleetlist-option-groupbytheme")&&Lockr.set("fleetlist-option-groupbytheme",!0);var i=Q.defer(),a=0;if(Lockr.get("fleetlist-option-groupbytheme"))!function(){var n={},o=0;e.forEach(function(e,t){n[e.theme]||(n[e.theme]=[]),n[e.theme].push(t)}),console.log(n);for(var s in n){for(a=0;a<t.flexgrid_empty_count;)a?$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(t.dom.tbody):t.flexgrid_ph=$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(t.dom.tbody),a++;n[s].forEach(function(t){setTimeout(function(t){this.append_item(e[t]),o++,o>=e.length-1&&i.resolve()}.bind(this)(t),0)}.bind(t)),$('<tr class="typetitle" data-trindex="'+ ++t.trIndex+'"><th colspan="'+(t.columns.length+1)+'"></th></tr>').appendTo(t.dom.tbody),t.trIndex++}}();else{for(;a<this.flexgrid_empty_count;)a?$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(this.dom.tbody):this.flexgrid_ph=$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(this.dom.tbody),a++;e.forEach(function(t,a){setTimeout(function(t){this.append_item(e[t]),t>=e.length-1&&i.resolve()}.bind(this)(a),0)}.bind(this))}return e.length||i.resolve(),i.promise}},{key:"append_item",value:function(e,t,i){if(!e)return!1;"undefined"==typeof t&&(t=this.trIndex,this.trIndex++);var a=$('<tr class="row"/>').attr({"data-trindex":t,"data-fleetid":e._id||"PLACEHOLDER","data-infos":"[[FLEET::"+e._id+"]]","data-theme":e.theme}).data({initdata:e});return this.columns.forEach(function(t){switch(t[1]){case" ":for(var i="<i>",n=e.data[0]||[],o=0;6>o;)i+=n[o]&&n[o][0]?'<img src="'+_g.path.pics.ships+"/"+n[o][0]+'/0.webp" contextmenu="disabled"/>':"<s/>",o++;i+="</i>",$("<th/>").attr("data-value",e.name).html(i+"<strong>"+e.name+"</strong><em></em>").appendTo(a);break;default:var s=e[t[1]];$("<td/>").attr("data-value",s).html(s).appendTo(a)}}),i?a.prependTo(this.dom.tbody):a.insertBefore(this.flexgrid_ph),a}},{key:"btn_new",value:function(){this.menu_new||(this.menu_new=new _menu({target:this.dom.btn_new,items:[$('<div class="menu_fleets_new"/>').append($("<menuitem/>").html("新建配置").on("click",function(){this.action_new()}.bind(this))).append($("<menuitem/>").html("导入配置代码").on("click",function(){t.modalImport||(t.modalImport=$("<div/>").append(t.modalImportTextarea=$("<textarea/>",{placeholder:"输入配置代码..."})).append($("<p/>").html('* 配置代码兼容<a href="http://www.kancolle-calc.net/deckbuilder.html">艦載機厨デッキビルダー</a>')).append(t.modalImportBtn=$('<button class="button"/>').html("导入"))),t.modalImportTextarea.val(""),t.modalImportBtn.off("click.import").on("click",function(){var e=t.modalImportTextarea.val();e&&(e=JSON.parse(e),e.length&&e.push||(e=_g.kancolle_calc.decode(e)),this.action_new({data:e}),_frame.modal.hide(),t.modalImportTextarea.val(""))}.bind(this)),_frame.modal.show(t.modalImport,"导入配置代码",{classname:"infos_fleet infos_fleet_import"})}.bind(this))).append($("<menuitem/>").html("导入配置文件").on("click",function(){this.dbfile_selector.trigger("click")}.bind(this)))]}),this.dbfile_selector=$('<input type="file" class="none"/>').on("change",function(){var e=this.dbfile_selector.val(),t=Q.fcall(function(){});this.dbfile_selector.val(""),t.then(function(){var t=Q.defer();return node.fs.readFile(e,"utf8",function(e,i){e?t.reject("文件载入失败",new Error(e)):t.resolve(i)}),t.promise}).then(function(e){var t=[],i=Q.defer();return e.split("\n").forEach(function(e){if(e){try{t.push(JSON.parse(e))}catch(a){i.reject("文件格式错误",a)}i.resolve(t)}else i.reject("文件无内容")}),i.promise}).then(function(e){var t=[],i=0;return e.forEach(function(e){var a=Q.defer();t.push(a.promise),_db.fleets.insert(e,function(t){i++,t&&"uniqueViolated"==t.errorType?_db.fleets.update({_id:e._id},e,{},function(e,t){a.resolve(),e?_g.log(e):_g.log(t)}):a.resolve()})}),Q.all(t)})["catch"](function(e,t){_g.log(e),_g.error(t)}).done(function(){_g.log("import complete"),this.refresh()}.bind(this))}.bind(this)).appendTo(this.dom.filters)),this.menu_new.show()}},{key:"btn_settings",value:function(){t.menuOptions_show(this.dom.btn_settings,this)}},{key:"action_new",value:function(e){e=e||{},console.log(e),_db.fleets.insert(this.new_data(e),function(e,t){console.log(e,t),e?_g.error(e):"fleets"==_frame.app_main.cur_page&&(_frame.infos.show("[[FLEET::"+t._id+"]]"),this.menu_new.hide())}.bind(this))}},{key:"parse_kancolle_calc_data",value:function(e){return this.new_data(e)}},{key:"contextmenu_show",value:function(e,i,a){t.contextmenu||(t.contextmenu=new _menu({className:"contextmenu-fleet",items:[$("<menuitem/>").html("详情").on({click:function(e){t.contextmenu.curel.trigger("click",[!0])}}),$("<menuitem/>").html("导出配置代码").on({click:function(e){InfosFleet.modalExport_show(t.contextmenu.curel.data("initdata"))}}),$("<menuitem/>").html("导出配置文本").on({click:function(e){InfosFleet.modalExportText_show(t.contextmenu.curel.data("initdata"))}}),$("<menuitem/>").html("移除").on({click:function(e){var i=t.contextmenu.curel.attr("data-fleetid");_db.fleets.remove({_id:i},{multi:!0},function(e,t){_g.log("Fleet "+i+" removed.")}),t.contextmenu.curel.remove()}})]})),t.contextmenu.curel=e,a?t.contextmenu.show(a.clientX,a.clientY):t.contextmenu.show(i||e)}},{key:"genlist",value:function(){var e=Q.fcall(function(){});e.then(function(){return this.loaddata()}.bind(this)).then(function(e){return this.validdata(e)}.bind(this)).then(function(e){return this.datacheck(e)}.bind(this)).then(function(e){return this.append_all_items(e)}.bind(this)).then(function(){setTimeout(function(){_frame.app_main.loaded("tablelist_"+this._index,!0)}.bind(this),100)}.bind(this))["catch"](function(e){_g.log(e)}).done(function(){_g.log("Fleets list DONE")})}},{key:"refresh",value:function(){this.dom.tbody.empty(),this.genlist()}}]),t}(Tablelist);TablelistFleets.menuOptions_show=function(e,t){TablelistFleets.menuOptions||(TablelistFleets.menuOptions=new _menu({className:"mod-checkbox menu-tablelistfleets-options",items:[$('<menuitem class="donot_hide option-groupbytheme"/>').append($("<input/>",{type:"checkbox",id:"_input_g"+_g.inputIndex}).prop("checked",Lockr.get("fleetlist-option-groupbytheme")).on("change",function(e){Lockr.set("fleetlist-option-groupbytheme",e.target.checked),TablelistFleets.menuOptions.curTablelist&&(TablelistFleets.menuOptions.curTablelist.dom.tbody.empty(),TablelistFleets.menuOptions.curTablelist.genlist())})).append($("<label/>",{"for":"_input_g"+_g.inputIndex++,html:"按主题颜色进行分组"})),$('<menuitem class="donot_hide option-aircraftdefaultmax"/>').append($("<input/>",{type:"checkbox",id:"_input_g"+_g.inputIndex}).prop("checked",Lockr.get("fleetlist-option-aircraftdefaultmax")).on("change",function(e){Lockr.set("fleetlist-option-aircraftdefaultmax",e.target.checked)})).append($("<label/>",{"for":"_input_g"+_g.inputIndex++,html:"新增飞行器熟练度默认为"}))]})),TablelistFleets.menuOptions.curTablelist=t||null,t?TablelistFleets.menuOptions.dom.menu.addClass("is-tablelist"):TablelistFleets.menuOptions.dom.menu.removeClass("is-tablelist"),TablelistFleets.menuOptions.show(e)};var TablelistShips=function(e){function t(e,i){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.columns=["  ",["火力","fire"],["雷装","torpedo"],["夜战","nightpower"],["对空","aa"],["对潜","asw"],["耐久","hp"],["装甲","armor"],["回避","evasion"],["搭载","carry"],["航速","speed"],["射程","range"],["索敌","los"],["运","luck"],["油耗","consum_fuel"],["弹耗","consum_ammo"],["多立绘","extra_illust"]],this.header_checkbox=[],this.checkbox=[],this.last_item=null,_frame.app_main.loading.push("tablelist_"+this._index),_frame.app_main.is_loaded=!1,e.children(".fixed-table-container").length?this.init_parse():this.init_new&&this.init_new()}return _inherits(t,e),_createClass(t,[{key:"compare_btn_show",value:function(e){!e&&this.dom.tbody.find('input[type="checkbox"].compare:checked').length||e?this.dom.msg_container.attr("data-msgs","comparestart"):this.dom.msg_container.removeAttr("data-msgs")}},{key:"compare_start",value:function(){this.dom.msg_container.removeAttr("data-msgs"),this.last_viewtype=this.dom.filter_container.attr("viewtype"),_config.set("shiplist-viewtype",this.last_viewtype),this.last_scrollTop=this.dom.table_container_inner.scrollTop(),this.dom.filter_container.attr("viewtype","compare"),this.dom.table_container_inner.scrollTop(0),this.dom.table.addClass("sortable"),this.mark_high(!0),this.thead_redraw(500)}},{key:"compare_off",value:function(){this.dom.filter_container.attr("viewtype",this.last_viewtype),this.sort_table_restore(),this.mark_high(),this.thead_redraw(500),this.dom.table_container_inner.scrollTop(this.last_scrollTop),this.dom.table.removeClass("sortable"),delete this.last_viewtype,delete this.last_scrollTop}},{key:"compare_end",value:function(){this.dom.tbody.find('input[type="checkbox"].compare:checked').prop("checked",!1).trigger("change"),this.dom.msg_container.removeAttr("data-msgs"),this.compare_off()}},{key:"compare_continue",value:function(){this.dom.msg_container.attr("data-msgs","comparestart"),this.compare_off()}},{key:"contextmenu_show",value:function(e,i,a){return"compare"==this.dom.filter_container.attr("viewtype")||"true"==e.attr("data-donotcompare")?!1:(t.contextmenu||(t.contextmenu=new _menu({className:"contextmenu-ship",items:[$("<menuitem/>").html("选择").on({click:function(e){_frame.app_main.is_mode_selection()&&_frame.app_main.mode_selection_callback(t.contextmenu._curid)},show:function(){_frame.app_main.is_mode_selection()?$(this).show():$(this).hide()}}),$("<menuitem/>").html("查看资料").on({click:function(e){t.contextmenu._curel.trigger("click",[!0])}}),$("<menuitem/>").html("将该舰娘加入对比").on({click:function(e){this.checkbox[t.contextmenu._curid].prop("checked",!this.checkbox[t.contextmenu._curid].prop("checked")).trigger("change")}.bind(this),show:function(e){return t.contextmenu._curid?(_g.data.ship_types[_g.data.ships[t.contextmenu._curid].type].donotcompare?$(e.target).hide():$(e.target).show(),void(this.checkbox[t.contextmenu._curid].prop("checked")?$(e.target).html("取消对比"):$(e.target).html("将该舰娘加入对比"))):!1}.bind(this)}),$("<div/>").on("show",function(e){var i=$(e.target).empty();if(t.contextmenu._curid){var a=_g.data.ships[t.contextmenu._curid].getSeriesData()||[];a.forEach(function(e,t){t||i.append($("<hr/>"));var a=null;try{a=this.checkbox[e.id]}catch(n){}i.append($('<div class="item"/>').html("<span>"+_g.data.ships[e.id].getName(!0)+"</span>").append($('<div class="group"/>').append(function(){var t=$();return _frame.app_main.is_mode_selection()&&(t=t.add($("<menuitem/>").html("选择").on({click:function(){_frame.app_main.is_mode_selection()&&_frame.app_main.mode_selection_callback(e.id)}}))),t}).append($('<menuitem data-infos="[[SHIP::'+e.id+']]"/>').html("查看资料")).append($("<menuitem/>").html(a&&a.prop("checked")?"取消对比":"加入对比").on({click:function(t){a&&this.checkbox[e.id].prop("checked",!a.prop("checked")).trigger("change")}.bind(this)}))))},this)}}.bind(this))]})),t.contextmenu._curid=i||e.data("shipid"),t.contextmenu._curel=e,void(a?t.contextmenu.show(a.clientX,a.clientY):t.contextmenu.show(e)))}},{key:"init_parse",value:function(){this.dom.filter_container=this.dom.container.children(".options"),this.dom.filters=this.dom.filter_container.children(".filters"),this.dom.exit_compare=this.dom.filter_container.children(".exit_compare"),this.dom.exit_compare.children('button[icon="arrow-set2-left"]').on("click",function(){this.compare_end()}.bind(this)),this.dom.exit_compare.children('button[icon="checkbox-checked"]').on("click",function(){this.compare_continue()}.bind(this)),this.dom.btn_compare_sort=this.dom.exit_compare.children('button[icon="sort-amount-desc"]').on("click",function(){this.dom.btn_compare_sort.hasClass("disabled")||this.sort_table_restore()}.bind(this)),this.dom.btn_hide_premodel=this.dom.filters.find('[name="hide-premodel"]').prop("checked","false"===_config.get("shiplist-filter-hide-premodel")?null:!0).on("change",function(e){_config.set("shiplist-filter-hide-premodel",this.dom.btn_hide_premodel.prop("checked")),this.dom.filter_container.attr("filter-hide-premodel",this.dom.btn_hide_premodel.prop("checked")),this.thead_redraw()}.bind(this)),this.dom.filters.find('[name="viewtype"]').each(function(e,t){t=$(t);var i=_config.get("shiplist-viewtype")||"card";t.val()==i&&t.prop("checked",!0),t.on("change",function(e){t.is(":checked")&&(_config.set("shiplist-viewtype",t.val()),this.dom.filter_container.attr("viewtype",t.val()),this.thead_redraw())}.bind(this))}.bind(this)),this.dom.filters.find("input").trigger("change"),this.dom.table_container=this.dom.container.children(".fixed-table-container"),this.dom.table_container_inner=this.dom.table_container.children(".fixed-table-container-inner"),this.dom.table=this.dom.table_container_inner.children("table.ships"),this.dom.table.find("thead td").on("click",function(e){this.sort_table_from_theadcell($(e.currentTarget))}.bind(this)),this.dom.tbody=this.dom.table.children("tbody"),this.dom.table.on("contextmenu.contextmenu_ship","tr[data-shipid]",function(e){this.contextmenu_show($(e.currentTarget),null,e),e.preventDefault()}.bind(this)).on("click.contextmenu_ship","tr[data-shipid]>th>em",function(e){this.contextmenu_show($(e.currentTarget).parent().parent()),e.stopImmediatePropagation(),e.stopPropagation()}.bind(this)),this.dom.msg_container=this.dom.container.children(".msgs"),_config.get("hide-compareinfos")?this.dom.msg_container.removeAttr("data-msgs"):this.dom.msg_container.attr("data-msgs","compareinfos"),this.parse_all_items();var e=this.dom.msg_container.children(".compareinfos");e.children("button").on("click",function(){this.dom.msg_container.removeAttr("data-msgs"),_config.set("hide-compareinfos",!0)}.bind(this)),this.dom.msg_container.children(".comparestart").on("click",function(){this.compare_start()}.bind(this))}},{key:"parse_all_items",value:function(){var e=-1;this.dom.tbody.children("tr.typetitle,tr.row").each(function(t,i){var a=this;i=$(i),i.hasClass("typetitle")?!function(){e++,a.last_item=i;var t=i.find('input[type="checkbox"]').on({change:function(){t.data("ships").filter(":visible").each(function(e,i){$(i).data("checkbox").prop("checked",t.prop("checked")).trigger("change",[!0])})},docheck:function(){var e=t.data("ships").filter(":visible"),i=e.filter("[compare-checked=true]");i.length?i.length<e.length?t.prop({checked:!1,indeterminate:!0}):t.prop({checked:!0,indeterminate:!1}):t.prop({checked:!1,indeterminate:!1})}}).data("ships",$());a.header_checkbox[e]=t}():!function(){var t=i.attr("data-donotcompare"),n=i.attr("data-shipid"),o=i.find('input[type="checkbox"]'),s=e;i.on("click",function(e,i){!i&&"em"!=e.target.tagName.toLowerCase()&&_frame.app_main.is_mode_selection()&&(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),t||_frame.app_main.mode_selection_callback(n))}),o.prop("disabled",t).on("click change",function(e,t){e.stopImmediatePropagation(),e.stopPropagation(),o.prop("checked")?i.attr("compare-checked",!0):i.removeAttr("compare-checked"),this.compare_btn_show(o.prop("checked")),t||this.header_checkbox[s].trigger("docheck")}.bind(a)),a.header_checkbox[s].data("ships",a.header_checkbox[s].data("ships").add(i)),i.data("checkbox",o),a.checkbox[n]=o}()}.bind(this)),this.mark_high(),this.thead_redraw(),_frame.app_main.loaded("tablelist_"+this._index,!0),delete this.last_item}}]),t}(Tablelist);