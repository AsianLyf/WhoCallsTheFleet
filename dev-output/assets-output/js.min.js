"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _instanceof(e,t){return null!=t&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return e&&e.constructor===Symbol?"symbol":typeof e}function _b(e){return _support.check(e)}function addHandler(e,t,a){if("undefined"!=typeof e.addEventListener)e.addEventListener(t,a,!1);else{if("undefined"==typeof e.attachEvent)throw"Incompatible browser";e.attachEvent("on"+t,a)}}function eventName(e,t){return t=t?"."+t:"",_g.event[e]?_g.event[e].split(" ").map(function(e){return e+t}).join(" "):e+t}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),$window=$(window),$document=$(document),$html=$("html"),$body=$("body"),$body_preventMouseover=!1,_g={isinit:!1,isload:!1,isfocus:document.hasFocus?document.hasFocus():!0,everfocus:document.hasFocus?document.hasFocus():!0,posttime:[],time_format:"m月d日",time_format2:"Y年m月d日",time_diff_range:3456e5,time_diff_range2:31536e6,last:{width:0,height:0},interval:{},initSize:20,baseSize:10,baseMultiper:1,lastBaseSize:10,pixelRatio:window.devicePixelRatio?window.devicePixelRatio:screen.deviceXDPI?screen.deviceXDPI/72:1,maxMultiper:Math.max(1,Math.ceil((screen.availHeight||screen.height||$window.height())/800*10)/10),strings:{},inputIndex:0,lang:"zh_cn",_:!1},_p={comp:{},el:{}},_frame={dom:{},init_all:function(){for(var e in _frame)_frame[e].init&&_frame[e].init()}},_module={},_page={},_data={};if("undefined"==typeof _huScrolled)var _huScrolled={};if(!_huScrolled.ver||_huScrolled.ver<1.2){_huScrolled.ver=1.2,_huScrolled.timeout=!1,_huScrolled.throttle=_huScrolled.throttle||100;var bIEnew=/\(Windows NT [0-9\.]+.+Trident\/[0-9\.]+.+rv.{1}[0-9\.]+\)/.test(navigator.userAgent),bIE=!(!window.attachEvent||window.opera)||bIEnew,el=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<9?$window:$document;el.on({"scroll.huScrolled":function(){return _huScrolled.timeout?!0:void(_huScrolled.timeout=setTimeout(function(){$document.trigger("huScrolled"),_huScrolled.timeout=null},_huScrolled.throttle))}})}if("undefined"==typeof _huResized)var _huResized={};if((!_huResized.ver||_huResized.ver<2.1)&&(_huResized.ver=2.1,_huResized.throttle=_huResized.throttle||300,_huResized.startSize={},_huResized.viewport=function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},$window.on({"resize.huResized":function(e,t){t=t||{};var a=_huResized.viewport(),i=_huResized.startSize.width||a.width,n=_huResized.startSize.height||a.height,o=Math.abs(a.width-i)>50||Math.abs(a.height-n)>50;_huResized.timeout&&(clearTimeout(_huResized.timeout),_huResized.timeout=null),_huResized.topmask||(_huResized.topmask=$("<div/>").css({"z-index":"16777269",display:"none",position:"fixed",width:"100%",height:"100%",top:0,left:0,"background-color":"rgba(0,0,0,.5)"}).appendTo($body)),!o||t.isInitial||_huResized.maskShowing||(_huResized.topmask.css("display","block"),_huResized.maskShowing=!0),o||_huResized.isChanging||(_huResized.startSize={width:a.width,height:a.height}),_huResized.isChanging=!0,_huResized.timeout=setTimeout(function(){$window.trigger("huResized"),_huResized.timeout=null,_huResized.maskShowing=!1,_huResized.isChanging=!1,_huResized.topmask.css("display","none"),a=_huResized.viewport(),_huResized.startSize={width:a.width,height:a.height}},t.isInitial?0:_huResized.throttle)}})),"undefined"==typeof _huCss)var _huCss={};(!_huCss.ver||_huCss.ver<1.2)&&(_huCss.ver=1.2,_huCss.cssprefix_result={},_huCss.csscheck=function(e){if(_huCss.csscheck_div||(_huCss.csscheck_div=document.createElement("div")),e in _huCss.csscheck_div.style)return!0;var t=e.split("-");e=t[0];for(var a=1;a<t.length;a++)e+=t[1].substr(0,1).toUpperCase()+t[1].substr(1);return e in _huCss.csscheck_div.style},_huCss.csscheck_full=function(e){return _huCss.cssprefix(e,null,!0)},_huCss.cssprefix=function(e,t,a){if(_huCss.cssprefix_result[e])var i=_huCss.cssprefix_result[e];else if(_huCss.cssprefix_result[e]===!1){if(a)return!1;var i=""}else{var i="",n=["-webkit-","-moz-","-ms-","-o-"],o=_huCss.csscheck(e);if(!o){i=!1;for(var r=0;r<n.length;r++)if(_huCss.csscheck(n[r]+e)){i=n[r];break}}if(_huCss.cssprefix_result[e]=i,a)return i=i===!1?!1:!0}return i=i===!1?"":i,t?i:i+e},_huCss.csscheck_3d=function(){return _huCss.csscheck_full("perspective")},_huCss.createSheet=function(e){var t=document.createElement("style");if(e&&(t.title=e),document.getElementsByTagName("head")[0].appendChild(t),window.createPopup||t.appendChild(document.createTextNode("")),e)for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].title==e)return document.styleSheets[a];return document.styleSheets[document.styleSheets.length-1]},_huCss.getSheet=function(e){return e=e||_huCss.sheet,e||(_huCss.sheet=_huCss.createSheet("__huCss_sheet"),e=_huCss.sheet),e},_huCss.getCssRulesNum=function(e){return e=_huCss.getSheet(e),e.cssRules?e.cssRules.length:0},_huCss.addRule=function(e,t,a,i){var n="";i=_huCss.getSheet(i);for(var o in t)_huCss.csscheck_full(o)?n+=_huCss.cssprefix(o)+":"+t[o]+";":"opacity"==o&&_huCss.csscheck_full("filter")&&(n+="filter:alpha(opacity="+100*t[o]+")");if(a||0===a||(a=i.cssRules?i.cssRules.length:_huCss.getCssRulesNum()),i.insertRule)i.insertRule(e+"{"+n+"}",a);else for(e=e.split(","),o=0;o<e.length;o++)i.addRule(e[o],n,a)},_huCss.removeRule=function(e,t){if(!e&&0!==e)return!1;t=_huCss.getSheet(t);try{t.deleteRule(e)}catch(a){t.removeRule(e)}});var _UA=navigator.userAgent,bChrome=/Chrome/.test(_UA),bChromeVer=bChrome?/Chrome\/([0-9\.]+)/.exec(navigator.appVersion):!1,bSafari=/Safari/.test(_UA)&&!bChrome,bFirefox=/Firefox/.test(_UA),bOpera=/Opera/.test(_UA),bWebkit=/WebKit/.test(_UA),bWebkitVer=bWebkit?/(AppleWebKit|Safari)\/([0-9\.]+)/.exec(navigator.appVersion):!1,bIEnew=/\(Windows NT [0-9\.]+.+Trident\/[0-9\.]+.+rv.{1}[0-9\.]+\)/.test(_UA),bIEnewVer=bIEnew?parseFloat(_UA.split("rv:")[1]):!1,bIE=!(!window.attachEvent||window.opera)||bIEnew,bIE6=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<7,bIE7=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<8,bIE8=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<9,bIE9=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<10,bIE10=bIE&&parseFloat(navigator.appVersion.split("MSIE")[1])<11,bIE11=bIEnewVer&&12>bIEnewVer,bGecko=!bIE&&!bIEnew&&!bWebkit&&-1!=_UA.indexOf("Gecko"),bIphone=/iPhone/i.test(_UA),bIpad=/iPad/i.test(_UA),bAndroid=/Android/i.test(_UA),bIOS=!1,bIOSver=bIphone||bIpad?/CPU.*OS\s*([0-9_]+)/i.exec(navigator.appVersion):!1,bMobile=bIphone||bIpad||bAndroid,bCSSrem=!bIE8,bCSS3=_huCss.csscheck_full("border-radius"),bCSS3A=_huCss.csscheck_full("animation"),bCSS3flex=_huCss.csscheck_full("flex"),b3D=_huCss.csscheck_full("perspective"),bCSS3calc=bCSSrem,bTouch=/Touch/.test(_UA),bUnsupport=bIE7,bHTML5m3u8=bMobile,bAccessYoutube=!1,bAccessTwitter=!1,bAccessFacebook=!1;if(bWebkitVer&&bWebkitVer.length&&(bWebkitVer=bWebkitVer[2]),bChromeVer&&bChromeVer.length&&(bChromeVer=parseFloat(bChromeVer[1])),bIOSver&&bIOSver.length&&(bIOSver=parseFloat(bIOSver[1].replace(/_/,".")),bIOS=!0),(bChromeVer&&29>bChromeVer||bIOSver&&7>bIOSver)&&(bCSS3flex=!1),bIOSver&&6>bIOSver&&(bCSS3calc=!1),bGecko?$html.addClass("gecko"):bIE11&&!bIE10?$html.removeClass("ie9").addClass("ie11"+(bTouch?" ie-touch":"")):bIE10&&!bIE9?$html.removeClass("ie9").addClass("ie10"+(bTouch?" ie-touch":"")):bMobile?($html.addClass("mobile"),bIOS&&$html.addClass("ios"),bIphone&&$html.addClass("iphone"),bIpad&&$html.addClass("ipad"),bAndroid&&$html.addClass("android")):537>bWebkitVer&&$html.addClass("oldwebkit"),bTouch&&$html.addClass("touch"),navigator.userAgent.match(/IEMobile\/10\.0/)){var msViewportStyle=document.createElement("style");msViewportStyle.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(msViewportStyle)}_g.getUrl=function(){return location.href.split("#")[0]},_g.uriSearchArr={},_g.uriHashArr={},_g.timeHash=function(){var e=new Date;return e=e.getTime()},_g.uriSearch=function(e){if(!_g.uriSearchArr.length){var t=location.search?location.search.split("?")[1]:"";t=t.split("&");for(var a=0;a<t.length;a++){var i=t[a].split("=");_g.uriSearchArr[i[0]]=i[1]||""}}return e?_g.uriSearchArr[e]:location.search.substr(location.search.indexOf("?")+1)},_g.uriHash=function(e,t,a){var i=location.hash,n=i?i.split("#")[1]:"";if(n=n.split("&"),!_g.uriHashInited){_g.uriHashArr={};for(var o in n){var r=n[o].split("=");""!==r[0]&&(_g.uriHashArr[r[0]]=r[1]||!1)}_g.uriHashInited=!0}if("object"==("undefined"==typeof e?"undefined":_typeof(e))){for(var s in e)i=_g.uriHash(s,e[s],i);location.hash=i}else if(t===!1||""===t)i=i.replace("&"+e+"="+_g.uriHashArr[e],"").replace(e+"="+_g.uriHashArr[e],""),"#"!=i&&""!=i&&i||(i="_"),location.hash=i;else if("undefined"!=typeof t){if(t==_g.uriHashArr[e])return t;var l=_g.uriHashArr[e]?i.replace(e+"="+_g.uriHashArr[e],e+"="+t):i+(""==i?"#":"&")+e+"="+t;return _g.uriHashArr[e]=t,a?l:(location.hash=l,t)}return e?_g.uriHashArr[e]||!1:location.hash.substr(location.hash.indexOf("#")+1)},_g.randNumber=function(e){var t=new Date;return t=t.getTime(),t=(9301*t+49297)%233280,e||(e=1e3),Math.ceil(t/233280*e)},_g.randInt=function(e,t){return Math.floor(Math.random()*parseInt(e)+(t?parseInt(t):0))},_g.scrollTo=function(e,t){if(isNaN(e)){e=$(e);var a=e.scrollTop()}else{t=e,e=$("html,body");var a=$window.scrollTop()}var i=Math.abs(a-t),n=$window.height(),o=n>=i?200:200*(i/n)*(2/3);e.stop().animate({scrollTop:t},o)},_g.get_em=function(e,t,a){var i=parseFloat(e);return t=t||$body,a=a||0,isNaN(i)?e:i/parseFloat(t.css("font-size"))+a+"em"},_g.get_fontsize=function(e){return e=e||$body,parseInt(e.css("font-size"))},_g.get_basesize=function(){return parseInt($body.css("font-size"))/_g.initSize*10},_g.get_basesize_true=function(){return parseInt($body.css("font-size"))},_g.get_basemultiper=function(){return parseFloat(_g.get_basesize()/10)},_g.get_rem=function(e){var t=parseFloat(e);return isNaN(t)?e:bCSSrem?t/_g.initSize+"rem":e},_g.rem=function(e,t){var a=parseFloat(e);return isNaN(a)?e:bCSSrem?(a=a/(_g.get_basesize()/10)/_g.initSize,t?a+"rem":Math.round(10*a)/10+"rem"):e},_g.px=function(e,t){var a=parseFloat(e);return isNaN(a)?e:bIE8?e:a*_g.initSize+(t?0:"px")},_g.get_animate_duration=function(e){return _g.isfocus?e:0},_g.goto_hash=function(e,t){if(e=e||location.hash,e=e.replace(/^([\#]{0,1})(.+)/,"$2"),"!"==e[0])return!1;var a=$("#"+e);if(!a.length)return!1;var i=a.offset().top,n=$window.scrollTop(),o=Math.abs(n-i),r=$window.height();return t=null==t?r>=o?200:200*(o/r)*(2/3):t,t?$("html,body").stop().animate({scrollTop:i},t,function(){location.hash=e}):($("html,body").scrollTop(i),location.hash=e),e},_g.time=function(e){if(!e)return _g.timeNow();for(var t,a=[{exp:/(\d{4}).(\d{1,2}).(\d{1,2})[^0-9]*(\d{0,2})[:]{0,1}(\d{0,2})[:]{0,1}(\d{0,2})([\+\-])(\d{2})\:(\d{2})/i,p:{year:1,month:2,day:3,hour:4,min:5,sec:6,zoneD:7,zoneH:8,zoneM:9}},{exp:/(\d{1,2}).(\d{1,2}).(\d{4})[^0-9]*(\d{0,2})[:]{0,1}(\d{0,2})[:]{0,1}(\d{0,2})/i,p:{year:3,month:1,day:2,hour:4,min:5,sec:6}},{exp:/(\d{4}).(\d{1,2}).(\d{1,2})[^0-9]*(\d{0,2})[:]{0,1}(\d{0,2})[:]{0,1}(\d{0,2})/i,p:{year:1,month:2,day:3,hour:4,min:5,sec:6}}],i=0;i<a.length;i++){var n=a[i].exp,o=e.match(n);if(!t&&o&&o.length){var r=parseInt(o[a[i].p.year]),s=parseInt(o[a[i].p.month])||0,l=parseInt(o[a[i].p.day])||1,d=parseInt(o[a[i].p.hour])||0,p=parseInt(o[a[i].p.min])||0,m=parseInt(o[a[i].p.sec])||0;if(t=new Date(r,s-1,l,d,p,m,0),a[i].p.zoneD&&o[a[i].p.zoneD]){var u="+"==o[a[i].p.zoneD]?-1:1,d=parseInt(o[a[i].p.zoneH])||0,p=parseInt(o[a[i].p.zoneM])||0,c=u*(p+60*d+t.getTimezoneOffset())*60*1e3;t=new Date(t.valueOf()+c)}}}return t},_g.timeCal=function(e,t){return 6e4>e?Math.floor(e/1e3)+"秒"+(t?"前":""):36e5>e?Math.floor(e/6e4)+"分钟"+(t?"前":""):864e5>e?Math.floor(e/36e5)+"小时"+(t?"前":""):1728e5>e?"昨天":2592e6>e?Math.floor(e/864e5)+"天"+(t?"前":""):31536e6>e?Math.floor(e/2592e6)+"月"+(t?"前":""):Math.floor(e/31536e6)+"年"+(t?"前":"")},_g.timeNow=function(){var e=new Date;return e.getTime()},_g.timeDiff=function(e){var t={time:_g.timeNow(),obj:null,format:_g.time_format,format2:_g.time_format2,range:_g.time_diff_range,range2:_g.time_diff_range2,is_init:!0};return $.extend(t,e),t.obj?e=t:!1},_g.timeDiffInterval=function(){function e(){if(!_g.isfocus)return!1;for(var e=0;e<_g.posttime.length;e++){var t=_g.posttime[e].is_init?_g.posttime[e]:_g.timeDiff(_g.posttime[e]),a=new Date,i=a.getTime()-t.time,n=t.range,o=t.range2;if(n>i)t.obj.html(6e4>i?"刚刚":_g.timeCal(i,!0));else{var r=i>o?t.format2:t.format,s=t.time;r=r.replace(/Y/g,s.getFullYear()),r=r.replace(/M/g,s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1),r=r.replace(/m/g,s.getMonth()+1),r=r.replace(/D/g,s.getDate()<10?"0"+s.getDate():s.getDate()),r=r.replace(/d/g,s.getDate()),t.obj.html(r)}}}clearInterval(_g.interval.posttime),e(),_g.interval.posttime=setInterval(function(){e()},6e4)};var _support={cache:{},check:function(e){return e=e.toLowerCase().replace(/[ :-_]/g,""),"undefined"==typeof _support.cache[e]&&_support["_"+e]&&(_support.cache[e]=_support["_"+e]()),_support.cache[e]}};_support._css3=function(){return _huCss.csscheck_full("border-radius")},_support._css3animation=function(){return _huCss.csscheck_full("animation")},_support._css3transition=function(){return _huCss.csscheck_full("transition")},_support._css3flex=function(){return _huCss.csscheck_full("flex")},_support._css33d=function(){return _huCss.csscheck_full("perspective")},_support._css3d=_support._css33d,_support._css3mediaquery=function(){return window.matchMedia||window.msMatchMedia?!0:!1},_support._mediaquery=_support._css3mediaquery,_support._css3imageset=function(){function e(e){a.css("background-image","image-set(url("+_g.pathImg+"_g-p.gif) 1x)");var t=a.css("background-image");return t&&"none"!=t?!0:e&&(a.css("background-image",e+"image-set(url("+_g.pathImg+"_g-p.gif) 1x)"),t=a.css("background-image"),t&&"none"!=t)?e:!1}var t=null,a=$("<div/>",{style:"background-image:url("+_g.pathImg+"_g-p.gif)"});return t=bWebkit?e("-webkit-"):bGecko?e("-moz-"):bIE?e("-ms-"):e()},_support._pluginflash=function(){var e=!1;try{e="undefined"!=typeof navigator.plugins&&"object"==_typeof(navigator.plugins["Shockwave Flash"])||window.ActiveXObject&&0!=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){}return e},_support._flash=_support._pluginflash,_support._html5attrdownload=function(){return"download"in document.createElement("a")},_support._html5download=_support._html5attrdownload,_support._html5attributedownload=_support._html5attrdownload,_support._html5videomp4=function(){var e=document.createElement("video"),t=!1;return e.canPlayType&&e.canPlayType("video/mp4").replace(/no/,"")&&(t=!0),t},_support._html5mp4=_support._html5videomp4,_g.init=function(){if(_g.baseSize=_g.get_basesize(),_g.baseMultiper=parseFloat(_g.baseSize/10),_g.lastBaseSize=_g.get_basesize(),_g.isfocus="visible"==Visibility.state(),_g.everfocus=_g.isfocus,Visibility.change(function(e,t){"visible"==t?(_g.isfocus=!0,_g.everfocus||(_g.everfocus=!0,_g.last.width=-1,_g.last.height=-1,_frame.main.last.width=-1,_frame.main.last.height=-1),$window.trigger("resized_check._g"),_g.timeDiffInterval()):_g.isfocus=!1}),$window.on({orientationchange:function(){$window.trigger("resize")},huResized:function(){$window.trigger("resized_check._g")},"resized_check._g":function(){if(!_g.isfocus)return!1;var e=$window,t=e.width(),a=e.height();if(_g.baseSize=_g.get_basesize(),_g.orientation=t>=a?"landscape":"portrait",_g.baseSize!=_g.lastBaseSize&&(_g.baseMultiper=parseFloat(_g.baseSize/10),_g.lastBaseSize=_g.baseSize,_g.isBaseChange=!0,e.trigger("basechange")),t!=_g.last.width||a!=_g.last.height){var i={is_widthchange:t!=_g.last.width,is_heightchange:a!=_g.last.height};e.trigger("resized_before",[i]).trigger("resized",[i]),_g.isEverResized=!0}_g.last.width=t,_g.last.height=a},basechange:function(){_g.isBaseChange&&(_g.isBaseChange=!1,setTimeout(function(){$window.trigger("resized_before").trigger("resized",[{is_basechange:!0}])},_g.animate_duration_delay))},"load.trigger_resized":function(){return _g.isfocus?(setTimeout(function(){$window.trigger("resized_before",[{is_load:!0}]).trigger("resized",[{is_load:!0}])},_g.readyLock?4*_g.animate_duration+10:0),void(_g.isload=!0)):!1},"hashchange._global":function(e){_g.uriHashArr={};var t=(location.hash?location.hash.split("#")[1]:"").split("&");for(var a in t){var i=t[a].split("=");""!==i[0]&&(_g.uriHashArr[i[0]]=i[1]||!1)}_g.uriHashInited=!0,_g.uriHash()&&""!=_g.uriHash()||(e.preventDefault(),e.stopPropagation())},"unload.focuswindow":function(){$(this).focus()}}),setTimeout(function(){$window.trigger("hashchange")},_g.animate_duration_delay+10),$document.on({huScrolled:function(){$window.trigger("scrolled")}}),$body.data("preventMouseover",!1).on({"touchstart.preventMouseover":function(){$body.removeClass("hover"),$body_preventMouseover=!0},"touchend.preventMouseover":function(){setTimeout(function(){$body_preventMouseover=!1},1)},pointerover:function(e){"touch"==e.originalEvent.pointerType&&$body.trigger("touchstart.preventMouseover")},pointerleave:function(e){"touch"==e.originalEvent.pointerType&&$body.trigger("touchend.preventMouseover")},mouseenter:function(){$body_preventMouseover?$body_preventMouseover=!1:$body.addClass("hover")},mouseleave:function(){$body.removeClass("hover")}}),top!=self)try{self.location.host!=top.location.host&&top.location.replace(self.location.href),self.location.host==top.location.host&&($body.addClass("only-content"),_g.changeTheme(top._g.getTheme())),$html.css("font-size",top.$html.css("font-size")),$window.on({"resized.iframe_resize":function(){$html.css("font-size",top.$html.css("font-size"))}})}catch(e){}_hotkey.init(),_frame.init_all(),_p.init_document_ready(),$html.addClass("ready"),$window.trigger("resize",[{isInitial:!0}]),_g.readyLock=!0,setTimeout(function(){_g.readyLock=null},4*_g.animate_duration+10);try{window.external.msSiteModeClearBadge()}catch(e){}return _g.isinit=!0,!1},jQuery.cookie=function(e,t,a){if("undefined"==typeof t){var i=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var r=jQuery.trim(n[o]);if(r.substring(0,e.length+1)==e+"="){i=decodeURIComponent(r.substring(e.length+1));break}}return i}a=a||{},null===t&&(t="",a.expires=-1);var s="";if(a.expires&&("number"==typeof a.expires||a.expires.toUTCString)){var l;"number"==typeof a.expires?(l=new Date,l.setTime(l.getTime()+24*a.expires*60*60*1e3)):l=a.expires,s="; expires="+l.toUTCString()}var d="; path="+(a.path?a.path:"/"),p=a.domain?"; domain="+a.domain:/(.*)([\.]*)acgdb\.com/.test(location.host)?"; domain=.acgdb.com":"",m=a.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),s,d,p,m].join("")},function(e){e.fn.innerWidth=function(){return parseFloat(this.css("width"))},e.fn.innerHeight=function(){return parseFloat(this.css("height"))}}(jQuery),$.fn.serializeObject=function(){function e(a,i,n){if(!i.length)return a;var o=i[0];"undefined"==typeof a[o]?a[o]=i.length>1?{}:n:1==i.length&&(a[o].push||(a[o]=[a[o]]),a[o].push(t(n))),i.shift(),e(a[o],i,n)}function t(e){return"number"==typeof e&&0===e?e:e||""}var a={},i=this.serializeArray();return $.each(i,function(){if(!/^_tabview\-/.test(this.name))if(this.value=isNaN(this.value)||!this.value?this.value:parseFloat(this.value),this.name.indexOf(".")>-1){var i=this.name.split(".");e(a,i,this.value)}else a[this.name]||0===a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(t(this.value))):a[this.name]=t(this.value)}),a},_p.initDOM=function(e){return e=e||_frame.dom.layout||_frame.dom.layout||$body,e.initAll()},_p.initAll=_p.initDOM,$.fn.initDOM=function(){for(var e in _p.el)_p.el[e].init&&_p.el[e].init(this);return this},$.fn.initAll=$.fn.initDOM,_p.init_document_ready=function(){_p.is_init_document_ready||(_p.initDOM($body),_p.is_init_document_ready=!0)},_p.getSummary=function(){var e=$("#summary").text()||!1;return!e&&$("head").find("meta[name=keywords]").length&&(e=$("head").find("meta[name=Description]").attr("content"),e=e.substr(0,e.indexOf(" - ACGDB"))),e},_p.get_tar=function(e,t,a){return e=e||_frame.dom.layout||$("#layout")||$body,"."==t.substr(0,1)&&(t=t.substr(1)),e.hasClass(t)?e:a?e.find('[class^="'+t+'"]'):e.find("."+t)},_p.hashlinks=function(e){e=e||$body,e.find("a[href^=#]").each(function(){$(this).off("click.hashlink").on({"click.hashlink":function(){return _g.goto_hash($(this).attr("href")),!1}})})},_p.get_lines=function(e,t){return t=t||e,Math.max(1,Math.floor(Math.min(e.innerHeight(),e.height())/parseFloat(t.css("line-height"))))},_p.el.time={init:function(e){var t=_p.get_tar(e,".time");t.each(function(){var e=$(this),t=e.text();time=t?_g.time(t):null,time&&_g.posttime.push({time:time,obj:e})}),_g.timeDiffInterval()}},_p.el.timeSec={init:function(e){var t=_p.get_tar(e,".time-sec");t.each(function(){var e=$(this);if(e.data("acgdb-time-sec"))return e.data("acgdb-time-sec");var t=e.text(),a=/\s*([0-9]+)/.exec(t);if(a&&a.length>1){a=parseInt(a[1]);var i=Math.floor(a/60),n=a%60,o=(10>i?"0":"")+i+":"+(10>n?"0":"")+n+"'";e.text(o)}e.data("acgdb-time-sec",a)})}},_p.removeEmptyTextNode=function(e){return e=$(e),e.length?void e.contents().filter(function(){return 3===this.nodeType}).remove():!1},Object.defineProperty(Array.prototype,"mergeFrom",{enumerable:!1,value:function(e){return Array.prototype.push.apply(this,_instanceof(e,Array)?e:[e]),this}}),Date.prototype.format=function(e,t){return _g.formatTime(this,e,t)},_g.formatTime_string={zh_CN:{Midnight:"深夜",Sunday:"周日",Monday:"周一",Tuesday:"周二",Wednesday:"周三",Thursday:"周四",Friday:"周五",Saturday:"周六"}},_g.formatTime_weekdaymappding=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_g.formatTime=function(e,t,a){function i(e){return 10>e?"0"+e:e}if(!e)return!1;a=a||{},t=t||"%Y年%m月%d日","date"!=typeof e&&(e=new Date(e));var n=e.valueOf();"undefined"!=typeof a.output_timezone&&(n+=60*(a.output_timezone+e.getTimezoneOffset()/60)*60*1e3,e=new Date(n));var o=e.getHours(),r=i(o);return a.midnight_astoday&&(6>o||24==o)?(o+=24,r=o,n-=864e5,e=new Date(n),t=t.replace(/\%midnight/g,"Midnight"._(_g.formatTime_string))):t=t.replace(/\%midnight/g,""),t.replace(/\%Y/g,e.getFullYear()).replace(/\%m/g,i(e.getMonth()+1)).replace(/\%n/g,e.getMonth()+1).replace(/\%d/g,i(e.getDate())).replace(/\%j/g,e.getDate()).replace(/\%G/g,o).replace(/\%H/g,r).replace(/\%i/g,i(e.getMinutes())).replace(/\%s/g,i(e.getSeconds())).replace(/\%l/g,_g.formatTime_weekdaymappding[e.getDay()]._(_g.formatTime_string))},Object.defineProperty(Object.prototype,"_size",{enumerable:!1,get:function(){var e=0;for(var t in this)e++;return e}}),String.prototype.getText=function(e,t){return _g.getText(this,e,t,!0)},String.prototype._=String.prototype.getText,_g.getText=function(e,t,a,n){function o(e){return"object"==("undefined"==typeof e?"undefined":_typeof(e))&&e.length?e[0]:e}if(!e||!t)return e;a=a||_g.lang;if(t[e]){if("string"==typeof t[e])return o(t[e]);if(t[e][a])return o(t[e][a])}if(t[a]&&t[a][e])return o(t[a][e]);if("string"!=typeof e&&n){for(_t="",i=0;i<e.length;i++)_t+=e[i];e=_t}return o(e)},_g.hashCode=function(e){var t=5;e=encodeURIComponent(e);try{return e.split("").reduce(function(e,a){return e=(e<<t)-e+a.charCodeAt(0),e&e},0).toString(16)}catch(a){var i,n,o=0;if(0==e.length)return o;for(i=0,l=e.length;i<l;i++)n=e.charCodeAt(i),o=(o<<t)-o+n,o|=0;return o.toString(16)}},String.prototype.hashCode=function(){return _g.hashCode(this)},String.prototype.filter=function(){return _g.stringFilter(this)},String.prototype.filterCensored=function(){return _g.stringFilterCensored(this)},String.prototype.escape=function(){return $("<div />").text(this).html()};var _tmpl={"export":function(e,t){return e.attr&&t?e.prop("outerHTML"):e.attr&&!t?e:!e.attr&&t?e:e.attr||t?void 0:$(e)}},_hotkey={allowed:!0,keyCodeBindings:{}};_hotkey.bind=function(e,t,a,i){if("function"==typeof t)return _hotkey.bind(e,null,t,a);if(!e||!a)return!1;e=parseInt(e),t="text"==typeof t?[t]:t||[],i=i||{},"undefined"==typeof _hotkey.keyCodeBindings[e]&&(_hotkey.keyCodeBindings[e]={"default":[],meta:[],alt:[],shift:[],"meta+alt":[],"meta+shift":[],"alt+shift":[],"meta+alt+shift":[]});var n=!1,o=!1,r=!1;for(var s in t)t[s]=t[s].toLowerCase(),("ctrl"==t[s]||"meta"==t[s])&&(n=!0),"alt"==t[s]&&(o=!0),"shift"==t[s]&&(r=!0);return n&&o&&r?_hotkey.keyCodeBindings[e]["meta+alt+shift"].push(a):n&&o?_hotkey.keyCodeBindings[e]["meta+alt"].push(a):n&&r?_hotkey.keyCodeBindings[e]["meta+shift"].push(a):o&&r?_hotkey.keyCodeBindings[e]["alt+shift"].push(a):n?_hotkey.keyCodeBindings[e].meta.push(a):o?_hotkey.keyCodeBindings[e].alt.push(a):r?_hotkey.keyCodeBindings[e].shift.push(a):_hotkey.keyCodeBindings[e]["default"].push(a),!0},_hotkey._run=function(e){for(var t in e)e[t]()},_hotkey.init=function(){return _hotkey.is_init?_hotkey:($window.on("keydown._hotkey",function(e){if("INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&"SELECT"!=document.activeElement.tagName&&!document.activeElement.hasAttribute("contenteditable")&&_hotkey.allowed){var t=parseInt(e.keyCode||e.which);_hotkey.keyCodeBindings[t]&&((e.ctrlKey||e.metaKey)&&e.altKey&&e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t]["meta+alt+shift"]):(e.ctrlKey||e.metaKey)&&e.altKey?_hotkey._run(_hotkey.keyCodeBindings[t]["meta+alt"]):(e.ctrlKey||e.metaKey)&&e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t]["meta+shift"]):e.altKey&&e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t]["alt+shift"]):e.ctrlKey||e.metaKey?_hotkey._run(_hotkey.keyCodeBindings[t].meta):e.altKey?_hotkey._run(_hotkey.keyCodeBindings[t].alt):e.shiftKey?_hotkey._run(_hotkey.keyCodeBindings[t].shift):e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||_hotkey._run(_hotkey.keyCodeBindings[t]["default"]))}}),void(_hotkey.is_init=!0))};var _form={};_form.section=function(e,t,a,i,n,o){if(!e)return!1;if("object"==("undefined"==typeof e?"undefined":_typeof(e)))return _form.section(e.type,e.name||null,e.label||null,e.value||null,e.suffix||null,e);if("object"==("undefined"==typeof t?"undefined":_typeof(t)))return _form.section(e,t,t.label||null,t.value||null,t.suffix||null,t);if("object"==("undefined"==typeof a?"undefined":_typeof(a)))return _form.section(e,t,a.label||null,a.value||null,a.suffix||null,a);if("object"==("undefined"==typeof i?"undefined":_typeof(i)))return _form.section(e,t,d,i.value||null,i.suffix||null,i);if("object"==("undefined"==typeof n?"undefined":_typeof(n)))return _form.section(e,t,d,i||null,n.suffix||null,n);o=o||{};var r=$("<dl/>").addClass(e,o.className),s=$("<dt/>").appendTo(r),l=$("<dd/>").appendTo(r),d="_input_g"+_g.inputIndex;switch(_g.inputIndex++,e){case"directory":$("<label/>").html(a).appendTo(s);break;default:n?$("<label/>").html(a).appendTo(s):$('<label for="'+d+'"/>').html(a).appendTo(s)}return _form.element(e,t,d,i,o).appendTo(l),n&&$('<label for="'+d+'"/>').html(n).appendTo(l),o.add&&l.append(o.add),l},_form.line=_form.section,_form.element=function(e,t,a,i,n){if(!e)return!1;if("object"==("undefined"==typeof e?"undefined":_typeof(e)))return _form.element(e.type,e.name||null,e.id||null,e.value||null,e);if("object"==("undefined"==typeof t?"undefined":_typeof(t)))return _form.element(e,t,t.id||null,t.value||null,t);if("object"==("undefined"==typeof a?"undefined":_typeof(a)))return _form.element(e,t,a.id||null,a.value||null,a);if("object"==("undefined"==typeof i?"undefined":_typeof(i)))return _form.element(e,t,a,i.value||null,i);n=n||{},a=a||null,null===a&&(a="_input_g"+_g.inputIndex,_g.inputIndex++);var o=$(),r=n["default"]||n.defaultValue;switch(e){default:o=$("<input/>",{type:e,name:t,id:a}).val(i);break;case"select":o=$("<select/>",{name:t,id:a}).val(i);var s=$('<option value=""/>').appendTo(o);for(var l in i){if("object"==_typeof(i[l]))var d=i[l].value||i[l].val,p=$('<option value="'+d+'"/>').html(i[l].title||i[l].name).appendTo(o);else var d=i[l],p=$('<option value="'+d+'"/>').html(d).appendTo(o);"undefined"!=typeof r&&d==r&&p.prop("selected",!0),p.val()||p.attr("disabled",!0)}i&&i.length||s.html("..."),n["new"]&&($('<option value="" disabled/>').html("==========").insertAfter(s),$('<option value="___new___"/>').html("+ 新建").insertAfter(s),o.on("change.___new___",function(){"___new___"==o.val()&&(o.val(""),n["new"](o))}));break;case"select_group":case"selectGroup":o=$("<select/>",{name:t,id:a}).val(i);var s=$('<option value=""/>').appendTo(o);for(var l in i){var m=$('<optgroup label="'+i[l][0]+'"/>').appendTo(o);for(var u in i[l][1]){var c=i[l][1][u];if("object"==("undefined"==typeof c?"undefined":_typeof(c)))var p=$('<option value="'+("undefined"==typeof c.val?c.value:c.val)+'"/>').html(c.title||c.name).appendTo(m);else var p=$('<option value="'+c+'"/>').html(c).appendTo(m);"undefined"!=typeof r&&p.val()==r&&p.prop("selected",!0),p.val()||p.attr("disabled",!0)}}i&&i.length||s.html("..."),n["new"]&&($('<option value="" disabled/>').html("==========").insertAfter(s),$('<option value="___new___"/>').html("+ 新建").insertAfter(s),o.on("change.___new___",function(){"___new___"==o.val()&&(o.val(""),n["new"](o))}));break;case"checkbox":o=$("<input/>",{type:e,name:t,id:a}),"string"==typeof i&&"true"!==i.toLowerCase()?o.val(i).prop("checked",n.checked):o.prop("checked","undefined"==typeof n.checked?i:n.checked);break;case"checkboxes":for(var l in i){var d=i[l];"object"!=("undefined"==typeof d?"undefined":_typeof(d))&&(d=[d,!1]),parseInt(l)&&(_g.inputIndex++,a="_input_g"+_g.inputIndex),o=o.add($('<input type="checkbox" name="'+t+'" id="'+a+'" value="'+d[0]+'" />').prop("checked",d[1])).add($('<label for="'+a+'"/>').html(d[2]||d[0]))}break;case"directory":case"file":o=$('<input type="text" name="'+t+'" id="'+a+'" />').on({input:function(){o.trigger("change")},click:function(){o.val()||_.trigger("click")}}).val(i);var h=$('<input type="file" class="none"'+("directory"==e?" nwdirectory":"")+" />").on("change",function(){o.val($(this).val()).trigger("change")}),_=$('<button type="button" value="Browse..."/>').html("Browse...").on("click",function(){h.trigger("click")}),f=o.add(h).add(_);n.accept&&h.attr("accept",n.accept)}return n.required&&o.prop("required",!0),n.onchange&&(o.on("change.___onchange___",n.onchange),n["default"]&&o.trigger("change")),f?f:o},_frame.dom={},_frame.main={last:{}},_frame.global={key_registerd:[],esc_funcs:[],allowKeyNav:!0,esc_register:function(e){_frame.global.esc_funcs.push(e)},disableBodyScroll:function(){$(document.body).on("touchmove.disableBodyScroll mousewheel.disableBodyScroll",function(e){e.preventDefault(),e.stopPropagation()})},enableBodyScroll:function(){$(document.body).off("touchmove.disableBodyScroll mousewheel.disableBodyScroll")}},_frame.global.init=function(){return _frame.global.is_init?!0:(_frame.dom={layout:$("#layout")},$body.on({"keydown.esckey":function(e){if("INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&"SELECT"!=document.activeElement.tagName&&!$(document.activeElement).attr("contenteditable")&&_frame.global.allowKeyNav){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var t=window.event?e.keyCode:e.which;t=t.toString()}}else if(!_frame.global.allowKeyNav&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){
var t=window.event?e.keyCode:e.which;switch(t=t.toString()){case"27":for(var a=0;a<_frame.global.esc_funcs.length;a++)_frame.global.esc_funcs[a]()}}}}),_frame.dom.hidden=$("<div/>",{"class":"none"}).appendTo($body),_frame.dom.hiddenVisible=$("<div/>",{"class":"none-visible"}).appendTo($body),_frame.dom.hiddenIframe=$("<iframe/>",{"class":"none",name:"hiddeniframe"}).appendTo($body),$body.on("submit.check_submitting_status","form",function(e){var t=$(this);(t.hasClass("submitting")||t.hasClass("loading")||t.hasClass("disabled"))&&e.preventDefault()}),_frame.global.is_init=!0,!0)};var _menu=function(e){this.settings||(this.settings=$.extend(!0,{},this.defaults,e||{}),this.init())};_menu.prototype.defaults={items:[],target:null,className:null,showBlured:!0},_menu.prototype.init=function(){var e=this;this.dom={},this.dom.menu=$('<div class="menu"/>').addClass(this.settings.className).on("click",function(){e.timeout_hideself||(e.timeout_hideself=setTimeout(function(){e.timeout_hideself=null,e.hide()},10))}).appendTo(_frame.menu.dom.container),this.dom.body=$('<div class="body"/>').appendTo(this.dom.menu),this.dom.menu.on({"transitionend.menu_hide webkitTransitionEnd.menu_hide mozTransitionEnd.menu_hide":function(t){t.currentTarget==t.target&&"opacity"==t.originalEvent.propertyName&&0===parseFloat(e.dom.menu.css("opacity"))&&e.hideTrue()}});for(var t in this.settings.items){var a=e.settings.items[t];switch(a){case"separator":a=$("<hr/>")}a.hasClass("donot_hide")&&a.on("click",function(){setTimeout(function(){clearTimeout(e.timeout_hideself),e.timeout_hideself=null},1)}),e.appendItem(a)}_frame.menu.menus.push(this)},_menu.prototype.show=function(e,t,a){if(this.showing)return this;if("number"==typeof e)return this.show("mouse",e,t);var i,n,o,r,s,l;if(e=e||this.settings.target,clearTimeout(_frame.menu.timeout_hideall),_frame.menu.timeout_hideall=null,this.dom.menu.addClass("show"),_frame.menu.dom.container.addClass("on"),this.showing=!0,this.dom.body.children().trigger("show"),e&&_instanceof(e,jQuery)){var d=e.offset();i=d.top+e.height()-$body.scrollTop(),n=d.left-$body.scrollLeft()}else("mouse"==e||!e&&"number"==typeof t)&&(n=t||0,i=a+5||0);o=$window.height()-10,r=$window.width()-10,s=this.dom.menu.outerHeight(),l=this.dom.menu.outerWidth(),this.dom.menu.css({top:i+s>o?o-s:i,left:n+l>r?r-l:n}),this.settings.showBlured&&"undefined"!=typeof node?node.win.capturePage(this.capturePage_callback.bind(this),"jpg","datauri"):this.dom.menu.addClass("on")},_menu.prototype.hide=function(){return this.showing?(this.dom.menu.hasClass("on")||this.hideTrue(),void this.dom.menu.removeClass("on")):!1},_menu.prototype.hideTrue=function(){this.dom.menu.removeClass("show").css({top:"",left:""}),_instanceof(this.dom.blured,jQuery)&&(this.dom.blured.remove(),delete this.dom.blured),this.showing=!1,_frame.menu.dom.container.removeClass("on")},_menu.prototype.appendItem=function(e){return _instanceof(e,jQuery)?e.appendTo(this.dom.body):void 0},_menu.prototype.capturePage_callback=function(e){console.log(this),this.showing&&(this.dom.blured=$('<s class="blured"/>').css("background-image","url("+e+")").appendTo(this.dom.menu.addClass("on")))},_menu.hideAll=function(e){_frame.menu.timeout_hideall=setTimeout(function(){for(var e in _frame.menu.menus)_frame.menu.menus[e].hide&&_frame.menu.menus[e].hide();_frame.menu.timeout_hideall=null},e||1)},_frame.menu={dom:{},menus:[],init:function(){return this.is_init?this:(this.dom.container=$('<div class="menus"/>').on({click:function(e,t){_menu.hideAll(t)},contextmenu:function(){_frame.menu.dom.container.trigger("click")}}).appendTo($body),$body.on("click.cancel_hideall",".menus>.menu",function(e){clearTimeout(_frame.menu.timeout_hideall),_frame.menu.timeout_hideall=null}),void(this.is_init=!0))}},_frame.modal={dom:{},defaults:{classname:"",showBlured:!0},show:function(e,t,a,i){clearTimeout(_frame.modal.hide_timeout),_frame.modal.hide_timeout=null,_frame.modal.dom.container.addClass("show"),_frame.modal.showing=!0;var n=$.extend({},_frame.modal.defaults,a);e.appendTo(_frame.modal.dom.content),t?(_frame.modal.dom.titlebar.html(t),_frame.modal.dom.container.addClass("hastitle")):(_frame.modal.dom.titlebar.html(""),_frame.modal.dom.container.removeClass("hastitle")),_frame.modal.dom.box.css({width:n.width||null,height:n.height||null}),n.showBlured&&(_frame.modal.dom.blured||node.win.capturePage(function(e){_frame.modal.dom.blured=$("<img/>").attr("src",e).appendTo(_frame.modal.dom.bg)},"jpg","datauri"),_frame.modal.dom.container.addClass("bluredbg")),_frame.modal.dom.container.addClass("on "+n.classname).data("customclass",n.classname),_p.initDOM(_frame.modal.dom.content),_frame.modal.dom.bg.off("click.blank_to_close").on("click.blank_to_close",function(){n.blank_to_close&&_frame.modal.dom.btn_close.trigger("click")}),i&&i(_frame.modal.dom.content)},hide:function(){return _frame.modal.showing?(clearTimeout(_frame.modal.hide_timeout),_frame.modal.hide_timeout=null,void _frame.modal.dom.container.removeClass("on")):!1},reset:function(){_frame.modal.resetContent(),_frame.modal.dom.blured&&(parseInt(_frame.modal.dom.container.css("opacity"))||(_frame.modal.dom.blured.remove(),_frame.modal.dom.blured=null),_frame.modal.dom.container.removeClass("bluredbg"))},resetContent:function(){_frame.modal.dom.content.empty(),_frame.modal.dom.container.removeClass(_frame.modal.dom.container.data("customclass")),_frame.modal.dom.container.data("customclass",""),_frame.modal.dom.titlebar.html(""),_frame.modal.dom.container.removeClass("hastitle")}},_frame.modal.init=function(){return _frame.modal.is_init?!0:(_frame.modal.dom.container=$('<div class="modal" />').on({"transitionend.modal_hide webkitTransitionEnd.modal_hide mozTransitionEnd.modal_hide":function(e){_frame.modal.showing&&e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&parseFloat($(this).css("opacity"))<=0&&(_frame.modal.hide_timeout=setTimeout(function(){_frame.modal.reset(),_frame.modal.dom.container.removeClass("show"),_frame.modal.showing=!1},10))}}).prependTo($body),_frame.modal.dom.box=$("<div/>").appendTo(_frame.modal.dom.container),_frame.modal.dom.titlebar=$("<header/>").appendTo(_frame.modal.dom.box),_frame.modal.dom.content=$("<section/>").appendTo(_frame.modal.dom.box),_frame.modal.dom.btn_close=$('<button class="close" />').html("&times;").on("click",function(){_frame.modal.hide()}).appendTo(_frame.modal.dom.box),_frame.modal.dom.bg=$("<s/>").appendTo(_frame.modal.dom.container),_hotkey.bind("27",function(){_frame.modal.hide()}),_frame.modal.is_init=!0,!0)},_p.tip={pos:"bottom",size_indicator:8,filters:[],countdown_fade:250,init_global:function(){return _p.tip.is_init?!1:(_p.tip.dom=$('<div id="tip"/>').on("transitionend webkitTransitionEnd mozTransitionEnd",function(e){e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&0==parseFloat(_p.tip.dom.css("opacity"))&&(_p.tip.dom.removeClass("show").css({top:"",left:""}).attr({"data-tip-indicator-pos":"","data-tip-indicator-offset-x":"","data-tip-indicator-offset-y":""}),_p.tip.dom_bluredbg.css("background-image",""))}).appendTo($body),_p.tip.dom_body=$('<div class="body"/>').appendTo(_p.tip.dom),_p.tip.dom_bluredbg=$("<div/>").appendTo($('<div class="bluredbg"/>').appendTo(_p.tip.dom)),void(_p.tip.is_init=!0))},show:function(e,t,a){return $("body").data("preventMouseover")||!e?!1:(clearTimeout(_p.tip.timeout_fade),_p.tip.timeout_fade=null,t=t||"body",_p.tip.el=$(t),a=a||_p.tip.pos,e=_p.tip.content(e),_p.tip.init_global(),_p.tip.dom.hasClass("show")||("undefined"!=typeof node&&node.win.capturePage(function(e){_p.tip.dom_bluredbg.css("background-image","url("+e+")")},"jpg","datauri"),_p.tip.dom.addClass("show")),_p.tip.position(e,a),void(_p.tip.is_showing=!0))},position:function(e,t){var a=e.hashCode();_p.tip.curContent!=a&&(_p.tip.dom.css({top:"-1000px",left:"-1000px"}),_p.tip.dom_body.html(e),_p.initDOM(_p.tip.dom_body),_p.tip.curContent=a);var i=_p.tip["pos_"+t](_p.tip.dom.outerWidth(),_p.tip.dom.outerHeight());i&&_p.tip.move(i.x,i.y)},hide:function(e){return _p.tip.is_init&&_p.tip.is_showing?void(_p.tip.timeout_fade=setTimeout(function(){_p.tip.el=null,_p.tip.dom.removeClass("on"),_p.tip.is_showing=!1,_p.tip.curContent=null},e?0:_p.tip.countdown_fade)):!1},content:function(e,t){return t=t||_p.tip.el,e},move:function(e,t){_p.tip.dom.css({top:t,left:e}).addClass("on")},get_indicator_size:function(){return _p.tip.size_indicator*_g.baseMultiper},pos_mouse:function(e,t){_p.tip.el.unbind("mousemove.tooltip").bind("mousemove.tooltip",function(a){var i=25,n=a.pageX+i,o=a.pageY+20,r=jQuery(window).innerWidth(),s=jQuery(window).innerHeight(),l=jQuery(window).scrollTop(),d=jQuery(window).scrollLeft();n+e+i>r+d&&(n=n-e-i-20),o+10+t>s+l&&(o=s+l-t-10),_p.tip.move(n,o)})},pos_bottom:function(e,t){var a=_p.tip.el,i=_p.tip.dom,n=a.offset(),o=n.left+(a.outerWidth()-i.outerWidth())/2,r=n.top+a.outerHeight()+_p.tip.get_indicator_size();return _p.tip.dom.attr("data-tip-indicator-pos","top"),_p.tip.checkpos(o,r,e,t)},pos_top:function(e,t){var a=_p.tip.el,i=_p.tip.dom,n=a.offset(),o=n.left+(a.outerWidth()-i.outerWidth())/2,r=n.top-t-_p.tip.get_indicator_size();return _p.tip.dom.attr("data-tip-indicator-pos","bottom"),_p.tip.checkpos(o,r,e,t)},pos_left:function(e,t){var a=_p.tip.el,i=_p.tip.dom,n=a.offset(),o=n.left-e-_p.tip.get_indicator_size(),r=n.top+(a.outerHeight()-i.outerHeight())/2;return _p.tip.dom.attr("data-tip-indicator-pos","right"),_p.tip.checkpos(o,r,e,t)},pos_right:function(e,t){var a=_p.tip.el,i=_p.tip.dom,n=a.offset(),o=n.left+a.outerWidth()+_p.tip.get_indicator_size(),r=n.top+(a.outerHeight()-i.outerHeight())/2;return _p.tip.dom.attr("data-tip-indicator-pos","left"),_p.tip.checkpos(o,r,e,t)},checkpos:function(e,t,a,i){var n=_p.tip.el,o=_p.tip.dom,r=n.offset(),s=e,l=t,d={x:s,y:l},p=$document.width()||$window.width();return e+a>p?d=a>r.left?{x:p-a-2,y:t}:_p.tip.pos_left(a,i):0>e&&(d=_p.tip.pos_right(a,i)),t+i>$(window).scrollTop()+$(window).height()?d=_p.tip.pos_top(a,i):t<$(window).scrollTop()&&(d=_p.tip.pos_bottom(a,i)),o.attr({"data-tip-indicator-offset-x":e-s+"px","data-tip-indicator-offset-y":t-l+"px"}),d},trigger_by_el:function(e){var t=e.attr("data-tip");e.data("tip-filtered")||(_p.tip.filters.forEach(function(e){t=e(t)||t}),e.data("tip-filtered",!0)),_p.tip.show(t,e,e.attr("data-tip-position"))}},_p.el.tip={init:function(){return _p.el.tip.isInit?!1:($body.on("mouseenter._tip","[data-tip]",function(){$body_preventMouseover||_p.tip.trigger_by_el($(this))}).on("mouseleave._tip","[data-tip]",function(){_p.tip.hide()}).on("click._tip","[data-tip]",function(){_p.tip.hide(!0)}).on("tipshow._tip","[data-tip]",function(){_p.tip.trigger_by_el($(this))}).on("tiphide._tip","[data-tip]",function(){_p.tip.hide()}),void(_p.el.tip.isInit=!0))}},_p.el.links={is_init:!1,click:function(e,t){e.attr("href");return e.hasClass("disabled")?(t&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),!1):void 0},init:function(e){_p.el.links.is_init||($body.on("click.link_delegate","a",function(e){var t=$(this),a=t.attr("target");return this.hostname!=window.location.hostname&&(a="_external"),"_external"==a||"_blank"==a?(node.gui.Shell.openExternal($(this).attr("href")),e.preventDefault(),!0):void _p.el.links.click($(this),e)}),_p.el.links.is_init=!0)}},_p.el.form={init_el:function(e){return e.data("is_init_form_el")?!0:(e.find("textarea").on({"keyup.ctrl_enter_submit":function(t){var a=window.event?t.keyCode:t.which;switch(a=a.toString()){case"13":(t.metaKey||t.ctrlKey)&&e.submit()}}}),void e.data("is_init_form_el",!0))},init:function(e,t){e=e||$body,t=t||e.find("form"),t.each(function(){_p.el.form.init_el($(this))})}},_p.el.flexgrid={create:function(){var e=$('<div class="flexgrid"/>');return _p.el.flexgrid.init_el(e),e},init_el:function(e){if(e.data("is_init_flexgrid"))return!0;if(!e.data("append_before_this")){e.data("append_before_this",$('<div class="unit"/>').appendTo(e));for(var t=0;9>t;)$('<div class="unit"/>').appendTo(e),t++}e.data("is_init_flexgrid",!0)},init:function(e,t){e=e||$body,t=t||e.find(".flexgrid"),t.each(function(){_p.el.flexgrid.init_el($(this))})}},jQuery.fn.extend({appendDOM:function(e){return"function"==typeof e&&(e=e()),e&&e.insertBefore(this.data("append_before_this")),this}}),_p.el.table={dom:{},hover_column_getTable:function(e){function t(a){return"table"==e[a].tagName.toLowerCase()?$(e[a]):t(a+1)}return t(0)},hover_column_getTr:function(e){function t(a){return"tr"==e[a].tagName.toLowerCase()?$(e[a]):t(a+1)}return t(0)},hover_column_mouseenter:function(e,t){e.find("tbody tr td:nth-of-type("+(parseInt(t)+1)+")").addClass("state-hover-column")},hover_column_mouseleave:function(e,t){e.find("tbody tr td:nth-of-type("+(parseInt(t)+1)+")").removeClass("state-hover-column")},init_el:function(e){return e.data("is_init_table")?!0:void e.data("is_init_table",!0)},init:function(e,t){e=e||$body,t=t||e.find("table"),_p.el.table.is_init||($html.on("mouseenter.tablehover-column","body.hover table.hashover-column tbody td",function(e){var t=e.originalEvent.path,a=$(this).on("mouseleave.tablehover-column",function(){_p.el.table.hover_column_mouseleave(i,o),a.off("mouseleave.tablehover-column")}),i=_p.el.table.hover_column_getTable(t),n=_p.el.table.hover_column_getTr(t),o=$.inArray(a[0],n.find("td"));_p.el.table.hover_column_mouseenter(i,o)}),_p.el.table.is_init=!0),t.each(function(){_p.el.table.init_el($(this))})}},_p.el.tabview={dom:{},index:0,init_el:function(e){if(e.data("is_init_tabview"))return!0;var t="tabv"+_p.el.tabview.index,a=e.children("section"),i=$("<header/>").prependTo(e);_p.el.tabview.dom[t]=e,a.each(function(a){var n="_tabview-"+t+"-"+(a+1),o=$(this),r=o.data("tabname");$("<input />",{type:"radio",name:"_tabview-"+t,id:n,value:a+1,"class":"tabview-switch"}).data("tabview-content",o).prop("checked",0==a).on("change",function(){$(this).prop("checked")?($(this).data("tabview-content").trigger("tabview-show"),_g.uriHash("tv_"+t,a+1)):$(this).data("tabview-content").trigger("tabview-hide")}).prependTo(e),$("<label/>",{"for":n,html:r}).appendTo(i),a||o.trigger("tabview-show")}),_p.el.tabview.index++,$window.on("hashchange.tabview-"+t,function(){var e=_g.uriHash("tv_"+t);e&&_p.el.tabview.dom[t].children('input[type="radio"].tabview-switch[value="'+e+'"]').prop("checked")}),e.data("is_init_tabview",!0)},init:function(e,t){e=e||$body,t=t||e.find(".tabview"),t.each(function(){_p.el.tabview.init_el($(this))})}},$document.ready(function(){var e=_g.timeNow();$body=$("body");for(var t in _g.func_first)_g.func_first[t]();_g.init();for(var t in _g.func_last)_g.func_last[t]();var a=_g.timeNow(),i=a-e;(i>5e3||bMobile)&&$html.addClass("no-transition")}),_g.animate_duration_delay=320,_g.inputIndex=0,_g.lang="zh_cn",_g.joint="・",_g.isClient="undefined"==typeof node&&"undefined"==typeof nw?!1:!0,_g.defaultHqLv=90,_g.updateDefaultHqLv=function(e){e=parseInt(e)||_g.defaultHqLv,0>=e&&(e=_g.defaultHqLv),e!=Lockr.get("hqLvDefault",_g.defaultHqLv)&&(Lockr.set("hqLvDefault",e),clearTimeout(this.delay_updateDefaultHqLv),this.delay_updateDefaultHqLv=setTimeout(function(){$body.trigger("update_defaultHqLv",[e]),clearTimeout(this.delay_updateDefaultHqLv),this.delay_updateDefaultHqLv=null}.bind(this),200))};var _ga={counter:function(e,t,a){return debugmode?!0:this.init_count?void ga("send","pageview",{location:location.href,page:location.pathname}):void(this.init_count=!0)}},_config={getFullKeyname:function(e){return"config_"+e},get:function(e){if(!localStorage)return!1;var t=localStorage[_config.getFullKeyname(e)];return"true"===t?!0:"undefined"===t?(delete localStorage[_config.getFullKeyname(e)],null):t},set:function(e,t){return localStorage?void(null===t&&localStorage[_config.getFullKeyname(e)]?delete localStorage[_config.getFullKeyname(e)]:localStorage[_config.getFullKeyname(e)]=t):!1}};if(_frame.app_config={init:function(){return _frame.app_config.is_init?!0:void(_frame.app_config.is_init=!0)}},"undefined"==typeof _g)var _g={};_g.lang=_g.lang||"zh_cn";var Formula={equipmentType:{SmallCaliber:1,SmallCaliberHigh:2,SmallCaliberAA:3,MediumCaliber:4,LargeCaliber:5,SuperCaliber:6,SecondaryGun:7,SecondaryGunHigh:8,SecondaryGunAA:9,APShell:11,Torpedo:12,SubmarineTorpedo:13,MidgetSubmarine:14,ReconSeaplane:15,ReconSeaplaneNight:16,SeaplaneBomber:17,CarrierFighter:18,TorpedoBomber:19,DiveBomber:20,CarrierRecon:21,SmallRadar:24,LargeRadar:25,DepthCharge:26,Sonar:27,LargeSonar:28,AAGun:29,AAGunConcentrated:30,Searchlight:39,LargeFlyingBoat:45,SearchlightLarge:46,SuparRadar:47,CarrierRecon2:50},shipType:{Carriers:[9,10,11],LightCruisers:[2,3,21,28],Submarines:[13,14]},calculate:function(e,t,a,i,n,o){if(!e||!t)return 0;_instanceof(t,Ship)||(t=_g.data.ships[t]);var r=0,s={main:0,secondary:0,torpedo:0,seaplane:0,apshell:0,radar:0},l=function(){var e=0,n=!1;if($.inArray(t.type,Formula.shipType.Carriers)>-1?n=!0:a.forEach(function(e){e&&!n&&$.inArray(e.type,Formula.equipmentType.AircraftBased)>-1&&(n=!0)}),n){var o=0,r=0;return t.slot.map(function(t,n){a[n]&&(e+=1.5*a[n].stat.fire||0,a[n].type==Formula.equipmentType.TorpedoBomber&&(o+=a[n].stat.torpedo||0),a[n].type==Formula.equipmentType.DiveBomber&&(r+=a[n].stat.bomb||0),$.inArray(a[n].type,Formula.equipmentType.SecondaryGuns)>-1&&(e+=Math.sqrt(1.5*(i[n]||0))))}),o||r?e+=1.5*(1.3*r+o+t.stat.fire_max)+50:-1}e=t.stat.fire_max||0;var s=0,l=0;return t.slot.map(function(n,o){if(a[o]&&(e+=a[o].stat.fire||0,$.inArray(t.type,Formula.shipType.LightCruisers)>-1&&((4==a[o].id||65==a[o].id)&&(s+=1),(119==a[o].id||139==a[o].id)&&(l+=1)),i[o]&&$.inArray(a[o].type,Formula.equipmentType.Torpedos.concat(Formula.equipmentType.Radars))<0)){var r=1;$.inArray(a[o].type,Formula.equipmentType.AntiSubmarines)>-1&&(r=.75),$.inArray(a[o].type,Formula.equipmentType.LargeCalibers)>-1&&(r=1.5),e+=Math.sqrt(i[o])*r}}),e+2*Math.sqrt(l)+Math.sqrt(s)},d=function(){var e=0;return $.inArray(t.type,Formula.shipType.Carriers)>-1?-1:(e=t.stat.torpedo_max||0,t.slot.map(function(t,n){if(a[n]&&(e+=a[n].type==Formula.equipmentType.TorpedoBomber?0:a[n].stat.torpedo||0,i[n])){var o=0;$.inArray(a[n].type,Formula.equipmentType.Torpedos)>-1&&(o=1.2),$.inArray(a[n].type,Formula.equipmentType.AAGuns)>-1&&(o=1),e+=Math.sqrt(i[n])*o}}),e)},p=0;switch(a=a.map(function(e){return e?_instanceof(e,Equipment)?e:_g.data.items[e]:null})||[],i=i||[],n=n||[],o=o||{},a.forEach(function(e){e&&($.inArray(e.type,Formula.equipmentType.MainGuns)>-1?s.main+=1:$.inArray(e.type,Formula.equipmentType.SecondaryGuns)>-1?s.secondary+=1:$.inArray(e.type,Formula.equipmentType.Torpedos)>-1?s.torpedo+=1:$.inArray(e.type,Formula.equipmentType.Seaplanes)>-1?s.seaplane+=1:e.type==Formula.equipmentType.APShell?s.apshell+=1:$.inArray(e.type,Formula.equipmentType.Radars)>-1&&(s.radar+=1))}),e){case"fighterPower":return p=0,t.slot.map(function(e,t){if(a[t]&&$.inArray(a[t].type,Formula.equipmentType.Fighters)>-1&&e){if(p=Math.sqrt(e)*(a[t].stat.aa||0),a[t].type==Formula.equipmentType.CarrierFighter)switch(n[t]){case 1:case"1":p+=1;break;case 2:case"2":p+=4;break;case 3:case"3":p+=6;break;case 4:case"4":p+=11;break;case 5:case"5":p+=16;break;case 6:case"6":p+=17;break;case 7:case"7":p+=25}else if(-1==$.inArray(a[t].type,Formula.equipmentType.Recons)){var i=a[t].type==Formula.equipmentType.SeaplaneBomber?9:3;p+=1==n[t]?1:i/6*(n[t]-1)}r+=Math.floor(p)}}),r;case"fighterPower_v2":return Formula.calcByShip.fighterPower_v2(t,a,i,n);case"shelling":case"shellingDamage":return $.inArray(t.type,Formula.shipType.Submarines)>-1?"-":(r=l(),r&&r>-1?Math.floor(r)+5:"-");case"torpedo":case"torpedoDamage":return r=d(),r&&r>-1?Math.floor(r)+5:"-";case"nightBattle":return $.inArray(t.type,Formula.shipType.Carriers)>-1?"-":(r=l()+d(),s.torpedo>=2?"雷击CI "+Math.floor(1.5*r)+" x 2":s.main>=3?"炮击CI "+Math.floor(2*r):2==s.main&&s.secondary>=1?"炮击CI "+Math.floor(1.75*r):s.main>=1&&1==s.torpedo?"炮雷CI "+Math.floor(1.3*r)+" x 2":2==s.main&&s.secondary<=0&&s.torpedo<=0||1==s.main&&s.secondary>=1&&s.torpedo<=0||0==s.main&&s.secondary>=2&&s.torpedo>=0?"连击 "+Math.floor(1.2*r)+" x 2":"通常 "+Math.floor(r));case"addHit":return t.slot.map(function(e,t){a[t]&&(r+=a[t].stat.hit||0)}),r>=0?"+"+r:r;case"addArmor":return t.slot.map(function(e,t){a[t]&&(r+=a[t].stat.armor||0)}),r;case"addEvasion":return t.slot.map(function(e,t){a[t]&&(r+=a[t].stat.evasion||0)}),r;case"losPower":return Formula.calcByShip.losPower(t,a,i,n,o)}return"-"},calcByShip:{}};Formula.equipmentType.MainGuns=[Formula.equipmentType.SmallCaliber,Formula.equipmentType.SmallCaliberHigh,Formula.equipmentType.SmallCaliberAA,Formula.equipmentType.MediumCaliber,Formula.equipmentType.LargeCaliber,Formula.equipmentType.SuperCaliber],Formula.equipmentType.LargeCalibers=[Formula.equipmentType.LargeCaliber,Formula.equipmentType.SuperCaliber],Formula.equipmentType.SecondaryGuns=[Formula.equipmentType.SecondaryGun,Formula.equipmentType.SecondaryGunHigh,Formula.equipmentType.SecondaryGunAA],Formula.equipmentType.Torpedos=[Formula.equipmentType.Torpedo,Formula.equipmentType.SubmarineTorpedo],Formula.equipmentType.Seaplanes=[Formula.equipmentType.ReconSeaplane,Formula.equipmentType.ReconSeaplaneNight,Formula.equipmentType.SeaplaneBomber],Formula.equipmentType.Fighters=[Formula.equipmentType.SeaplaneBomber,Formula.equipmentType.CarrierFighter,Formula.equipmentType.TorpedoBomber,Formula.equipmentType.DiveBomber],Formula.equipmentType.Recons=[Formula.equipmentType.ReconSeaplane,Formula.equipmentType.ReconSeaplaneNight,Formula.equipmentType.CarrierRecon,Formula.equipmentType.CarrierRecon2,Formula.equipmentType.LargeFlyingBoat],Formula.equipmentType.SeaplaneRecons=[Formula.equipmentType.ReconSeaplane,Formula.equipmentType.ReconSeaplaneNight,Formula.equipmentType.LargeFlyingBoat],Formula.equipmentType.CarrierRecons=[Formula.equipmentType.CarrierRecon,Formula.equipmentType.CarrierRecon2],Formula.equipmentType.AircraftBased=[Formula.equipmentType.CarrierFighter,Formula.equipmentType.TorpedoBomber,Formula.equipmentType.DiveBomber,Formula.equipmentType.CarrierRecon,Formula.equipmentType.CarrierRecon2],Formula.equipmentType.TorpedoBombers=[Formula.equipmentType.TorpedoBomber],Formula.equipmentType.DiveBombers=[Formula.equipmentType.DiveBomber],Formula.equipmentType.Radars=[Formula.equipmentType.SmallRadar,Formula.equipmentType.LargeRadar,Formula.equipmentType.SuparRadar],Formula.equipmentType.SmallRadars=[Formula.equipmentType.SmallRadar],Formula.equipmentType.LargeRadars=[Formula.equipmentType.LargeRadar,Formula.equipmentType.SuparRadar],Formula.equipmentType.AntiSubmarines=[Formula.equipmentType.DepthCharge,Formula.equipmentType.Sonar,Formula.equipmentType.LargeSonar],Formula.equipmentType.AAGuns=[Formula.equipmentType.AAGun,Formula.equipmentType.AAGunConcentrated],Formula.equipmentType.Searchlights=[Formula.equipmentType.Searchlight,Formula.equipmentType.SearchlightLarge],Formula.shellingDamage=function(e,t,a,i){return this.calculate("shellingDamage",e,t,a,i)},Formula.torpedoDamage=function(e,t,a,i){return this.calculate("torpedoDamage",e,t,a,i)},Formula.fighterPower=function(e,t,a,i){return this.calculate("fighterPower",e,t,a,i)},Formula.fighterPower_v2=function(e,t,a,i){return this.calculate("fighterPower_v2",e,t,a,i)},Formula.nightBattle=function(e,t,a,i){return this.calculate("nightBattle",e,t,a,i)},Formula.addHit=function(e,t,a,i){return this.calculate("addHit",e,t,a,i)},Formula.addArmor=function(e,t,a,i){return this.calculate("addArmor",e,t,a,i)},Formula.addEvasion=function(e,t,a,i){return this.calculate("addEvasion",e,t,a,i)},Formula.losPower=function(e,t,a,i,n){return this.calculate("losPower",e,t,a,i,n)},Formula.calcByShip.fighterPower_v2=function(e,t,a,i){var n=[],o={},r=[0,0];return n[0]=[0,9],n[1]=[10,24],n[2]=[25,39],n[3]=[40,54],n[4]=[55,69],n[5]=[70,84],n[6]=[85,99],n[7]=[100,120],o.CarrierFighter=[0,0,2,5,9,14,14,22],o.SeaplaneBomber=[0,0,1,1,1,3,3,6],e.slot.map(function(e,a){if(t[a]&&$.inArray(t[a].type,Formula.equipmentType.Fighters)>-1&&e){var s=Math.sqrt(e)*(t[a].stat.aa||0),l=i[a]||0,d=n[l],p=0;t[a].type==Formula.equipmentType.CarrierFighter&&(p=o.CarrierFighter[l]),t[a].type==Formula.equipmentType.SeaplaneBomber&&(p=o.SeaplaneBomber[l]),r[0]+=Math.floor(s+Math.sqrt(d[0]/10)+p),r[1]+=Math.floor(s+Math.sqrt(d[1]/10)+p)}}),r},Formula.calcByShip.losPower=function(e,t,a,i,n){n=n||{},n.shipLv=n.shipLv||1,n.hqLv=n.hqLv||1,n.shipLv<0&&(n.shipLv=1),n.hqLv<0&&(n.hqLv=1);var o=function(e){e=$.extend({"(Intercept)":1},e),e.hqLv=5*Math.ceil(e.hqLv/5);var t={},a=0;$.each(r,function(){var i=e[this]*s[this];t[this]=i,a+=i});var i={};$.each(r,function(){i[this]=e[this]*l[this]});var n=0;return $.each(r,function(){var e=this;$.each(r,function(){var t=this;n+=i[e]*i[t]*d[e][t]})}),{x_estimate:t,y_estimate:a,x_std_error:i,y_std_error:n}},r=["(Intercept)","DiveBombers","TorpedoBombers","CarrierRecons","SeaplaneRecons","SeaplaneBomber","SmallRadars","LargeRadars","Searchlights","statLos","hqLv"],s={"(Intercept)":0,DiveBombers:1.03745043134563,TorpedoBombers:1.3679056374142,CarrierRecons:1.65940512636315,SeaplaneRecons:2,SeaplaneBomber:1.77886368594467,SmallRadars:1.0045778494921,LargeRadars:.990738063979571,Searchlights:.906965144360512,statLos:1.6841895400986,hqLv:-.614246711531445},l={"(Intercept)":4.66445565766347,DiveBombers:.0965028505325845,TorpedoBombers:.108636184978525,CarrierRecons:.0976055279516298,SeaplaneRecons:.0866229392463539,SeaplaneBomber:.0917722496848294,SmallRadars:.0492773648320346,LargeRadars:.0491221486053861,Searchlights:.0658283797225724,statLos:.0781594211213618,hqLv:.0369222352426548},d={"(Intercept)":{"(Intercept)":1,DiveBombers:-.147020064768061,TorpedoBombers:-.379236131621529,CarrierRecons:-.572858669501918,SeaplaneRecons:-.733913857017495,SeaplaneBomber:-.642621825152428,SmallRadars:-.674829588068364,LargeRadars:-.707418111752863,Searchlights:-.502304601556193,statLos:-.737374218573832,hqLv:-.05071933950163},DiveBombers:{"(Intercept)":-.147020064768061,DiveBombers:1,TorpedoBombers:.288506347076736,CarrierRecons:.365820372770994,SeaplaneRecons:.425744409856409,SeaplaneBomber:.417783698791503,SmallRadars:.409046013184429,LargeRadars:.413855653833994,Searchlights:.308730607324667,statLos:.317984916914851,hqLv:-.386740224500626},TorpedoBombers:{"(Intercept)":-.379236131621529,DiveBombers:.288506347076736,TorpedoBombers:1,CarrierRecons:.482215071254241,SeaplaneRecons:.584455876852325,SeaplaneBomber:.558515133495825,SmallRadars:.547260012897553,LargeRadars:.560437619378443,Searchlights:.437934879351188,statLos:.533934507932748,hqLv:-.405349979885748},CarrierRecons:{"(Intercept)":-.572858669501918,DiveBombers:.365820372770994,TorpedoBombers:.482215071254241,CarrierRecons:1,SeaplaneRecons:.804494553748065,SeaplaneBomber:.75671307047535,SmallRadars:.748420581669228,LargeRadars:.767980338133817,Searchlights:.589651513349878,statLos:.743851348255527,hqLv:-.503544281376776},SeaplaneRecons:{"(Intercept)":-.733913857017495,DiveBombers:.425744409856409,TorpedoBombers:.584455876852325,CarrierRecons:.804494553748065,SeaplaneRecons:1,SeaplaneBomber:.932444440578382,SmallRadars:.923988080549326,LargeRadars:.94904944359066,Searchlights:.727912987329348,statLos:.944434077970518,hqLv:-.614921413821462},SeaplaneBomber:{"(Intercept)":-.642621825152428,DiveBombers:.417783698791503,TorpedoBombers:.558515133495825,CarrierRecons:.75671307047535,SeaplaneRecons:.932444440578382,SeaplaneBomber:1,SmallRadars:.864289865445084,LargeRadars:.886872388674911,Searchlights:.68310647756898,statLos:.88122333327317,hqLv:-.624797255805045},SmallRadars:{"(Intercept)":-.674829588068364,DiveBombers:.409046013184429,TorpedoBombers:.547260012897553,CarrierRecons:.748420581669228,SeaplaneRecons:.923988080549326,SeaplaneBomber:.864289865445084,SmallRadars:1,LargeRadars:.872011318623459,Searchlights:.671926570242336,statLos:.857213501657084,hqLv:-.560018086758868},LargeRadars:{"(Intercept)":-.707418111752863,DiveBombers:.413855653833994,TorpedoBombers:.560437619378443,CarrierRecons:.767980338133817,SeaplaneRecons:.94904944359066,SeaplaneBomber:.886872388674911,SmallRadars:.872011318623459,LargeRadars:1,Searchlights:.690102027588321,statLos:.883771367337743,hqLv:-.561336967269448},Searchlights:{"(Intercept)":-.502304601556193,DiveBombers:.308730607324667,TorpedoBombers:.437934879351188,CarrierRecons:.589651513349878,SeaplaneRecons:.727912987329348,SeaplaneBomber:.68310647756898,SmallRadars:.671926570242336,LargeRadars:.690102027588321,Searchlights:1,statLos:.723228553177704,hqLv:-.518427865593732},statLos:{"(Intercept)":-.737374218573832,DiveBombers:.317984916914851,TorpedoBombers:.533934507932748,CarrierRecons:.743851348255527,SeaplaneRecons:.944434077970518,SeaplaneBomber:.88122333327317,SmallRadars:.857213501657084,LargeRadars:.883771367337743,Searchlights:.723228553177704,statLos:1,hqLv:-.620804120587684},hqLv:{"(Intercept)":-.05071933950163,DiveBombers:-.386740224500626,TorpedoBombers:-.405349979885748,CarrierRecons:-.503544281376776,SeaplaneRecons:-.614921413821462,SeaplaneBomber:-.624797255805045,SmallRadars:-.560018086758868,LargeRadars:-.561336967269448,Searchlights:-.518427865593732,statLos:-.620804120587684,hqLv:1}},p={DiveBombers:0,TorpedoBombers:0,CarrierRecons:0,SeaplaneRecons:0,SeaplaneBomber:0,SmallRadars:0,LargeRadars:0,Searchlights:0,statLos:Math.sqrt(e.getAttribute("los",n.shipLv)),hqLv:n.hqLv};return t.forEach(function(e){if(e)for(var t in p)Formula.equipmentType[t]&&Formula.equipmentType[t].push&&Formula.equipmentType[t].indexOf(e.type)>-1&&(p[t]+=e.stat.los)}),o(p)};var ItemBase=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getName",value:function(e){return e=e||_g.lang,this.name?this.name[e]||this.name:null}},{key:"_name",get:function(){return this.getName()}}]),e}(),Entity=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return $.extend(!0,a,e),a}return _inherits(t,e),t}(ItemBase),Equipment=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return $.extend(!0,a,e),a}return _inherits(t,e),_createClass(t,[{key:"getName",value:function(e,t){t=t||_g.lang;var a=ItemBase.prototype.getName.call(this,t),i=e&&!e==!0?e:"small";return e?a.replace(/（([^（^）]+)）/g,"<"+i+">($1)</"+i+">"):a}},{key:"getType",value:function(e){return e=e||_g.lang,this.type?_g.data.item_types[this.type].name[e]:null}},{key:"getIconId",value:function(){return _g.data.item_types[this.type].icon}},{key:"getCaliber",value:function(){var e=this.getName(!1,"ja_jp"),t=parseFloat(e);return t}},{key:"getPower",value:function(){return this.stat[_g.data.item_types[this.type].main_attribute||"fire"]}},{key:"_icon",get:function(){return"assets/images/itemicon/"+this.getIconId()+".png"}}]),t}(ItemBase),Ship=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return $.extend(!0,a,e),a}return _inherits(t,e),_createClass(t,[{key:"getName",value:function(e,t){e=e||"",t=t||_g.lang;var a=this.getSuffix(t);return(this.name[t]||this.name.ja_jp)+(a?(e===!0?_g.joint:e)+a:"")}},{key:"getNameNoSuffix",value:function(e){return e=e||_g.lang,this.name[e]||this.name.ja_jp}},{key:"getSuffix",value:function(e){return e=e||_g.lang,this.name.suffix?_g.data.ship_namesuffix[this.name.suffix][e]||_g.data.ship_namesuffix[this.name.suffix].ja_jp||"":""}},{key:"getType",value:function(e){return e=e||_g.lang,this.type?_g.data.ship_types[this.type].full_zh:null}},{key:"getSeriesData",value:function(){return this.series?_g.data.ship_series[this.series].ships:[{id:this.id}]}},{key:"getPic",value:function(e){var t=this.getSeriesData();e=parseInt(e||0);for(var a=0;a<t.length;a++)if(t[a].id==this.id){switch(e){case 0:case 1:case 2:case 3:case 12:case 13:case 14:return node.path.join(_g.path.pics.ships,this.id+"/"+e+".webp");default:return t[a].illust_delete?node.path.join(_g.path.pics.ships,t[a-1].id+"/"+e+".webp"):node.path.join(_g.path.pics.ships,this.id+"/"+e+".webp")}break}}},{key:"getSpeed",value:function(e){return e=e||_g.lang,
_g.statSpeed[parseInt(this.stat.speed)]}},{key:"getRange",value:function(e){return e=e||_g.lang,_g.statRange[parseInt(this.stat.range)]}},{key:"getEquipmentTypes",value:function(){return _g.data.ship_types[this.type].equipable.concat(this.additional_item_types||[]).sort(function(e,t){return e-t})}},{key:"getAttribute",value:function(e,t){t=t||1,t>150&&(t=150);var a=function(e,t,a){return e=e||1,t=parseFloat(t),a=parseFloat(a)||t,0>t||0>a?-1:Math.floor(t+(a-t)*e/99)},i=void 0;switch(e){case"hp":return i=this.stat.hp,t>99&&(i=this.stat.hp>=90?this.stat.hp+9:this.stat.hp>=70?this.stat.hp+8:this.stat.hp>=50?this.stat.hp+7:this.stat.hp>=40?this.stat.hp+6:this.stat.hp>=30?this.stat.hp+5:this.stat.hp+4,i>this.stat.hp_max&&(i=this.stat.hp_max)),i;case"speed":return _g.getStatSpeed(this.stat.speed);case"range":return _g.getStatRange(this.stat.range);case"luck":return t>99?this.stat.luck+3:this.stat.luck;case"fuel":case"ammo":return t>99?Math.floor(.85*this.consum[e]):this.consum[e];case"aa":case"armor":case"fire":case"torpedo":return this.stat[e+"_max"]||this.stat[e];default:return a(t,this.stat[e],this.stat[e+"_max"])}}},{key:"getRel",value:function(e){if(e){if(!this.rels[e]&&this.remodel&&this.remodel.prev)for(var t=_g.data.ships[this.remodel.prev];t;){if(t.rels&&t.rels[e])return t.rels[e];t=t.remodel&&t.remodel.prev?_g.data.ships[t.remodel.prev]:null}return this.rels[e]}return this.rels}},{key:"getCV",value:function(e){var t=this.getRel("cv");return t?_g.data.entities[t].getName(e||_g.lang):void 0}},{key:"getIllustrator",value:function(e){var t=this.getRel("illustrator");return t?_g.data.entities[t].getName(e||_g.lang):void 0}},{key:"_type",get:function(){return this.getType()}},{key:"_pics",get:function(){for(var e=[],t=0;15>t;t++)e.push(this.getPic(t));return e}},{key:"_speed",get:function(){return this.getSpeed()}},{key:"_range",get:function(){return this.getRange()}},{key:"_cv",get:function(){return this.getCV()}},{key:"_illustrator",get:function(){return this.getIllustrator()}}]),t}(ItemBase);_g.kancolle_calc={version:3,decode:function(e,t){if(e&&("string"==typeof e&&(e=JSON.parse(e)),"object"==("undefined"==typeof e?"undefined":_typeof(e)))){t=parseInt(e.version)||this.version;var a=void 0,i=0,n=0,o=0,r=void 0,s=void 0,l=void 0;switch(t){case 3:for(a=[],i=0;r=e["f"+(i+1)];){for(a[i]=[],n=0;s=r["s"+(n+1)];){if(s.id&&(a[i][n]=[s.id,[s.lv||null,s.luck||-1],[],[],[]]),s.items)for(o=0;l=s.items["i"+(o+1)];)l.id&&(a[i][n][2][o]=l.id,a[i][n][3][o]=l.rf||null,a[i][n][4][o]=l.rp||null),o++;n++}i++}}return a}},encode:function(e,t){if(e&&(e.length&&e.push||(e=JSON.parse(e)),e.length&&e.push)){t=parseInt(t)||this.version;var a=void 0;switch(t){case 3:a={version:3},e.forEach(function(e,t){a["f"+(t+1)]={},e.forEach(function(e,i){e[0]&&(a["f"+(t+1)]["s"+(i+1)]={id:parseInt(e[0]),lv:parseInt(e[1][0])||null,luck:parseInt(e[1][1])||-1,items:{ix:{}}},e[2].forEach(function(n,o){n&&(a["f"+(t+1)]["s"+(i+1)].items["i"+(o+1)]={id:parseInt(n)},e[3]&&(a["f"+(t+1)]["s"+(i+1)].items["i"+(o+1)].rf=parseInt(e[3][o])||0),e[4]&&(a["f"+(t+1)]["s"+(i+1)].items["i"+(o+1)].rp=parseInt(e[4][o])||0))}))})})}return a}}},_g.bgimg_count=0,_g.event={animationend:"animationend webkitAnimationEnd",animationiteration:"animationiteration webkitAnimationIteration",transitionend:"transitionend webkitTransitionEnd mozTransitionEnd"},_g.path={db:"/!/db/",bgimg_dir:"/!/assets/images/homebg/",pics:{ships:"/!/pics/ships/",items:"/!/pics/items/"}},_g.dbs=["ships","ship_types","ship_series","ship_namesuffix","items","item_types"],_g.data={};var _db={fleets:new Nedb({filename:"fleets"})};Nedb.prototype.updateById=function(e,t,a){this._updateByIdQueue||(this._updateByIdQueue={},Object.defineProperty(this._updateByIdQueue,"running",{enumerable:!1,value:!1,writable:!0})),t=t||{},t._id=e,this._updateByIdQueue[e]={docReplace:t,callback:a||function(){}},this._updateById()},Nedb.prototype._updateById=function(){if(!this._updateByIdQueue||this._updateByIdQueue.running)return!1;var e=void 0;for(var t in this._updateByIdQueue)if(this._updateByIdQueue[t]){e=t;break}if(!e)return!1;var a=this._updateByIdQueue[e];this._updateByIdQueue[e]=null,delete this._updateByIdQueue[e],this._updateByIdQueue.running=!0,this.update({_id:e},a.docReplace,{},function(e,t){a.callback.call(this,e,t),this._updateByIdQueue.running=!1,this._updateById()}.bind(this))},_g.statSpeed={5:"低速",10:"高速"},_g.statRange={1:"短",2:"中",3:"长",4:"超长"},_g.textRank={1:"|",2:"||",3:"|||",4:"\\",5:"\\\\",6:"\\\\\\",7:"》"},_g.getStatSpeed=function(e){return e=parseInt(e),_g.statSpeed[e]},_g.getStatRange=function(e){return e=parseInt(e),_g.statRange[e]},_g.log=function(){console.log.apply(console,arguments)},_g.parseURI=function(e){e=e||location.pathname;var t=e.split("/").filter(function(e){return e});if(1==t.length)return{page:t[0]};if(2==t.length){var a=t[0];switch(a){case"ships":a="ship";break;case"equipments":a="equipment";break;case"entities":a="entity";break;case"fleets":a="fleet"}return{infos:a,id:t[1]}}},_g.state2URI=function(e){if(!e)return"/";if(e.page)return"/"+e.page+"/";if(e.infos){var t=e.infos;switch(t){case"ship":t="ships";break;case"equipment":t="equipments";break;case"entity":t="entities";break;case"fleet":t="fleets"}return"/"+t+"/"+e.id+"/"}},_frame.app_main={page:{},page_dom:{},page_html:{},page_title:{},bgimgs:[],loading:["dbs","bgimgs"],functions_on_ready:[],loaded:function(e,t){if(_g.log(e+" loaded."),e){var a=_frame.app_main.loading.indexOf(e);a>-1&&(_frame.app_main.loading.splice(_frame.app_main.loading.indexOf(e),1),_frame.app_main.is_loaded=!1)}_frame.app_main.loading.length||_frame.app_main.is_loaded||(setTimeout(function(){!_frame.app_main.is_loaded||_frame.app_main.loading.length||$html.hasClass("app-ready")||(_frame.dom.layout.addClass("ready"),$html.addClass("app-ready"),setTimeout(function(){for(var e=0;e<_frame.app_main.functions_on_ready.length;e++)_frame.app_main.functions_on_ready[e]()},1500))},t?300:1e3),this.window_event_bound||($window.on("popstate._global",function(e){e.originalEvent&&e.originalEvent.state?_frame.app_main.state(e.originalEvent.state):_frame.app_main.state(_g.parseURI())}).trigger("popstate._global"),this.window_event_bound=!0),_frame.app_main.is_loaded=!0)},pushState:function(e,t,a){history.pushState(e,t,a),console.log(e)},state:function(e){e.infos?_frame.infos.show_func(e.infos,e.id,null,e.infosHistoryIndex):_frame.infos.hide(),e.page&&this.load_page_func(e.page)},change_bgimg:function(e){if(!_frame.app_main.bgimgs.length)return!1;var t=e&&e.length?e:_frame.app_main.bgimgs,a=t[_g.randInt(t.length)],i=_frame.app_main.cur_bgimg_el?_frame.app_main.cur_bgimg_el.css("background-image"):null;for(i=i?i.split("/"):null,i=i?i[i.length-1].split(")"):null,i=i?i[0]:null;a==i;)a=t[_g.randInt(t.length-1)];var n=_g.path.bgimg_dir+"blured/"+a;this.bgimg_path=_g.path.bgimg_dir+a,a=this.bgimg_path,i&&(this.change_bgimg_oldEl=_frame.app_main.cur_bgimg_el),_frame.app_main.cur_bgimg_el=$("<div/>").css("background-image","url("+a+")").appendTo(_frame.dom.bgimg).add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.nav)).add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.main)),_frame.dom.bg_controls&&(_frame.app_main.cur_bgimg_el=_frame.app_main.cur_bgimg_el.add($("<s"+(_frame.app_main.change_bgimg_fadein?' class="fadein"':"")+"/>").css("background-image","url("+n+")").appendTo(_frame.dom.bg_controls))),_frame.app_main.change_bgimg_fadein=!0},change_bgimg_after:function(e){e=e||this.change_bgimg_oldEl,e&&(this.change_bgimg_oldEl.remove(),this.change_bgimg_oldEl=null)},toggle_hidecontent:function(){_frame.dom.layout.toggleClass("hidecontent")},loading_queue:[],loading_state:{},loading_start:function(e,t,a){e=e||location.pathname,t=t||function(){},a=a||function(){},this.loading_cur=e,"undefined"==typeof this.loading_state[e]||"fail"==this.loading_state[e]?("fail"!=this.loading_state[e]&&(this.loading_state[e]="loading"),this.loading_queue.push(e),_frame.dom.layout.addClass("is-loading"),$.ajax({url:e,type:"get",dataType:"html",success:function(a){var i=/\<main\>(.+)\<\/main\>/.exec(a),n=/\<title\>([^\<]+)\<\/title\>/.exec(a);n&&n.length>1&&(_frame.app_main.page_title[e]=n[1]),e==_frame.app_main.loading_cur&&t(i&&i.length>1?i[1]:""),_frame.app_main.loading_state[e]="complete"},error:function(t,i,n){return n=n||"",_g.log("Loading Fail: "+e+" ["+i+"] ("+n+")"),"fail"==_frame.app_main.loading_state[e]||["Bad Request","Not Found","Forbidden"].indexOf(n)>-1?_frame.app_main.loading_fail(e,i,n,a):void(_frame.app_main.loading_state[e]="fail")},complete:function(){_frame.app_main.loading_complete(e),"fail"==_frame.app_main.loading_state[e]&&(console.log("retry"),_frame.app_main.loading_start(e,t,a))}})):"complete"==this.loading_state[e]&&t()},loading_complete:function(e){if(e){e==this.loading_cur&&(this.loading_cur=null);var t=this.loading_queue.indexOf(e);t>=0&&this.loading_queue.splice(t,1),this.loading_queue.length||_frame.dom.layout.removeClass("is-loading")}},loading_fail:function(e,t,a,i){return e?(this.loading_state&&delete this.loading_state[e],_frame.dom.layout.attr("data-errorbadge",e+" 载入失败 ("+a+")"),clearTimeout(this.loading_fail_timeout_errorbadge),this.loading_fail_timeout_errorbadge=setTimeout(function(){_frame.dom.layout.removeAttr("data-errorbadge"),delete _frame.app_main.loading_fail_timeout_errorbadge},3e3),console.log(i),i(e,t,a)):void 0},load_page:function(e,t){return _frame.app_main.cur_page!=e&&e?(t=t||{},this.pushState({page:e},null,_g.state2URI({page:e})),this.load_page_func(e,t),void(t.callback_modeSelection_select?_frame.app_main.page_dom[e].trigger("modeSelectionEnter",[t.callback_modeSelection_select||function(){},t.callback_modeSelection_enter||function(){}]):_frame.app_main.mode_selection_off())):e},load_page_func:function(e,t){function a(){return _frame.app_main.page_dom[e].trigger("show"),_frame.infos.hide(),t.callback_modeSelection_select||(_frame.app_main.title=_frame.app_main.navtitle[e],_frame.infos.last=null,console.log("/"+e+"/",_frame.app_main.page_title["/"+e+"/"]),document.title=_frame.app_main.page_title["/"+e+"/"],_ga.counter(location.search)),_frame.app_main.cur_page==e?e:(_frame.app_main.page_dom[e].removeClass("off").trigger("on"),_frame.app_main.cur_page&&(_frame.dom.navs[_frame.app_main.cur_page]&&_frame.dom.navs[_frame.app_main.cur_page].removeClass("on"),_frame.app_main.page_dom[_frame.app_main.cur_page]&&setTimeout(function(e){_frame.app_main.page_dom[e].addClass("off").trigger("pageoff")}(_frame.app_main.cur_page),100)),_frame.dom.navs[e]&&_frame.dom.navs[e].addClass("on"),t.callback_modeSelection_select||"about"!=e&&Lockr.set("last_page",e),_frame.dom.main.attr("data-theme",e),_frame.app_main.cur_page=e,void _g.log("LOADED: "+e))}if(_g.log("PREPARE LOADING: "+e),t=t||{},!e)return e;var i=!1;return"donate"==e&&(i=!0),_frame.app_main.cur_page?i=!0:_frame.app_main.nav.forEach(function(t){e==t.page&&(i=!0)}),i?void(_frame.app_main.page_dom[e]?a():(_frame.app_main.page_dom[e]=_frame.dom.main.find('.page-container[page="'+e+'"]'),_frame.app_main.page_dom[e].length?(_frame.app_main.page_init(e),_frame.app_main.page_title["/"+e+"/"]=document.title,a()):this.loading_start("/"+e+"/",function(t){_frame.app_main.page_dom[e]=$(t).appendTo(_frame.dom.main),_frame.app_main.page_init(e),a()},function(t,a,i){delete _frame.app_main.page_dom[e],history.back()}))):(e=_frame.app_main.nav[0].page,_frame.app_main.load_page(e,t),e)},only_bg_on:function(){return this.only_bg?!0:(_frame.dom.bg_controls||(_frame.dom.bg_controls=$('<div class="bg_controls"/>').on(eventName("transitionend","only_bg_off"),function(e){console.log(e),e.currentTarget==e.target&&"bottom"==e.originalEvent.propertyName&&_frame.dom.layout.hasClass("only_bg")&&_frame.dom.bg_controls.offset().top>=$body.height()&&(_frame.dom.layout.removeClass("only_bg"),_frame.app_main.only_bg=!1)}).appendTo(_frame.dom.layout),_frame.app_main.cur_bgimg_el=_frame.app_main.cur_bgimg_el.add(_frame.app_main.cur_bgimg_el.eq(0).clone().appendTo(_frame.dom.bg_controls)),$('<button class="prev" icon="arrow-left"/>').on("click",function(){var e=_frame.app_main.bgimg_path.split("/"),t=$.inArray(e[e.length-1],_frame.app_main.bgimgs)-1;0>t&&(t=_frame.app_main.bgimgs.length-1),_frame.app_main.change_bgimg([_frame.app_main.bgimgs[t]])}).appendTo(_frame.dom.bg_controls),$('<button class="back"/>').html("返回").on("click",function(){_frame.app_main.only_bg_off()}).appendTo(_frame.dom.bg_controls),$('<button class="back"/>').html("保存图片").on("click",function(){window.open(_frame.app_main.bgimg_path)}).appendTo(_frame.dom.bg_controls),$('<button class="next" icon="arrow-right"/>').on("click",function(){var e=_frame.app_main.bgimg_path.split("/"),t=$.inArray(e[e.length-1],_frame.app_main.bgimgs)+1;t>=_frame.app_main.bgimgs.length&&(t=0),_frame.app_main.change_bgimg([_frame.app_main.bgimgs[t]])}).appendTo(_frame.dom.bg_controls)),_frame.dom.layout.addClass("only_bg"),setTimeout(function(){_frame.dom.bg_controls.addClass("on")},10),void(this.only_bg=!0))},only_bg_off:function(){return this.only_bg?void _frame.dom.bg_controls.removeClass("on"):!0},only_bg_toggle:function(){return this.only_bg?this.only_bg_off():this.only_bg_on()},init:function(){if(_frame.app_main.is_init)return!0;_frame.dom.nav=_frame.dom.layout.children("nav"),_frame.dom.logo=$('<button class="logo"/>').on(_g.event.animationend,function(e){_frame.dom.logo.addClass("ready-animated")}).appendTo(_frame.dom.nav),_frame.dom.navlinks=_frame.dom.nav.children(".pages"),_frame.dom.globaloptions=_frame.dom.nav.children("section.options"),_frame.dom.btnShowOnlyBg=$('<button class="show_only_bg" icon="images"/>').on("click",function(){_frame.app_main.only_bg_toggle()}).appendTo(_frame.dom.globaloptions),_frame.dom.btnShowOnlyBgBack=$('<button class="show_only_bg_back" icon="arrow-set2-left"/>').on("click",function(){_frame.app_main.only_bg_off()}).appendTo(_frame.dom.nav),_frame.dom.main=_frame.dom.layout.children("main"),_frame.dom.bgimg=$('<div class="bgimg" />').appendTo(_frame.dom.layout);var e=Q.fcall(function(){});e.then(function(){return _frame.app_main.nav=[],_frame.app_main.navtitle={},_frame.dom.navs={},_frame.dom.navlinks.children("a").each(function(e,t){t=$(t);var a=_g.parseURI(t.attr("href")).page,i=t.text();_frame.app_main.nav.push({title:i,state:t.attr("mod-state"),page:a}),_frame.app_main.navtitle[a]=i,_frame.dom.navs[a]=t}),_frame.app_main.nav}).then(function(){for(var e=0;e<_g.bgimg_count;e++)_frame.app_main.bgimgs.push(e+".jpg");return _frame.app_main.change_bgimg(),_frame.app_main.loaded("bgimgs"),_g.log("BGs: "+_frame.app_main.bgimgs.join(", ")),_frame.app_main.bgimgs}).then(function(){_g.log("Preload All DBs (JSON ver.): START");var e=Q(),t=Q.defer();return _g.dbs.forEach(function(t){e=e.then(function(){var e=Q.defer();return $.ajax({url:"/!/db/"+t+".json",dataType:"text",success:function(e){e=LZString.decompressFromBase64(e);var a=e.split("\n");switch(t){default:"undefined"==typeof _g.data[t]&&(_g.data[t]={}),a.forEach(function(e){if(e){var a=JSON.parse(e);switch(t){case"ships":_g.data[t][a.id]=new Ship(a);break;case"items":_g.data[t][a.id]=new Equipment(a);break;case"entities":_g.data[t][a.id]=new Entity(a);break;default:_g.data[t][a.id]=a}}})}},complete:function(t,a){e.resolve()}}),e.promise})}),e=e["catch"](function(e){console.log(e)}).done(function(){_g.log("Preload All DBs (JSON ver.): DONE"),t.resolve()}),t.promise}).then(function(){_g.log("Preload All DBs: START");var e=[],t=[],a=0;for(var i in _db)t.push(i);return t.forEach(function(i){function n(e){_g.log("DB "+e+" DONE"),o.resolve(),a++,a>=t.length&&(_g.log("Preload All DBs: DONE"),setTimeout(function(){_frame.app_main.loaded("dbs")},100))}var o=Q.defer();_db[i].loadDatabase(function(e){e?o.reject(new Error(e)):_db[i].find({},function(e,t){e?o.reject(new Error(e)):("undefined"==typeof _g.data[i]&&(_g.data[i]={}),t.forEach(function(e){_g.data[i][e.id]=e}),n(i))})}),e.push(o.promise)}),Q.all(e)}).then(function(){var e=function(e){e.preventDefault(),_frame.app_main.load_page($(this).attr("href").substr("?page=".length))},t=function(e){e.preventDefault();var t=$(this);if(!t.attr("data-infos")){var a=/^[\?]{0,1}infos\=([^\&]+)\&id\=([^\&]+)/gi.exec(t.attr("href"));t.attr("data-infos","[["+a[1].toUpperCase()+"::"+a[2]+"]]"),_frame.infos.click(t)}},a=function(e){e.preventDefault();var t=$(this),a=_g.parseURI(t.attr("href"));a.page?_frame.app_main.load_page(a.page):a.infos&&_frame.infos.click(t.attr("data-infos","[["+a.infos.toUpperCase()+"::"+a.id+"]]"))};return $body.on("click.global_delegate_page",'a[href^="?page="]',e).on("click.global_delegate_infos",'a[href^="?infos="]',t).on("click.global_delegate_default",'a[href^="/"]',a),_frame.dom.bgimg.on(_g.event.animationend,"div",function(){_frame.app_main.change_bgimg_after()}),!0})["catch"](function(e){_g.error(e)}).done(function(){_g.log("Global initialization DONE")}),_frame.app_main.is_init=!0}},_g.error=function(e){_instanceof(e,Error)||(e=new Error(e)),_g.log(e)};var debugmode=!1;_frame.app_main.page_init=function(e,t){t=t||_frame.app_main.page_dom[e],_frame.app_main.page[e]&&_frame.app_main.page[e].init&&_frame.app_main.page[e].init(t),_p.initDOM(t)},_tmpl.improvement=function(e,t,a,i){if("undefined"==typeof e)return!1;if("object"!=("undefined"==typeof e?"undefined":_typeof(e))&&!(e=_g.data.items[e]))return!1;t=t||0,a=a||[0],i=i||!1;var n=e.improvement[t],o=n.upgrade?_g.data.items[n.upgrade[0]]:!1,r=[],s="";if(a.forEach(function(e){var t=n.req[e];t[1]&&r.mergeFrom(t[1])}),r.length){var l=[];r.forEach(function(e){l.push('<a href="?infos=ship&id='+e+'" data-infos="[[SHIP::'+e+']]" data-tip="[[SHIP::'+e+']]">'+_g.data.ships[e].getName()+"</a>")}),s="<font>"+l.join(" / ")+"</font>"}else s='<font class="no">无秘书舰要求</font>';return _tmpl["export"]('<span class="improvement">'+_tmpl.improvement__title(e,o,n.upgrade[1])+s+_tmpl.improvement__resource(n,o?!0:!1)+"</span>",i)},_tmpl.improvement_detail=function(e,t){if("undefined"==typeof e)return!1;if("object"!=("undefined"==typeof e?"undefined":_typeof(e))&&!(e=_g.data.items[e]))return!1;var a="",i=e.improvement||[];return i.forEach(function(t){var i=t.upgrade?_g.data.items[t.upgrade[0]]:!1,n=this.improvement__reqdetails(t.req);a+='<span class="improvement improvement-details">'+_tmpl.improvement__title(e,i,t.upgrade[1])+n+_tmpl.improvement__resource(t,i?!0:!1)+"</span>"},this),_tmpl["export"](a,t)},_tmpl.improvement_inEquipmentInfos=function(e,t){if("undefined"==typeof e)return!1;if("object"!=("undefined"==typeof e?"undefined":_typeof(e))&&!(e=_g.data.items[e]))return!1;var a="",i=e.improvement||[];return i.forEach(function(e){var t=e.upgrade?_g.data.items[e.upgrade[0]]:!1,i=this.improvement__reqdetails(e.req);a+='<span class="unit improvement improvement-details"><b>'+(t?'<span class="indicator true">可升级为</span><a style="background-image:url(../app/assets/images/itemicon/'+t.getIconId()+'.png)" href="?infos=equipment&id='+t.id+'" data-infos="[[EQUIPMENT::'+t.id+']]" data-tip="[[EQUIPMENT::'+t.id+']]">'+t.getName(!0)+"</a>"+(e.upgrade[1]?"<i>+"+e.upgrade[1]+"</i>":""):'<span class="indicator false">不可升级</span>')+"</b>"+i+_tmpl.improvement__resource(e,t?!0:!1)+"</span>"},this),_tmpl["export"](a,t)},_tmpl.improvement__title=function(e,t,a){return'<strong><a style="background-image:url(../app/assets/images/itemicon/'+e.getIconId()+'.png)" href="?infos=equipment&id='+e.id+'" data-infos="[[EQUIPMENT::'+e.id+']]" data-tip="[[EQUIPMENT::'+e.id+']]">'+e.getName(!0)+"</a>"+(t?'<b></b><a style="background-image:url(../app/assets/images/itemicon/'+t.getIconId()+'.png)" href="?infos=equipment&id='+t.id+'" data-infos="[[EQUIPMENT::'+t.id+']]" data-tip="[[EQUIPMENT::'+t.id+']]">'+t.getName(!0)+"</a>"+(a?"<i>+"+a+"</i>":""):"")+"</strong>"},_tmpl.improvement__resource=function(e,t){function a(e){return e=parseInt(e),0>e?"?":e}var i={};i.all='<span><em>必要资源</em><i class="fuel">'+a(e.resource[0][0])+'</i><i class="ammo">'+a(e.resource[0][1])+'</i><i class="steel">'+a(e.resource[0][2])+'</i><i class="bauxite">'+a(e.resource[0][3])+"</i></span>";for(var n=1;4>n;n++){var o="";switch(n){case 1:o="★+0 ~ +6";break;case 2:o="★+6 ~ MAX";break;case 3:o="升级"}i[n]="<span><em>"+o+"</em>"+(3!=n||t?'<i class="dev_mat">'+a(e.resource[n][0])+"<i>("+a(e.resource[n][1])+')</i></i><i class="imp_mat">'+a(e.resource[n][2])+"<i>("+a(e.resource[n][3])+")</i></i>"+(e.resource[n][4]?'<a class="equipment" style="background-image:url(../app/assets/images/itemicon/'+_g.data.items[e.resource[n][4]].getIconId()+'.png)" href="?infos=equipment&id='+e.resource[n][4]+'" data-infos="[[EQUIPMENT::'+e.resource[n][4]+']]" data-tip="[[EQUIPMENT::'+e.resource[n][4]+']]">'+_g.data.items[e.resource[n][4]].getName(!0)+"<i>x"+a(e.resource[n][5])+"</i></a>":""):'<i class="no">-</i>')+"</span>"}return"<span>"+i.all+i[1]+i[2]+i[3]+"</span>"},_tmpl.improvement__reqdetails=function(e){if(!e||!e.push||!e.length)return"";var t="<font>";return e.forEach(function(e){var a,i=[];t+="<b>";for(var n=0;7>n;n++){switch(n){case 0:a="日";break;case 1:a="一";break;case 2:a="二";break;case 3:a="三";break;case 4:a="四";break;case 5:a="五";break;case 6:a="六"}t+="<i"+(e[0][n]?' class="on"':"")+">"+a+"</i>"}e[1]?(e[1].forEach(function(e){i.push('<a href="?infos=ship&id='+e+'" data-infos="[[SHIP::'+e+']]" data-tip="[[SHIP::'+e+']]">'+_g.data.ships[e].getName()+"</a>")}),t+=i.join(" / ")):t+="<b>无秘书舰要求</b>",t+="</b>"}),t+="</font>"},_tmpl.link_entity=function(e,t,a,i){if(!e)return!1;if(t&&"object"==("undefined"==typeof t?"undefined":_typeof(t)))return _tmpl.link_entity(e,t.tagName||null,t.returnHTML||null,t.count||null);if(t=t||"a",a=a||!1,i="undefined"==typeof i?!1:i,"object"!=("undefined"==typeof e?"undefined":_typeof(e))){var n=parseInt(e);e=_g.data.entities[n]}else var n=e.id;return _tmpl["export"]("<"+t+("a"==t?' href="?infos=entity&id='+n+'"':"")+' class="link_entity" data-entityid="'+n+'" data-infos="[[ENTITY::'+n+']]">'+(e.picture&&e.picture.avatar?'<i style="background-image:url('+e.picture.avatar+')"></i>':"<i></i>")+"<span>"+e._name+("undefined"==typeof i?"":" <small>("+i+")</small>")+"</span></"+t+">",a)},_tmpl.link_equipment=function(e,t,a,i){if(!e)return!1;if(t&&"object"==("undefined"==typeof t?"undefined":_typeof(t)))return _tmpl.link_equipment(e,t.tagName||null,t.returnHTML||null,"undefined"==typeof t.improvementStar?null:t.improvementStar);if(t=t||"a",a=a||!1,i="undefined"==typeof i?null:i,"object"!=("undefined"==typeof e?"undefined":_typeof(e))){var n=parseInt(e);e=_g.data.items[n]}else var n=e.id;return _tmpl["export"]("<"+t+("a"==t?' href="?infos=equipment&id='+n+'"':"")+' class="link_equipment" data-equipmentid="'+n+'" data-tip-position="right" data-infos="[[EQUIPMENT::'+n+']]" data-tip="[[EQUIPMENT::'+n+']]"><i style="background-image:url(assets/images/itemicon/'+e.getIconId()+'.png)"></i><span>'+e.getName(!0)+"</span>"+(null!==i?"<em"+(0>=i?' class="zero"':"")+">+"+i+"</em>":"")+"</"+t+">",a)},_tmpl.link_ship=function(e,t,a,i){if(!e)return!1;if(t&&"object"==("undefined"==typeof t?"undefined":_typeof(t)))return _tmpl.link_ship(e,t.tagName||null,t.returnHTML||null,t.mode||null);if(t=t||"a",a=a||!1,i=i||"default","object"!=("undefined"==typeof e?"undefined":_typeof(e))){var n=parseInt(e);e=_g.data.ships[n]}else var n=e.id;var o="",r=e.getType();switch(i){case"names":var s=[];e.getSeriesData().forEach(function(e){var t=_g.data.ships[e.id].getNameNoSuffix();$.inArray(t,s)<0&&s.push(t)}),o=s.join(" / ");break;default:o=(r?"<small>"+r+"</small>":"")+e.getName(_g.joint)}return _tmpl["export"]("<"+t+("a"==t?' href="?infos=ship&id='+n+'"':"")+' class="link_ship" data-shipid="'+n+'" data-infos="[[SHIP::'+n+']]"><img src="'+node.path.normalize(_g.path.pics.ships)+"/"+n+'/0.webp"/><span>'+o+"</span></"+t+">",a)},_tmpl.textlink_entity=function(e,t,a){if(!e)return!1;if(t&&"object"==("undefined"==typeof t?"undefined":_typeof(t)))return _tmpl.textlink_entity(e,t.tagName||null,t.returnHTML||null);if(t=t||"a",a=a||!1,"object"!=("undefined"==typeof e?"undefined":_typeof(e))){var i=parseInt(e);e=_g.data.entities[i]}else var i=e.id;return _tmpl["export"]("<"+t+("a"==t?' href="?infos=entity&id='+i+'"':"")+' data-entityid="'+i+'" data-infos="[[ENTITY::'+i+']]">'+e._name+"</"+t+">",a)},_tmpl.textlink_ship=function(e,t,a){if(!e)return!1;if(t&&"object"==("undefined"==typeof t?"undefined":_typeof(t)))return _tmpl.textlink_ship(e,t.tagName||null,t.returnHTML||null);if(t=t||"a",a=a||!1,"object"!=("undefined"==typeof e?"undefined":_typeof(e))){var i=parseInt(e);e=_g.data.ships[i]}else var i=e.id;var n=e.getType();return _tmpl["export"]("<"+t+("a"==t?' href="?infos=ship&id='+i+'"':"")+' data-shipid="'+i+'" data-infos="[[SHIP::'+i+']]">'+(n?"["+n+"] ":"")+e.getName(_g.joint)+"</"+t+">",a)};var PAGE=function(){function e(t){_classCallCheck(this,e)}return _createClass(e,[{key:"modeSelectionEnter",value:function(e,t){var a=void 0;return e=e||function(){},a=function(){e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10]),this.modeSelectionExit()}.bind(this),_frame.app_main.mode_selection_callback=a,_frame.app_main.mode_selection_on(t),a}},{key:"modeSelectionExit",value:function(){return _frame.dom.layout.hasClass("mode-selection")?void _frame.app_main.mode_selection_off():!1}}]),e}();_frame.app_main.page.fleets={init:function(e){this.object=new(function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return e.on({show:function(){this.inited&&(e.html(_frame.app_main.page_html.fleets),_p.initDOM(e)),this.inited=!0}}),a}return _inherits(t,e),t}(PAGE))(e)}},_frame.app_main.page.ships={init:function(e){this.object=new(function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return a.tablelist=e.find(".tablelist"),a.tablelistObj=a.tablelist.data("tablelist"),e.on({on:function(){this.tablelistObj||(this.tablelistObj=this.tablelist.data("tablelist")),this.tablelistObj&&this.tablelistObj.thead_redraw()}.bind(a),modeSelectionEnter:function(e,t){this.modeSelectionEnter(t)}.bind(a)}),a}return _inherits(t,e),t}(PAGE))(e)}},_frame.app_main.page.equipments={init:function(e){this.object=new(function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return a.tablelist=e.find(".tablelist"),a.tablelistObj=a.tablelist.data("tablelist"),e.on({on:function(){this.tablelistObj||(this.tablelistObj=this.tablelist.data("tablelist")),this.tablelistObj&&(this.tablelistObj.thead_redraw(),this.tablelistObj.apply_types())}.bind(a),modeSelectionEnter:function(e,t,a){this.modeSelectionEnter(t,a)}.bind(a),show:function(){this.tablelistObj&&(this.tablelistObj.thead_redraw(),this.tablelistObj.apply_types())}.bind(a)}),a}return _inherits(t,e),t}(PAGE))(e)}},_frame.app_main.page.arsenal={},_frame.app_main.page.arsenal.init=function(e){var t=e.find(".akashi");t.attr({animation:Math.floor(3*Math.random()+1)}).on(_g.event.animationiteration,function(){t.attr("animation",Math.floor(3*Math.random()+1))}),this.elMain=e.children(".main"),this.parse_weekday(this.elMain.children(".body-weekday")),this.parse_all(this.elMain.children(".body-all")),e.find('input[type="radio"]').on("change",function(){_frame.app_main.page.arsenal.elMain.scrollTop(0)})},_frame.app_main.page.arsenal.parse_weekday=function(e){var t=e.find("#arsenal_weekday-showmeterials");t.prop("checked",Lockr.get("arsenal_weekday-showmeterials",!0)?!0:!1).on("change",function(){Lockr.set("arsenal_weekday-showmeterials",t.prop("checked")?1:0)});var a=new Date;return a.setTime(a.getTime()+60*a.getTimezoneOffset()*1e3),a.setTime(a.getTime()+324e5),e.find("#arsenal_weekday-"+a.getDay()).prop("checked",!0),e},_frame.app_main.page.arsenal.parse_all=function(e){},_frame.app_main.page.about={},_frame.app_main.page.about.journal_parse=function(e){for(var t,a=/\[\[([^\:]+)\:([0-9]+)\]\]/gi,i=markdown.toHTML(e);null!==(t=a.exec(e));)try{i=i.replace(t[0],_tmpl["link_"+t[1].toLowerCase()](t[2],null,!0))}catch(n){}for(t=null,a=/\[\[([^\:]+)\:([0-9]+)\:TEXT\]\]/gi;null!==(t=a.exec(e));)try{i=i.replace(t[0],_tmpl["textlink_"+t[1].toLowerCase()](t[2],null,!0))}catch(n){}return i},_frame.app_main.page.about.journaltitle=function(e,t){return e=e||{},t=t||"h3","<h3>"+(e.hotfix?"HOTFIX - ":"")+("app"==e.type?"":("app-db"==e.type?"DB":e.type).toUpperCase()+" / ")+e.version+"<small>"+(e.date?e.date:"WIP")+"</small></h3>"},_frame.app_main.page.about.init=function(e){function t(t){var a=$('<section class="update_journal" data-version-'+t.type+'="'+t.version+'"/>').html(_frame.app_main.page.about.journaltitle(t)).appendTo(e);try{$(_frame.app_main.page.about.journal_parse(t.journal)).appendTo(a)}catch(i){_g.error(i),a.remove()}}var a=Q.fcall(function(){});a.then(function(){var e=Q.defer();return _db.updates.find({date:""}).sort({date:-1,version:-1}).exec(function(a,i){i.forEach(function(e){t(e)}),e.resolve(a)}),e.promise}).then(function(){var e=Q.defer();return _db.updates.find({$not:{date:""}}).sort({date:-1,version:-1}).exec(function(a,i){i.forEach(function(e){t(e)}),e.resolve(a)}),e.promise})},_frame.infos={historyLength:-1,historyCurrent:-1,contentCache:{},getContent:function(e,t,a){function i(e){return a&&a(e),e}function n(a){return _p.initDOM(a.addClass("infosbody").attr({"data-infos-type":e,"data-infos-id":t}))}if(this.contentCache[e]||(this.contentCache[e]={}),!this.firstrun){var o=_frame.infos.dom.container.children(".infosbody").eq(0);if(this.firstrun=!0,o.attr("data-infos-type")==e&&o.attr("data-infos-id")==t)return this.contentCache[e][t]=_p.initDOM(o),_frame.app_main.page_title[_g.state2URI({infos:e,id:t})]=document.title,i(this.contentCache[e][t])}return"__NEW__"==t?i(n(_frame.infos["__"+e](t))):this.contentCache[e][t]?i(this.contentCache[e][t]):void _frame.app_main.loading_start(_g.state2URI({infos:e,id:t}),function(a){var o=/\<div class\=\"wrapper\"\>(.+)\<\/div\>/.exec(a);return _frame.infos.contentCache[e][t]=n($(o.length>1?o[1]:"")),i(_frame.infos.contentCache[e][t])},function(a,i,n){"undefined"!=typeof _frame.infos.contentCache[e][t]&&delete _frame.infos.contentCache[e][t],history.back()})},show:function(e,t,a){var i=/^\[\[([^\:]+)\:\:(.+)\]\]$/.exec(e),n=null,o=null;if(!(i&&i.length>2))return!1;switch(n=i[1].toLowerCase(),o=isNaN(i[2])?i[2]:parseInt(i[2]),n){case"item":case"equip":case"equipments":n="equipment"}return this.curContent==n+"::"+o?_frame.infos.dom.container.children("div:first-child"):(a||(this.historyCurrent++,this.historyLength=this.historyCurrent,_frame.app_main.pushState({infos:n,id:o,infosHistoryIndex:_frame.infos.historyCurrent},null,_g.state2URI({infos:n,id:o}))),void this.show_func(n,o,a))},show_func:function(e,t,a,i){if(!e||!t)return!1;if(this.curContent==e+"::"+t)return _frame.infos.dom.container.children("div:first-child");e=e.toLowerCase(),t=isNaN(t)?t:parseInt(t);var n=null;_frame.infos.dom||(_frame.infos.dom={main:_frame.dom.main.children(".page-container.infos")},_frame.infos.dom.main.length?_frame.infos.dom.container=_frame.infos.dom.main.children(".wrapper"):(_frame.infos.dom.main=$('<div class="page-container infos"/>').appendTo(_frame.dom.main),_frame.infos.dom.container=$('<div class="wrapper"/>').appendTo(_frame.infos.dom.main)),_frame.dom.btnHistoryBack&&_frame.dom.btnHistoryBack.on(eventName("transitionend","infos_hide"),function(e){e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&0==parseFloat(_frame.dom.btnHistoryBack.css("opacity"))&&_frame.infos.hide_finish()})),_frame.dom.btnHistoryForward&&(i="undefined"!=typeof i?i:this.historyCurrent,this.historyCurrent=i,this.historyCurrent==this.historyLength&&this.historyCurrent>-1&&_frame.dom.btnHistoryForward.addClass("disabled")),_frame.dom.layout.addClass("is-infos-show"),this.curContent=e+"::"+t,this.getContent(e,t,function(a){
switch(e){case"ship":case"equipment":case"entity":_frame.infos.dom.main.attr("data-infostype",e),n=a.attr("data-infos-title");break;case"fleet":_frame.infos.dom.main.attr("data-infostype","fleet"),_frame.app_main.mode_selection_off(),TablelistEquipments.types=[]}var i=!contentDOM.data("is_infosinit");a.data("is_infosinit")||("ship"==e&&!function(){var e=parseInt(_config.get("ship_infos_lvl")||99);a.find('input[type="radio"][name^="ship_infos_lvl_"]').each(function(){var t=$(this),a=t.val();t.prop("checked",e==a).on("change",function(){_config.set("ship_infos_lvl",a)})})}(),a.data("is_infosinit",!0).on(eventName("transitionend","hide"),function(e){e.currentTarget==e.target&&"opacity"==e.originalEvent.propertyName&&0==parseInt(a.css("opacity"))&&a.detach().data("is_show",!1)})),this.curContent==e+"::"+t&&(a.prependTo(_frame.infos.dom.container).trigger("show",[i]).data("is_show",!0),_frame.app_main.cur_page&&(_frame.dom.navs[_frame.app_main.cur_page]&&_frame.dom.navs[_frame.app_main.cur_page].removeClass("on"),_frame.app_main.page_dom[_frame.app_main.cur_page]&&_frame.app_main.page_dom[_frame.app_main.cur_page].addClass("off").trigger("pageoff"),_frame.app_main.cur_page=null),_frame.dom.main.attr("data-theme",a.attr("data-theme")||e),setTimeout(function(){_frame.dom.layout.addClass("is-infos-on"),_frame.app_main.title=n,document.title=_frame.app_main.page_title[_g.state2URI({infos:e,id:t})],_frame.infos.last!=n&&_ga.counter(location.search),_frame.infos.last=n},1))}.bind(this))},hide:function(){return _frame.infos.dom&&this.curContent?(_frame.dom.layout.removeClass("is-infos-on"),_frame.dom.btnHistoryForward&&_frame.dom.btnHistoryForward.addClass("disabled"),void(this.curContent=null)):!1},hide_finish:function(){return _frame.infos.curContent?!1:(_frame.dom.layout.removeClass("is-infos-show"),_frame.infos.dom.main.attr({"data-infostype":"","data-theme":""}),this.historyLength=-1,void(this.historyCurrent=-1))},historyback:function(){_frame.infos.dom.main.children().slice(1).remove(),_frame.infos.dom.main.children().eq(0).removeClass("off").addClass("fadein"),_frame.infos.dom.historyback.empty().removeClass("show"),_frame.infos.dom.main.children().eq(0).hasClass("ship")?_frame.infos.dom.main.attr("data-infostype","ship"):_frame.infos.dom.main.children().eq(0).hasClass("equipment")?_frame.infos.dom.main.attr("data-infostype","equipment"):_frame.infos.dom.main.children().eq(0).hasClass("fleet")?_frame.infos.dom.main.attr("data-infostype","fleet"):_frame.infos.dom.main.children().eq(0).hasClass("entity")&&_frame.infos.dom.main.attr("data-infostype","entity")},click:function(e){_frame.infos.show(e.attr("data-infos"),e,e.attr("data-infos-nohistory"))}},_frame.infos.init=function(){return _frame.infos.is_init?!0:($body.on("click._infos","[data-infos]",function(e){("input"!=e.target.tagName.toLowerCase()||"compare"!=e.target.className)&&(_frame.infos.click($(this)),"a"==e.target.tagName.toLowerCase()&&e.preventDefault())}),_frame.infos.is_init=!0,!0)},_frame.infos.__fleet=function(e){var t=new InfosFleet(e),a=t.el;return a};var InfosFleet=function(){function e(t){_classCallCheck(this,e),this.el=$('<div class="infos-fleet loading"/>').attr("data-infos-title","舰队 ("+t+")"),this.doms={},this.fleets=[],"__NEW__"==t?_db.fleets.insert(_tablelist.prototype._fleets_new_data(),function(e,t){e?_g.error(e):"fleet::__NEW__"==_frame.infos.curContent&&_frame.infos.show("[[FLEET::"+t._id+"]]")}.bind(this)):_db.fleets.find({_id:t},function(e,a){e||!a?_g.error(e):_frame.infos.curContent=="fleet::"+t&&this.init(a[0])}.bind(this)),this.el.on("show",function(e,t){if(!t){for(var a=0,i=Lockr.get("hqLvDefault",_g.defaultHqLv);4>a;)this.fleets[a].summaryCalc(!0),a++;this._hqlv||this.doms.hqlvOption.val(i),this.doms.hqlvOptionLabel.attr("data-tip","输入 0 表示采用默认等级 (Lv."+i+")"),this.doms.hqlvOption.attr("placeholder",i)}}.bind(this))}return _createClass(e,[{key:"init",value:function(t){if(!t)return!1;this.data=t;var a=0,i=Lockr.get("hqLvDefault",_g.defaultHqLv);for(this.el.attr({"data-fleetid":t._id,"data-infos-id":t._id}).removeClass("loading"),$("<header/>").append(this.doms.name=$("<h3 contenteditable/>").html("点击编辑标题").on({input:function(){this.update_data({}),this.doms.name.trigger("namechange")}.bind(this),focus:function(){"点击编辑标题"==this.doms.name.text()&&this.doms.name.html("")}.bind(this),blur:function(){this.doms.name.text()||this.doms.name.html("点击编辑标题")}.bind(this),namechange:function(e,t){return"undefined"==typeof t&&(t=this.doms.name.text()),this._name=t,this.doms.name}.bind(this),keydown:function(e){13==e.keyCode&&(this.doms.name.blur(),setTimeout(function(){this.doms.name.blur()}.bind(this),1))}.bind(this)})).append(this.doms.user=$("<button/>")).appendTo(this.el),$('<div class="fleets"/>').append(this.doms.tabs=$('<div class="tabs"/>')).append(this.doms.options=$('<div class="options"/>').append(this.doms.hqlvOptionLabel=$("<label/>",{"class":"option option-hqlv",html:"司令部等级","data-tip":"输入 0 表示采用默认等级 (Lv."+i+")"}).append(this.doms.hqlvOption=$("<input/>",{type:"number",min:0,max:150,placeholder:i}).val(this._hqlv||i).on({input:function(){this._hqlv=this.doms.hqlvOption.val()}.bind(this),focus:function(){this.doms.hqlvOption.trigger("tipshow")}.bind(this),blur:function(){this.doms.hqlvOption.trigger("tiphide")}.bind(this),click:function(e){e.stopImmediatePropagation(),e.stopPropagation()}}))).append(this.doms.theme=$('<select class="option option-theme-value"/>').on("change",function(){this._theme=this.doms.theme.val()}.bind(this)).append(function(){for(var e=$(),t=1;11>t;t++)e=e.add($("<option/>",{value:t,html:"主题-"+t}));return e})).append(this.doms.themeOption=$('<button class="option option-theme mod-dropdown"/>').html("主题").on("click",function(){var t=this;if(!e.menuTheme){e.menuThemeItems=$("<div/>");for(var a=function(a){$('<button class="theme-'+a+'"/>').html(a).on("click",function(){e.menuCur._theme=a,this.el.attr("data-theme",this._theme)}.bind(t)).appendTo(e.menuThemeItems)},i=1;11>i;i++)a(i);e.menuTheme=new _menu({className:"contextmenu-infos_fleet_themes",items:[e.menuThemeItems]})}e.menuCur=this,e.menuTheme.show(this.doms.themeOption)}.bind(this))).append(this.doms.exportOption=$('<button class="option mod-dropdown"/>').html("导出").on("click",function(){e.menuExport||(e.menuExport=new _menu({className:"contextmenu-infos_fleet_themes",items:[$("<menuitem/>",{html:"导出代码"}).on("click",function(){e.menuCur.modalExport_show()}),$("<menuitem/>",{html:"导出文本"}).on("click",function(){e.menuCur.modalExportText_show()}),$("<menuitem/>",{html:"导出图片"}).on("click",function(){e.menuCur.exportPic()})]})),e.menuCur=this,e.menuExport.show(this.doms.exportOption)}.bind(this))).append(this.doms.optionOptions=$('<button class="icon" icon="cog"/>').on("click",function(){TablelistFleets.menuOptions_show(this.doms.optionOptions)}.bind(this)))).appendTo(this.el),this.doms.ships=$('<div class="ships"/>').appendTo(this.el);4>a;)this.fleets[a]=new InfosFleetSubFleet(this,[],a),$("<input/>",{type:"radio",name:"fleet_"+t._id+"_tab",id:"fleet_"+t._id+"_tab_"+a,value:a}).prop("checked",0==a).prependTo(this.el),$("<label/>",{"for":"fleet_"+t._id+"_tab_"+a,"data-fleet":a,html:"#"+(a+1)}).appendTo(this.doms.tabs),this.fleets[a].el.attr("data-fleet",a).appendTo(this.doms.ships),a++;this.update(t),this._theme=this._theme,$body.on("update_defaultHqLv.fleet"+this.data._id,function(e,t){this.el.data("is_show")&&(this._hqlv||this.doms.hqlvOption.val(t),this.doms.hqlvOptionLabel.attr("data-tip","输入 0 表示采用默认等级 (Lv."+t+")"),this.doms.hqlvOption.attr("placeholder",t))}.bind(this))}},{key:"update",value:function(e){this._updating=!0,e=e||{},"undefined"!=typeof e.theme&&(_frame.infos.dom.main.attr("data-theme",e.theme),this.doms.theme.val(e.theme).attr("value",e.theme)),"undefined"!=typeof e.name&&this.doms.name.trigger("namechange",[e.name]).trigger("blur"),e.data&&e.data.push&&e.data.forEach(function(e,t){this.fleets[t].updateEl(e)},this),this._updating=!1}},{key:"update_data",value:function(e){e=e||{},this.update(e)}},{key:"save",value:function(e){return this._updating?this:(this.fleets.forEach(function(e,t){this.data.data[t]=e.data},this),this.data.time_modify=_g.timeNow(),e||_db.fleets.updateById(this.data._id,this.data,function(){_g.log("saved")}),this)}},{key:"modalExport_show",value:function(){e.modalExport_show(this.data)}},{key:"modalExportText_show",value:function(){e.modalExportText_show(this.data)}},{key:"exportPic",value:function(){e.fileDialog_export||(e.fileDialog_export=$('<input type="file" accept=".png" nwsaveas/>').on({click:function(t,a,i){e.fileDialog_export.data({windowWidth:a,windowHeight:i}),e.fileDialog_export_showing=!0},change:function(){var t=e.fileDialog_export.val();e.fileDialog_export.val(""),_g.log("changed"),setTimeout(function(){node.win.capturePage(function(e){var a=node.fs.createWriteStream(t);a.write(e),a.end()},{format:"png",datatype:"buffer"})},0)},resetCaptureMode:function(){!e.fileDialog_export.val()&&$body.hasClass("mod-capture")&&($body.removeClass("mod-capture"),node.win.resizeTo(e.fileDialog_export.data("windowWidth"),e.fileDialog_export.data("windowHeight")),e.fileDialog_export.data({windowWidth:null,windowHeight:null}),_menu.hideAll())}}).appendTo(_frame.dom.hidden),$window.on("focus.resetCaptureMode",function(){e.fileDialog_export_showing&&setTimeout(function(){e.fileDialog_export.trigger("resetCaptureMode"),e.fileDialog_export_showing=!1},100)}));var t=$window.width(),a=$window.height();$body.addClass("mod-capture"),node.win.resizeTo(1280,720),e.fileDialog_export.trigger("click",[t,a])}},{key:"_name",get:function(){return this.data.name},set:function(e){this.data.name=e,this.doms.name.html(e),e?this.doms.name.attr("data-content",e):this.doms.name.removeAttr("data-content"),this.save()}},{key:"_theme",get:function(){return this.data.theme},set:function(e){this.data.theme=e||1,this.doms.theme.val(this.data.theme).attr("value",this.data.theme),_frame.infos.dom.main.attr("data-theme",this.data.theme),this.el.attr("data-theme",this.data.theme),_frame.dom.main.attr("data-theme",this.data.theme),this.save()}},{key:"_hqlv",get:function(){return this.data.hq_lv>0?this.data.hq_lv:0},set:function(e){e=parseInt(e);var t=this._hqlv;if(e&&e>0?(this.data.hq_lv=e,this.doms.hqlvOption.val(e)):(e=-1,this.data.hq_lv=-1,this.doms.hqlvOption.val(Lockr.get("hqLvDefault",_g.defaultHqLv))),t!=e){for(var a=0;4>a;)this.fleets[a].summaryCalc(!0),a++;this.save()}}}]),e}();InfosFleet.modalExport=function(e){return InfosFleet.elModalExport||(InfosFleet.elModalExport=$("<div/>").append(InfosFleet.elModalExportTextarea=$("<textarea/>",{readonly:!0})).append($('<p class="note-codeusage"/>').html('* 该配置代码可用于<a href="http://www.kancolle-calc.net/deckbuilder.html">艦載機厨デッキビルダー</a>')).append($('<button class="button"/>').html("复制到剪切板").on("click",function(){node.clipboard.set(InfosFleet.elModalExportTextarea.val(),"text")}))),InfosFleet.elModalExportTextarea.val(e||""),InfosFleet.elModalExport},InfosFleet.modalExport_show=function(e){e=e.data||[],e=JSON.stringify(_g.kancolle_calc.encode(e)),_frame.modal.show(InfosFleet.modalExport(e),"导出配置代码",{classname:"infos_fleet infos_fleet_export"})},InfosFleet.modalExportText_show=function(e){if(!e)return!1;var t="",a=e.data.filter(function(e){return e.length})||[];t+=e.name||"",a.forEach(function(e,i){t+=(t?"\n":"")+(a.length>1?"\n第 "+(i+1)+" 舰队":""),e.filter(function(e){return e.length>0&&e[0]}).forEach(function(e,a){t+="\n("+(i?i+1+"-":"")+(a+1)+")"+_g.data.ships[e[0]]._name+(e[1]&&e[1][0]?" Lv."+e[1][0]:"");var n=e[2]||[],o=e[3]||[],r=e[4]||[];n.filter(function(e){return e}).forEach(function(e,a){t+=(a?", ":" | ")+_g.data.items[e]._name+(o[a]?"★"+o[a]:"")+(r[a]?"["+_g.textRank[r[a]]+"]":"")})})}),t+=(t?"\n\n":"")+"* 创建自 是谁呼叫舰队 (fleet.diablohu.com)",_frame.modal.show(InfosFleet.modalExport(t),"导出配置文本",{classname:"infos_fleet infos_fleet_export mod-text"})};var InfosFleetSubFleet=function(){function e(t,a,i){_classCallCheck(this,e),a=a||[],this.data=a,this.el=$('<dl class="fleetinfos-ships"/>'),this.ships=[];for(var n=0;6>n;)this.ships[n]=new InfosFleetShip(t,this,n),this.ships[n].getEl().appendTo(this.el),n++;this.elSummary=$('<span class="summary"/>').appendTo(this.el).append($('<span class="summary-item"/>').html("航速").append(this.elSummarySpeed=$("<strong/>").html("-"))).append($('<span class="summary-item"/>').html("制空战力").append(this.elSummaryFighterPower=$("<strong/>").html("-"))).append($('<span class="summary-item"/>').html("索敌能力").append(this.elSummaryLos=$("<strong/>").html("-"))).append($('<span class="summary-item summary-item-consummation"/>').html("总消耗").append(this.elSummaryConsummation=$("<strong/>").html("-"))),this.infosFleet=t,this.updateEl(),$body.on("update_defaultHqLv.fleet"+t.data._id+"-"+(i+1),function(){this.infosFleet.el.data("is_show")&&this.summaryCalc(!0)}.bind(this))}return _createClass(e,[{key:"updateEl",value:function(e){this.data=e||this.data,e&&e.forEach(function(e,t){this.ships[t].updateEl(e)},this)}},{key:"getData",value:function(){return this.data}},{key:"summaryCalc",value:function(e){return this.summaryCalculating?!1:void(this.summaryCalculating=setTimeout(function(){var t=this;e||!function(){var e=[0,0],a="fast",i=0,n=0;if(t.ships.forEach(function(t){if(t.data[0]){var o=_g.data.ships[t.data[0]];o.stat.speed<10&&(a="slow"),t.calculate("fighterPower_v2").forEach(function(t,a){e[a]+=t>0?t:0}),i+=o.getAttribute("fuel",t.shipLv)||0,n+=o.getAttribute("ammo",t.shipLv)||0}}),t.elSummarySpeed.html("fast"==a?"高速":"低速"),Math.max(e[0],e[1])>0){var o=Math.floor(e[0]),r=Math.floor(e[1]);t.elSummaryFighterPower.html(o==r?o:o+"~"+r),t.elSummaryFighterPower.removeClass("empty")}else t.elSummaryFighterPower.html("-"),t.elSummaryFighterPower.addClass("empty");t.elSummaryConsummation.html(i||n?'<span class="fuel">'+i+'</span><span class="ammo">'+n+"</span>":"-")}();var a=this.summaryCalcLos();if(a.y_estimate&&a.y_std_error){var i=(a.y_estimate-a.y_std_error).toFixed(1),n=(a.y_estimate+a.y_std_error).toFixed(1);0>i&&(i=0),0>n&&(n=0),this.elSummaryLos.html(i==n?i:i+"~"+n)}this.summaryCalculating=null}.bind(this),10))}},{key:"summaryCalcLos",value:function(){var e=function(e){e=$.extend({"(Intercept)":1},e),e.hqLv=5*Math.ceil(e.hqLv/5);var o={},r=0;$.each(t,function(){var t=e[this]*a[this];o[this]=t,r+=t});var s={};$.each(t,function(){s[this]=e[this]*i[this]});var l=0;return $.each(t,function(){var e=this;$.each(t,function(){var t=this;l+=s[e]*s[t]*n[e][t]})}),{x_estimate:o,y_estimate:r,x_std_error:s,y_std_error:l}},t=["(Intercept)","DiveBombers","TorpedoBombers","CarrierRecons","SeaplaneRecons","SeaplaneBomber","SmallRadars","LargeRadars","Searchlights","statLos","hqLv"],a={"(Intercept)":0,DiveBombers:1.03745043134563,TorpedoBombers:1.3679056374142,CarrierRecons:1.65940512636315,SeaplaneRecons:2,SeaplaneBomber:1.77886368594467,SmallRadars:1.0045778494921,LargeRadars:.990738063979571,Searchlights:.906965144360512,statLos:1.6841895400986,hqLv:-.614246711531445},i={"(Intercept)":4.66445565766347,DiveBombers:.0965028505325845,TorpedoBombers:.108636184978525,CarrierRecons:.0976055279516298,SeaplaneRecons:.0866229392463539,SeaplaneBomber:.0917722496848294,SmallRadars:.0492773648320346,LargeRadars:.0491221486053861,Searchlights:.0658283797225724,statLos:.0781594211213618,hqLv:.0369222352426548},n={"(Intercept)":{"(Intercept)":1,DiveBombers:-.147020064768061,TorpedoBombers:-.379236131621529,CarrierRecons:-.572858669501918,SeaplaneRecons:-.733913857017495,SeaplaneBomber:-.642621825152428,SmallRadars:-.674829588068364,LargeRadars:-.707418111752863,Searchlights:-.502304601556193,statLos:-.737374218573832,hqLv:-.05071933950163},DiveBombers:{"(Intercept)":-.147020064768061,DiveBombers:1,TorpedoBombers:.288506347076736,CarrierRecons:.365820372770994,SeaplaneRecons:.425744409856409,SeaplaneBomber:.417783698791503,SmallRadars:.409046013184429,LargeRadars:.413855653833994,Searchlights:.308730607324667,statLos:.317984916914851,hqLv:-.386740224500626},TorpedoBombers:{"(Intercept)":-.379236131621529,DiveBombers:.288506347076736,TorpedoBombers:1,CarrierRecons:.482215071254241,SeaplaneRecons:.584455876852325,SeaplaneBomber:.558515133495825,SmallRadars:.547260012897553,LargeRadars:.560437619378443,Searchlights:.437934879351188,statLos:.533934507932748,hqLv:-.405349979885748},CarrierRecons:{"(Intercept)":-.572858669501918,DiveBombers:.365820372770994,TorpedoBombers:.482215071254241,CarrierRecons:1,SeaplaneRecons:.804494553748065,SeaplaneBomber:.75671307047535,SmallRadars:.748420581669228,LargeRadars:.767980338133817,Searchlights:.589651513349878,statLos:.743851348255527,hqLv:-.503544281376776},SeaplaneRecons:{"(Intercept)":-.733913857017495,DiveBombers:.425744409856409,TorpedoBombers:.584455876852325,CarrierRecons:.804494553748065,SeaplaneRecons:1,SeaplaneBomber:.932444440578382,SmallRadars:.923988080549326,LargeRadars:.94904944359066,Searchlights:.727912987329348,statLos:.944434077970518,hqLv:-.614921413821462},SeaplaneBomber:{"(Intercept)":-.642621825152428,DiveBombers:.417783698791503,TorpedoBombers:.558515133495825,CarrierRecons:.75671307047535,SeaplaneRecons:.932444440578382,SeaplaneBomber:1,SmallRadars:.864289865445084,LargeRadars:.886872388674911,Searchlights:.68310647756898,statLos:.88122333327317,hqLv:-.624797255805045},SmallRadars:{"(Intercept)":-.674829588068364,DiveBombers:.409046013184429,TorpedoBombers:.547260012897553,CarrierRecons:.748420581669228,SeaplaneRecons:.923988080549326,SeaplaneBomber:.864289865445084,SmallRadars:1,LargeRadars:.872011318623459,Searchlights:.671926570242336,statLos:.857213501657084,hqLv:-.560018086758868},LargeRadars:{"(Intercept)":-.707418111752863,DiveBombers:.413855653833994,TorpedoBombers:.560437619378443,CarrierRecons:.767980338133817,SeaplaneRecons:.94904944359066,SeaplaneBomber:.886872388674911,SmallRadars:.872011318623459,LargeRadars:1,Searchlights:.690102027588321,statLos:.883771367337743,hqLv:-.561336967269448},Searchlights:{"(Intercept)":-.502304601556193,DiveBombers:.308730607324667,TorpedoBombers:.437934879351188,CarrierRecons:.589651513349878,SeaplaneRecons:.727912987329348,SeaplaneBomber:.68310647756898,SmallRadars:.671926570242336,LargeRadars:.690102027588321,Searchlights:1,statLos:.723228553177704,hqLv:-.518427865593732},statLos:{"(Intercept)":-.737374218573832,DiveBombers:.317984916914851,TorpedoBombers:.533934507932748,CarrierRecons:.743851348255527,SeaplaneRecons:.944434077970518,SeaplaneBomber:.88122333327317,SmallRadars:.857213501657084,LargeRadars:.883771367337743,Searchlights:.723228553177704,statLos:1,hqLv:-.620804120587684},hqLv:{"(Intercept)":-.05071933950163,DiveBombers:-.386740224500626,TorpedoBombers:-.405349979885748,CarrierRecons:-.503544281376776,SeaplaneRecons:-.614921413821462,SeaplaneBomber:-.624797255805045,SmallRadars:-.560018086758868,LargeRadars:-.561336967269448,Searchlights:-.518427865593732,statLos:-.620804120587684,hqLv:1}},o=this.infosFleet.data.hq_lv||Lockr.get("hqLvDefault",_g.defaultHqLv);0>o&&(o=Lockr.get("hqLvDefault",_g.defaultHqLv));var r={DiveBombers:0,TorpedoBombers:0,CarrierRecons:0,SeaplaneRecons:0,SeaplaneBomber:0,SmallRadars:0,LargeRadars:0,Searchlights:0,statLos:0,hqLv:o};return this.ships.forEach(function(e){if(e&&e.shipId){var t=e.data[2].map(function(e){return e?_instanceof(e,Equipment)?e:_g.data.items[e]:null})||[];t.forEach(function(e){if(e)for(var t in r)Formula.equipmentType[t]&&Formula.equipmentType[t].push&&Formula.equipmentType[t].indexOf(e.type)>-1&&(r[t]+=e.stat.los)});var a=e.shipLv||1;0>a&&(a=1),r.statLos+=Math.sqrt(_g.data.ships[e.shipId].getAttribute("los",a))}}),e(r)}},{key:"save",value:function(){var e=!0;this.data=this.data||[],this.ships.forEach(function(t,a){this.data[a]=t.data,t.data[0]&&(e=!1)},this),e&&(this.data=null),this.infosFleet&&this.infosFleet.save()}}]),e}(),InfosFleetShip=function(){function e(t,a,i,n){return _classCallCheck(this,e),this.el?this.el:(n=n||[null,[null,-1],[],[],[]],this.data=n,this.infosFleet=t,this.infosFleetSubFleet=a,this.equipments=[],this.index=i,this.el=$('<dd class="noship"/>').append($("<dt/>").append(this.elAvatar=$("<s/>").on({mousedown:function(t){t.preventDefault(),this.data[0]&&e.dragStart(this)}.bind(this)})).append(this.elInfos=$("<div/>").html("<span>选择舰娘...</span>").append(this.elInfosTitle=$('<div class="title"/>')).append($('<div class="info"/>').append($("<label/>").html("Lv.").append(this.elInputLevel=$("<input/>",{type:"number",min:0,max:150}).on({change:function(e){var t=this.elInputLevel.val();"undefined"!=typeof t&&""!==t||!this.data[1][0]||(this.shipLv=null),t=parseInt(t),0>t?(t=0,this.elInputLevel.val(0)):t>150&&(t=150,this.elInputLevel.val(150)),isNaN(t)||this.data[1][0]==t||(this.shipLv=t)}.bind(this),input:function(){this.elInputLevel.trigger("change")}.bind(this)}))).append(this.elInfosInfo=$("<span/>"))))).append($('<div class="equipments"/>').append(function(){for(var e=$(),t=0;4>t;t++)this.equipments[t]=new InfosFleetShipEquipment(this,t),e=e.add(this.equipments[t].el);return e}.bind(this))).append($('<div class="attributes"/>').append(this.elAttrShelling=$('<span class="shelling"/>')).append(this.elAttrTorpedo=$('<span class="torpedo"/>')).append(this.elAttrHitSum=$('<span class="hitsum"/>')).append(this.elAttrHp=$('<span class="hp"/>')).append(this.elAttrArmor=$('<span class="armor"/>')).append(this.elAttrEvasion=$('<span class="evasion"/>')).append(this.elAttrNightBattle=$('<span class="nightbattle" data-text="夜战"/>'))).append($('<div class="options"/>').append(this.elBtnOptions=$('<button class="options"/>').on("click",function(e){this.showMenu()}.bind(this)))).on({click:function(){this.data[0]||this.selectShipStart()}.bind(this),mouseenter:function(t){e.dragEnter(this)}.bind(this)}),this.after=$("<s/>"),void(this.els=this.el.add(this.after)))}return _createClass(e,[{key:"getEl",value:function(){return this.els}},{key:"selectShipStart",value:function(){_g.log("开始选择舰娘"),_frame.app_main.load_page("ships",{callback_modeSelection_select:function(e){history.back(),this.shipId=e,this.shipLv=null,this.infosFleet&&_frame.infos.dom.main.attr("data-theme",this.infosFleet.data.theme)}.bind(this)})}},{key:"changeLuck",value:function(e){this.data[1][1]=e||-1}},{key:"updateAttrs",value:function(){this.elAttrShelling.html(this.calculate("shellingDamage")),this.elAttrTorpedo.html(this.calculate("torpedoDamage"));var e=this.calculate("addHit");e>=0?this.elAttrHitSum.removeClass("negative"):this.elAttrHitSum.addClass("negative"),this.elAttrHitSum.html(e),this.elAttrHp.html(this.calculate("attribute","hp")),this.elAttrArmor.html(this.calculate("attribute","armor")+this.calculate("addArmor"));var t=this.shipLv?this.calculate("attribute","evasion"):-1;this.elAttrEvasion.html(t>=0?t+this.calculate("addEvasion"):"-"),this.elAttrNightBattle.html(this.calculate("nightBattle"))}},{key:"calculate",value:function(e,t){if(!this.shipId)return"-";if("attribute"==e)return _g.data.ships[this.shipId].getAttribute(t,this.shipLv);if(Formula[e])switch(e){case"losPower":return Formula[e](this.shipId,this.data[2],this.data[3],this.data[4],{hqLv:this.infosFleet.data.hq_lv,shipLv:this.shipLv});default:return Formula[e](this.shipId,this.data[2],this.data[3],this.data[4])}return"-"}},{key:"updateEl",value:function(e){this._updating=!0,this.data=e||this.data,"string"==typeof this.data[0]&&(this.data[0]=parseInt(this.data[0])),this.data[2]||(this.data[2]=[]),this.data[3]||(this.data[3]=[]),this.data[4]||(this.data[4]=[]),this.data[0]&&(this.shipId=this.data[0]),this.data[1][0]&&(this.shipLv=this.data[1][0]);for(var t=0;4>t;t++)this.equipments[t].id=this.data[2][t],this.equipments[t].star=this.data[3][t],this.equipments[t].rank=this.data[4][t];this.updateAttrs(),this._updating=!1}},{key:"getData",value:function(){return this.data}},{key:"showMenu",value:function(){e.menuCurObj=this,e.menu||(e.menuItems=[$('<menuitem class="move move-up"/>').html(" ").on({click:function(t){e.menuCurObj.moveUp()},show:function(){e.menuCurObj.index?e.menuItems[0].removeClass("disabled"):e.menuItems[0].addClass("disabled")}}),$('<menuitem class="move move-down"/>').html(" ").on({click:function(t){e.menuCurObj.moveDown()},show:function(){e.menuCurObj.index<5?e.menuItems[1].removeClass("disabled"):e.menuItems[1].addClass("disabled")}}),$("<hr/>"),$("<menuitem/>").html("查看资料").on({show:function(){e.menuItems[3].attr("data-infos","[[SHIP::"+e.menuCurObj.shipId+"]]")}}),$("<menuitem/>").html("移除").on({click:function(t){e.menuCurObj.shipId=null}}),$("<menuitem/>").html("替换为 ...").on({click:function(t){e.menuCurObj.selectShipStart()}}),$("<div/>").on("show",function(){var t=e.menuItems[6].empty();if(e.menuCurObj.shipId){var a=_g.data.ships[e.menuCurObj.shipId].getSeriesData()||[];a.length>1&&a.forEach(function(a,i){i||t.append($("<hr/>")),a.id!=e.menuCurObj.shipId&&t.append($("<menuitem/>").html("替换为 "+_g.data.ships[a.id].getName(!0)).on({click:function(){e.menuCurObj.shipId=a.id}}))})}})],e.menu=new _menu({className:"contextmenu-ship",items:e.menuItems})),e.menu.show(this.elBtnOptions)}},{key:"swap",value:function(e,t){"number"==typeof e&&(e=this.infosFleetSubFleet.ships[e]),this.index>e.index?this.el.insertBefore(e.el):this.el.insertAfter(e.after),this.after.insertAfter(this.el);var a=e.index,i=this.index;console.log(a,i),this.index=a,e.index=i,this.infosFleetSubFleet.ships[a]=this,this.infosFleetSubFleet.ships[i]=e,t&&this.save()}},{key:"moveUp",value:function(){this.index<=0||this.swap(this.index-1,!0)}},{key:"moveDown",value:function(){this.index>=5||this.swap(this.index+1,!0)}},{key:"save",value:function(){return this._updating?!1:(this._updateTimeout||(this._updateTimeout=setTimeout(function(){this.updateAttrs(),this.infosFleetSubFleet.summaryCalc(),this._updateTimeout=null}.bind(this),10)),void(this._saveTimeout||(this._saveTimeout=setTimeout(function(){this.infosFleetSubFleet&&this.infosFleetSubFleet.save(),this._saveTimeout=null}.bind(this),1e3))))}},{key:"shipId",get:function(){return this.data[0]},set:function(e){if(e!=this.data[0]&&(this.data[0]=e,this.shipLv=null),e){var t=_g.data.ships[e],a=t.getSuffix(),i=t._speed,n=t._type;n=n.replace(i,""),this.el.attr("data-shipId",e),this.el.removeClass("noship"),this.elAvatar.html('<img src="'+t.getPic(10)+'"/>'),this.elInfosTitle.html('<h4 data-content="'+t.name[_g.lang]+'">'+t.name[_g.lang]+"</h4>"+(a?'<h5 data-content="'+a+'">'+a+"</h5>":"")),this.elInfosInfo.html(i+" "+n);for(var o=0;4>o;o++)this.equipments[o].carry=t.slot[o],this._updating||(this.equipments[o].id=null,this.equipments[o].star=null,this.equipments[o].rank=null)}else this.el.removeAttr("data-shipId"),this.el.addClass("noship"),this.elAvatar.html(""),this.data[2]=[],this.data[3]=[],this.data[4]=[];this.save()}},{key:"shipLv",get:function(){return this.data[1][0]},set:function(e){this.data[1][0]=e||null,e&&e>0?this.elInputLevel.val(e):this.elInputLevel.val(""),this.save()}}]),e}();InfosFleetShip.dragStart=function(e){return InfosFleetShip.dragging||!e?!1:(InfosFleetShip.dragging=e,e.el.addClass("moving"),void(InfosFleetShip.isInit||($body.on({"mouseup.InfosFleetShip_dragend":function(){InfosFleetShip.dragging&&(InfosFleetShip.dragging.el.removeClass("moving"),InfosFleetShip.dragging.save(),InfosFleetShip.dragging=null)}}),InfosFleetShip.isInit=!0)))},InfosFleetShip.dragEnter=function(e){return InfosFleetShip.dragging&&e&&InfosFleetShip.dragging!=e?void InfosFleetShip.dragging.swap(e):!1};var InfosFleetShipEquipment=function(){function e(t,a){return _classCallCheck(this,e),this.index=a||0,this.infosFleetShip=t,this.el?this.el:void(this.el=$('<div class="equipment"/>').append(this.elCarry=$('<div class="equipment-layer equipment-add"/>').on("click",function(){this.selectEquipmentStart()}.bind(this))).append($('<div class="equipment-layer equipment-infos"/>').append(this.elName=$('<span class="equipment-name"/>')).append(this.elStar=$('<span class="equipment-star"/>').html(0)).append(this.elRank=$('<span class="equipment-rank"/>')).append(function(){var e=$('<span class="equipment-carry"/>').html(0);return this.elCarry=this.elCarry.add(e),e}.bind(this))).append($('<div class="equipment-layer equipment-options"/>').append(this.elInputStar=$("<input/>",{"class":"equipment-starinput",type:"number",placeholder:0}).on("input",function(){var e=this.elInputStar.val();"undefined"!=typeof e&&""!==e||!this.star||(this.star=null),e=parseInt(e),isNaN(e)||this.star==e||(this.star=e)}.bind(this))).append(this.elSelectRank=$("<div/>",{"class":"equipment-rankselect",html:"<span>无</span>"}).on("click",function(){if(!InfosFleet.menuRankSelect){InfosFleet.menuRankSelectItems=$("<div/>");for(var e=function(e){$('<button class="rank-'+e+'"/>').html(e?"":"无").on("click",function(){InfosFleet.menuRankSelectCur.rank=e}).appendTo(InfosFleet.menuRankSelectItems)},t=0;8>t;t++)e(t);InfosFleet.menuRankSelect=new _menu({className:"contextmenu-infos_fleet_rank_select",items:[InfosFleet.menuRankSelectItems]})}InfosFleet.menuRankSelectCur=this,InfosFleet.menuRankSelect.show(this.elSelectRank)}.bind(this))).append(this.elButtonInspect=$('<button class="inspect" icon="search"/>').on("click",function(){this.id&&_frame.infos.show("[[EQUIPMENT::"+this.id+"]]")}.bind(this))).append($('<button class="change" icon="loop"/>').on("click",function(){this.selectEquipmentStart()}.bind(this))).append($('<button class="remove"/>').html("×").on("click",function(){this.id=null}.bind(this)))))}return _createClass(e,[{key:"getEl",value:function(){return this.el}},{key:"selectEquipmentStart",value:function(){_g.log("开始选择装备"),_frame.app_main.load_page("equipments",{callback_modeSelection_select:function(e){history.back(),this.id=e,this.star=0,this.rank=Lockr.get("fleetlist-option-aircraftdefaultmax")&&e&&$.inArray(_g.data.items[e].type,_g.data.item_type_collections[3].types)>-1?7:0,TablelistEquipments.types=[],TablelistEquipments.shipId=null,this.infosFleetShip.infosFleet&&_frame.infos.dom.main.attr("data-theme",this.infosFleetShip.infosFleet.data.theme)}.bind(this),callback_modeSelection_enter:function(){TablelistEquipments.types=_g.data.ships[this.infosFleetShip.shipId].getEquipmentTypes(),TablelistEquipments.shipId=this.infosFleetShip.shipId,_frame.app_main.page.equipments.object.tablelistObj.apply_types()}.bind(this)})}},{key:"getData",value:function(){return this.data}},{key:"save",value:function(){return this._updating?!1:void(this.infosFleetShip&&this.infosFleetShip.save())}},{key:"id",get:function(){return this.infosFleetShip.data[2][this.index]},set:function(e){e=parseInt(e)||null,_p.tip.hide(),this.el.removeData(["tip","tip-filtered"]),e!=this.infosFleetShip.data[2][this.index]&&(this.star=0),e&&!isNaN(e)?(this.infosFleetShip.data[2][this.index]=e,this.improvable=_g.data.items[e].improvable||!1,this.el.attr({"data-equipmentid":e,"data-tip":"[[EQUIPMENT::"+e+"]]"}).css("background-image","url("+_g.data.items[e]._icon+")"),this.elName.html(_g.data.items[e]._name),$.inArray(_g.data.items[e].type,_g.data.item_type_collections[3].types)>-1?this.el.addClass("is-aircraft"):this.el.removeClass("is-aircraft")):(this.infosFleetShip.data[2][this.index]=null,this.improvable=!1,this.el.removeAttr("data-equipmentId").removeAttr("data-tip").css("background-image","").removeClass("is-aircraft"),this.elName.html("")),this.infosFleetShip.infosFleetSubFleet.summaryCalc(),this.save()}},{key:"star",get:function(){return this.infosFleetShip.data[3][this.index]},set:function(e){this._improvable?(e=parseInt(e)||null,e>10&&(e=10),0>e&&(e=0),e?(this.infosFleetShip.data[3][this.index]=e,this.elInputStar.val(e),this.elStar.html(e),this.el.attr("data-star",e)):(this.infosFleetShip.data[3][this.index]=null,this.elInputStar.val(""),this.elStar.html(0),this.el.attr("data-star",""))):(this.infosFleetShip.data[3][this.index]=null,this.el.removeAttr("data-star")),this.infosFleetShip.infosFleetSubFleet.summaryCalc(),this.save()}},{key:"rank",get:function(){return this.infosFleetShip.data[4][this.index]},set:function(e){this.id&&$.inArray(_g.data.items[this.id].type,_g.data.item_type_collections[3].types)>-1?(e=parseInt(e)||null,e>7&&(e=7),
0>e&&(e=0),e?(this.infosFleetShip.data[4][this.index]=e,this.el.attr("data-rank",e)):(this.infosFleetShip.data[4][this.index]=null,this.el.attr("data-rank",""))):(this.infosFleetShip.data[4][this.index]=null,this.el.removeAttr("data-rank")),this.infosFleetShip.infosFleetSubFleet.summaryCalc(),this.save()}},{key:"carry",set:function(e){"undefined"==typeof e?(this.el.removeAttr("data-carry"),this.elCarry.html(0)):(e=parseInt(e)||0,this.el.attr("data-carry",e),this.elCarry.html(e))}},{key:"improvable",set:function(e){e?(this.el.attr("data-star",""),this.elInputStar.prop("disabled",!1).attr("placeholder","0"),this._improvable=!0):(this.el.removeAttr("data-star"),this.elInputStar.prop("disabled",!0).attr("placeholder","--"),this._improvable=!1)}}]),e}();_frame.app_main.is_mode_selection=function(){return $html.hasClass("mode-selection")||_frame.dom.layout.hasClass("mode-selection")},_frame.app_main.mode_selection_callback=null,_frame.app_main.mode_selection_on=function(e){_frame.dom.navSelectionInfo||(_frame.dom.navSelectionInfo=$('<div class="selection-info"/>').html("请选择……").appendTo(_frame.dom.nav)),e=e||function(){},e(),_frame.dom.layout.addClass("mode-selection")},_frame.app_main.mode_selection_off=function(){_frame.app_main.cur_page&&_frame.app_main.page_dom[_frame.app_main.cur_page].trigger("modeSelectionExit"),_frame.dom.layout.removeClass("mode-selection")},"undefined"!=typeof _p.tip&&(_p.tip.filters.push(function(e){var t=/^\[\[EQUIPMENT\:\:([0-9]+)\]\]$/.exec(e);return t&&t.length>1?_p.tip.content_equipment(_g.data.items[parseInt(t[1])]):void 0}),_p.tip.content_equipment=function(e){function t(t,a){if(!e.stat[t])return"";switch(t){case"range":return"<span>射程: "+_g.getStatRange(e.stat[t])+"</span>";default:var i=parseInt(e.stat[t]);return"<span>"+(i>0?"+":"")+i+" "+a+"</span>"}}var a="assets/images/itemicon/"+e.getIconId()+".png",i=e.getName(),n='<h3 class="itemstat"><s style="background-image: url('+a+')"></s><strong data-content="'+i+'">'+i+"</strong><small>"+_g.data.item_types[e.type].name.zh_cn+"</small></h3>"+t("fire","火力")+t("torpedo","雷装")+t("aa","对空")+t("asw","对潜")+t("bomb","爆装")+t("hit","命中")+t("armor","装甲")+t("evasion","回避")+t("los","索敌")+t("range","射程");return n}),"undefined"!=typeof _p.tip&&(_p.tip.filters.push(function(e){var t=/^\[\[SHIP\:\:([0-9]+)\]\]$/.exec(e);return t&&t.length>1?_p.tip.content_ship(_g.data.ships[parseInt(t[1])]):void 0}),_p.tip.content_ship=function(e){var t=e.getName(_g.joint),a='<h3 class="shipinfo"><img src="'+_g.path.pics.ships+"/"+e.id+'/0.webp" width="160" height="40"/><strong data-content="'+t+'">'+t+"</strong>"+(e.type?"<small>"+_g.data.ship_types[e.type].full_zh+"</span>":"")+"</h3>";return a}),_p.el.tablelist={init_el:function(e){return e.data("tablelist")?!0:void(e.hasClass("ships")?e.data({tablelist:new TablelistShips(e)}):e.hasClass("tablelist-equipments")?e.data({tablelist:new TablelistEquipments(e)}):e.hasClass("fleets")?e.data({tablelist:new TablelistFleets(e)}):e.hasClass("entities")&&e.data({tablelist:new TablelistEntities(e)}))},init:function(e,t){e=e||$body,t=t||e.find(".tablelist"),t.each(function(){_p.el.tablelist.init_el($(this))})}};var Tablelist=function(){function e(t,a){_classCallCheck(this,e),this.dom={container:t},a=a||{},this._index=e.index++,this.trIndex=0,this.flexgrid_empty_count=a.flexgrid_empty_count||8,this.sort_data_by_stat=a.sort_data_by_stat||{},this.sort_default_order_by_stat=a.sort_default_order_by_stat||{}}return _createClass(e,[{key:"append_option",value:function(t,a,i,n,o,r){function s(){var i=void 0,o=void 0,s=void 0,l=e.genId();switch(t){case"text":case"number":case"hidden":i=$('<input type="'+t+'" name="'+a+'" id="'+l+'" />').val(n);break;case"select":i=$('<select name="'+a+'" id="'+l+'" />'),o=$('<option value=""/>').html("").appendTo(i),n.forEach(function(e,t){s="object"==("undefined"==typeof e?"undefined":_typeof(e))?$('<option value="'+("undefined"==typeof e.val?e.value:e.val)+'"/>').html(e.title||e.name).appendTo(i):$('<option value="'+e+'"/>').html(e).appendTo(i),"undefined"!=typeof r["default"]&&s.val()==r["default"]&&s.prop("selected",!0)}),n&&n.length||(o.remove(),$('<option value=""/>').html("...").appendTo(i)),r["new"]&&($('<option value=""/>').html("==========").insertAfter(o),$('<option value="___new___"/>').html("+ 新建").insertAfter(o),i.on("change.___new___",function(){var e=$(this);"___new___"==e.val()&&(e.val(""),r["new"](i))}));break;case"checkbox":i=$('<input type="'+t+'" name="'+a+'" id="'+l+'" />').prop("checked",n);break;case"radio":i=$(),n.forEach(function(e,t){var o,s,d=!1;n[t].push?(s=n[t][0],o=n[t][1]):(s=n[t].val||n[t].value,o=n[t].title||n[t].name),r.radio_default&&r.radio_default==s&&(d=!0),i=i.add($('<input type="radio" name="'+a+'" id="'+l+"-"+s+'" ischecked="'+d+'" />').val(s).prop("checked",d||!d&&0==t)),i=i.add($('<label for="'+l+"-"+s+'"/>').html(o))})}return r.required&&i.prop("required",!0),r.onchange&&(i.on("change.___onchange___",function(e){r.onchange(e,$(this))}),r["default"]&&i.trigger("change")),a||i.attr("name",null),i}r=r||{};var l=$("<p/>").addClass(a).appendTo(this.dom.filters),d=s().appendTo(l),p=d.attr("id")||e.genId();return i=i?$('<label for="'+p+'"/>').html(i).appendTo(l):null,"checkbox"==t&&i&&i.insertAfter(d),o&&$('<label for="'+p+'"/>').html(o).appendTo(l),l}},{key:"thead_redraw",value:function(e){if(this.dom.thead&&this.dom.thead.length){var t=this.dom.thead;setTimeout(function(){t.hide().show(0)},e||10)}}},{key:"sort_column",value:function(e,t,a){if(!a){var i=this.dom.tbody;i&&i.length||(i=this.dom.table.find("tbody")),a=i.find("tr.row:visible").not("[data-donotcompare]")}e=e||1,this._tmp_values=[],this._tmp_value_map_cell={},a.find("td:nth-of-type("+e+")").each(function(e,t){var a=$(t),i=a.data("value");i=parseFloat(i),$.inArray(i,this._tmp_values)<0&&this._tmp_values.push(i),this._tmp_value_map_cell[i]||(this._tmp_value_map_cell[i]=$()),this._tmp_value_map_cell[i]=this._tmp_value_map_cell[i].add(a)}.bind(this)),this._tmp_values.sort(function(e,a){return t?e-a:a-e});var n=[];return this._tmp_values.forEach(function(e){n.push(this._tmp_value_map_cell[e])},this),delete this._tmp_values,delete this._tmp_value_map_cell,n}},{key:"mark_high",value:function(e){var t=this.dom.tbody;t&&t.length||(t=this.dom.table.find("tbody"));var a=t.find("tr.row:visible").not("[data-donotcompare]");return a.find("td[data-value]").removeClass("sort-first sort-second"),a.eq(0).find("td[data-value]").each(function(t,i){var n=!1,o=$(i),r=o.data("stat"),s=r.match(/\b(speed|range|extra_illust)\b/);"undefined"==typeof this.sort_default_order_by_stat[r]?(r.match(/\b(consum_fuel|consum_ammo)\b/)&&(n=!0),this.sort_default_order_by_stat[r]=n?"asc":"desc"):n="asc"==this.sort_default_order_by_stat[r]?!0:!1;var l=this.sort_column(t+1,n,a),d=Math.min(6,Math.ceil(a.length/2)+1);!s&&l.length>1&&l[0].length<d&&(l[0].addClass("sort-first"),l.length>2&&l[1].length<d&&l[1].addClass("sort-second")),e?this.sort_data_by_stat[r]=l:delete this.sort_data_by_stat[r]}.bind(this)),a}},{key:"sort_table_from_theadcell",value:function(e){if(e){var t=e.data("stat"),a=this.sort_data_by_stat[t];if(console.log(t,a),!t||!a)return!1;t!=this.lastSortedStat&&(this.lastSortedHeader&&this.lastSortedHeader.removeClass("sorting desc asc"),e.addClass("sorting"));var i=t==this.lastSortedStat&&"obverse"==this.lastSortedOrder?"reverse":"obverse",n="reverse"==i?a.length-1:0;if(this.sort_default_order_by_stat[t]){var o="asc"==this.sort_default_order_by_stat[t]?"desc":"asc";"obverse"==i?e.removeClass(o).addClass(this.sort_default_order_by_stat[t]):e.removeClass(this.sort_default_order_by_stat[t]).addClass(o)}for(this.sortedRow=$();a[n];)this._tmpDOM=a[n].parent(),this.sortedRow=this.sortedRow.add(this._tmpDOM),this._tmpDOM.appendTo(this.dom.tbody),n="reverse"==i?n-1:n+1;this.dom.btn_compare_sort.removeClass("disabled").html("取消排序"),this.lastSortedStat=t,this.lastSortedOrder=i,this.lastSortedHeader=e,delete this._tmpDOM}}},{key:"sort_table_restore",value:function(){if(!this.sortedRow)return!0;var e=void 0,t=[];return this.sortedRow.each(function(a,i){var n=$(i),o=parseInt(n.data("trindex"));e=e||n.parent(),t.push({index:o,el:n,prev:e.children('tr[data-trindex="'+(o-1)+'"]')})}),t.sort(function(e,t){return e.index-t.index}),t.forEach(function(e){e.el.insertAfter(e.prev)}),this.dom.btn_compare_sort.addClass("disabled").html("点击表格标题可排序"),this.lastSortedHeader.removeClass("sorting desc asc"),delete this.sortedRow,delete this.lastSortedStat,delete this.lastSortedOrder,delete this.lastSortedHeader,!0}}]),e}();Tablelist.index=0,Tablelist.genId=function(e){var t,a,i,n=0;if(e=e||(new Date).toISOString()+_g.randInt(1e4),0==e.length)return n;for(t=0,i=e.length;i>t;t++)a=e.charCodeAt(t),n=(n<<5)-n+a,n|=0;return"tablelist"+n};var TablelistEntities=function(e){function t(e,a){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,a));return _frame.app_main.loading.push("tablelist_"+i._index),_frame.app_main.is_loaded=!1,e.children(".tablelist-list").length?i.init_parse():i.init_new&&i.init_new(a),i}return _inherits(t,e),_createClass(t,[{key:"init_parse",value:function(){this.generated=!0,_frame.app_main.loaded("tablelist_"+this._index,!0)}}]),t}(Tablelist),TablelistEquipments=function(e){function t(e,a){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,a));return i.columns=["  ",["火力","fire"],["雷装","torpedo"],["对空","aa"],["对潜","asw"],["爆装","bomb"],["命中","hit"],["装甲","armor"],["回避","evasion"],["索敌","los"],["射程","range"],["可改修","improvable"]],_frame.app_main.loading.push("tablelist_"+i._index),_frame.app_main.is_loaded=!1,e.children(".fixed-table-container").length?i.init_parse():i.init_new&&i.init_new(),i}return _inherits(t,e),_createClass(t,[{key:"apply_types",value:function(){console.log("types: "+t.types),this.dom.filter_types.removeAttr("class"),t.types.length&&(this.dom.filter_types.addClass("type"+t.types.join(" type")),this.generated&&this.apply_types_check())}},{key:"apply_types_check",value:function(){if(!t.shipIdLast||t.shipIdLast!=t.shipId){if(t.shipIdLast=t.shipId,t.shipId&&$.inArray(_g.data.ships[t.shipId].type,[9,10,11])>-1){for(var e=0,a=void 0;3!=this.dom.types[e++].attr("data-equipmentcollection")||$.inArray(parseInt(this.dom.types[e].attr("data-type"))||null,t.types)<=-1;)a=this.dom.types[e+1];return a=a||this.dom.types[0],this.dom.type_radios[3].prop("checked",!0).trigger("change"),void this.dom.table_container_inner.scrollTop(a[0].offsetTop||0)}if(t.types.length){for(var e=0,i=void 0;$.inArray(parseInt(this.dom.types[e++].attr("data-type"))||null,t.types)<=-1;)i=this.dom.types[e];i=i||this.dom.types[0],this.dom.type_radios[parseInt(i.attr("data-equipmentcollection"))||1].prop("checked",!0).trigger("change"),this.dom.table_container_inner.scrollTop(i[0].offsetTop||0)}}}},{key:"init_parse",value:function(){this.dom.filter_container=this.dom.container.children(".options"),this.dom.filters=this.dom.filter_container.children(".filters"),this.dom.type_radios={},this.dom.container.children('input[type="radio"][name="equipmentcollection"]').each(function(e,t){t=$(t);var a=parseInt(t.val());this.dom.type_radios[a]=t.prop("checked",1==a).on("change",function(){this.dom.table_container_inner.scrollTop(0),this.thead_redraw()}.bind(this))}.bind(this)),this.dom.filter_types=this.dom.container.children('input[name="types"][type="hidden"]'),this.dom.table_container=this.dom.container.children(".fixed-table-container"),this.dom.table_container_inner=this.dom.table_container.children(".fixed-table-container-inner"),this.dom.table=this.dom.table_container_inner.children(".equipments.hashover.hashover-column"),this.dom.thead=this.dom.table.children("thead"),this.dom.tbody=this.dom.table.children("tbody"),this.parse_all_items(),this.dom.msg_container=this.dom.container.children(".msgs"),_config.get("hide-equipmentsinfos")?this.dom.msg_container.removeAttr("data-msgs"):this.dom.msg_container.attr("data-msgs","equipmentsinfos");var e=this.dom.msg_container.children(".equipmentsinfos");e.children("button").on("click",function(){this.dom.msg_container.removeAttr("data-msgs"),_config.set("hide-equipmentsinfos",!0)}.bind(this))}},{key:"parse_all_items",value:function(){this.generated=!1,this.dom.types=[];var e=-1;this.dom.tbody.children("tr.typetitle,tr.row").each(function(a,i){i=$(i),i.hasClass("typetitle")?(e++,this.dom.types[e]=i):!function(){var e=parseInt(i.attr("data-equipmenttype"))||-1,a=i.attr("data-equipmentid");i.on("click",function(i,n){!n&&_frame.app_main.is_mode_selection()&&(i.preventDefault(),i.stopImmediatePropagation(),i.stopPropagation(),$.inArray(e,t.types)>-1&&_frame.app_main.mode_selection_callback(a))})}()}.bind(this)),this.thead_redraw(),this.generated=!0,this.apply_types_check(),_frame.app_main.loaded("tablelist_"+this._index,!0)}}]),t}(Tablelist);TablelistEquipments.gen_helper_equipable_on=function(e){var t="";return _g.data.item_types[e].equipable_on_type.forEach(function(a,i){var n=_g.data.item_types[e].equipable_on_type[i];t+="<span>"+_g.data.ship_types[n].full_zh+(i<_g.data.item_types[e].equipable_on_type.length-1?",&nbsp;":"")+"</span>"}),'<em class="helper" data-tip="<h4 class=item_equipable_on>可装备于</h4>'+t+'">?</em>'},TablelistEquipments.types=[],TablelistEquipments.shipId=null,TablelistEquipments.shipIdLast=null;var TablelistFleets=function(e){function t(e,a){function i(e){this.dom.thead=$("<thead/>");var t=$("<tr/>").appendTo(this.dom.thead);return e.forEach(function(e){"object"==("undefined"==typeof e?"undefined":_typeof(e))?$('<td data-stat="'+e[1]+'"/>').html('<div class="th-inner-wrapper"><span><span>'+e[0]+"</span></span></div>").appendTo(t):$("<th/>").html('<div class="th-inner-wrapper"><span><span>'+e[0]+"</span></span></div>").appendTo(t)}),this.dom.thead}_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,a));return n.columns=["  ",["创建者","user"],["修改时间","time_modify"],["评价","rating"],["","options"]],n.kancolle_calc={_ApplicationId:"l1aps8iaIfcq2ZzhOHJWNUU2XrNySIzRahodijXW",_ClientVersion:"js1.2.19",_InstallationId:"62522018-ec82-b434-f5a5-08c3ab61d932",_JavaScriptKey:"xOrFpWEQZFxUDK2fN1DwbKoj3zTKAEkgJHzwTuZ4"},_frame.app_main.loading.push("tablelist_"+n._index),_frame.app_main.is_loaded=!1,n.dom.filter_container=$('<div class="options" viewtype="card"/>').appendTo(n.dom.container),n.dom.filters=$('<div class="filters"/>').appendTo(n.dom.filter_container),n.dom.btn_new=$('<button class="new" icon="import"/>').html("新建/导入").on("click",function(){this.btn_new()}.bind(n)).appendTo(n.dom.filters),n.dom.btn_exportFile=$('<button class="export" icon="floppy-disk"/>').html("导出配置文件").on("click",function(){_db.fleets.persistence.compactDatafile(),_g.file_save_as(_db.fleets.filename,"fleets.json")}).appendTo(n.dom.filters),n.dom.buttons_right=$('<div class="buttons_right"/>').appendTo(n.dom.filters),n.dom.setting_hqlv=$("<label/>",{"class":"setting setting-hqlv",html:"默认司令部等级","data-tip":"如果舰队配置没有设置司令部等级，<br/>则会使用该默认数值"}).append(n.dom.setting_hqlv_input=$("<input/>",{type:"number",min:0,max:150}).val(Lockr.get("hqLvDefault",_g.defaultHqLv)).on({input:function(){_g.updateDefaultHqLv(this.dom.setting_hqlv_input.val())}.bind(n),focus:function(){this.dom.setting_hqlv_input.trigger("tipshow")}.bind(n),blur:function(){this.dom.setting_hqlv_input.trigger("tiphide")}.bind(n),click:function(e){e.stopImmediatePropagation(),e.stopPropagation()}})).appendTo(n.dom.buttons_right),$body.on("update_defaultHqLv.update_fleets_hqlv_input",function(e,t){this.dom.setting_hqlv_input.val(t)}.bind(n)),n.dom.btn_settings=$('<button icon="cog"/>').on("click",function(){this.btn_settings()}.bind(n)).appendTo(n.dom.buttons_right),n.dom.table_container=$('<div class="fixed-table-container"/>').appendTo(n.dom.container),n.dom.table_container_inner=$('<div class="fixed-table-container-inner"/>').appendTo(n.dom.table_container),n.dom.table=$('<table class="fleets hashover hashover-column"/>').appendTo(n.dom.table_container_inner),i=i.bind(n),i(n.columns).appendTo(n.dom.table),n.dom.tbody=$("<tbody/>").appendTo(n.dom.table),$('<div class="nocontent container"/>').append($($("<div/>").append($("<span>").html("暂无舰队配置")).append($("<button>").html("新建/导入").on("click",function(){this.dom.btn_new.click()}.bind(n))))).appendTo(n.dom.table_container_inner),n.dom.table.on("contextmenu.contextmenu_fleet","tr[data-fleetid]",function(e){this.contextmenu_show($(e.currentTarget),null,e)}.bind(n)).on("click.contextmenu_fleet","tr[data-fleetid]>th>em",function(e){this.contextmenu_show($(e.currentTarget).parent().parent(),$(e.currentTarget)),e.stopImmediatePropagation(),e.stopPropagation()}.bind(n)),n.genlist(),n}return _inherits(t,e),_createClass(t,[{key:"new_data",value:function(e){return $.extend({data:[],time_create:(new Date).valueOf(),time_modify:(new Date).valueOf(),hq_lv:-1,name:"",note:"",user:{},rating:-1,theme:_g.randNumber(10)},e||{})}},{key:"loaddata",value:function(){var e=Q.defer();return _db.fleets.find({}).sort({name:1}).exec(function(t,a){t?e.resolve([]):e.resolve(a)}),e.promise}},{key:"validdata",value:function(e){for(var t=Q.defer(),a=[],i=0,n=function(e){if(e.hq_lv>-1||e.name||e.note||e.rating>-1)return!0;if(!e.data||!e.data.length||!e.data.push)return!1;var t=!0,a=!1,i=void 0;try{for(var n,o=e.data[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;if(!r||!r.length||!r.push)return!1;var s=!0,l=!1,d=void 0;try{for(var p,m=r[Symbol.iterator]();!(s=(p=m.next()).done);s=!0){var u=p.value;if("undefined"!=typeof u&&"undefined"!=typeof u[0]&&u[0])return!0}}catch(c){l=!0,d=c}finally{try{!s&&m["return"]&&m["return"]()}finally{if(l)throw d}}}}catch(c){a=!0,i=c}finally{try{!t&&o["return"]&&o["return"]()}finally{if(a)throw i}}return!1};i<e.length;)n(e[i])?i++:(a.push(e[i]._id),e.splice(i,1));return a.length?_db.fleets.remove({_id:{$in:a}},{multi:!0},function(a,i){t.resolve(e)}):t.resolve(e),t.promise}},{key:"datacheck",value:function(e){return e=e||[],e.length||this.dom.container.addClass("nocontent"),e}},{key:"append_all_items",value:function(e){var t=this;e=e||[],e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),_g.log(e),this.trIndex=0,"undefined"==typeof Lockr.get("fleetlist-option-groupbytheme")&&Lockr.set("fleetlist-option-groupbytheme",!0);var a=Q.defer(),i=0;if(Lockr.get("fleetlist-option-groupbytheme"))!function(){var n={},o=0;e.forEach(function(e,t){n[e.theme]||(n[e.theme]=[]),n[e.theme].push(t)}),console.log(n);for(var r in n){for(i=0;i<t.flexgrid_empty_count;)i?$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(t.dom.tbody):t.flexgrid_ph=$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(t.dom.tbody),i++;n[r].forEach(function(t){setTimeout(function(t){this.append_item(e[t]),o++,o>=e.length-1&&a.resolve()}.bind(this)(t),0)}.bind(t)),$('<tr class="typetitle" data-trindex="'+ ++t.trIndex+'"><th colspan="'+(t.columns.length+1)+'"></th></tr>').appendTo(t.dom.tbody),t.trIndex++}}();else{for(;i<this.flexgrid_empty_count;)i?$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(this.dom.tbody):this.flexgrid_ph=$('<tr class="empty" data-fleetid="-1" data-trindex="99999"/>').appendTo(this.dom.tbody),i++;e.forEach(function(t,i){setTimeout(function(t){this.append_item(e[t]),t>=e.length-1&&a.resolve()}.bind(this)(i),0)}.bind(this))}return e.length||a.resolve(),a.promise}},{key:"append_item",value:function(e,t,a){if(!e)return!1;"undefined"==typeof t&&(t=this.trIndex,this.trIndex++);var i=$('<tr class="row"/>').attr({"data-trindex":t,"data-fleetid":e._id||"PLACEHOLDER","data-infos":"[[FLEET::"+e._id+"]]","data-theme":e.theme}).data({initdata:e});return this.columns.forEach(function(t){switch(t[1]){case" ":for(var a="<i>",n=e.data[0]||[],o=0;6>o;)a+=n[o]&&n[o][0]?'<img src="'+_g.path.pics.ships+"/"+n[o][0]+'/0.webp" contextmenu="disabled"/>':"<s/>",o++;a+="</i>",$("<th/>").attr("data-value",e.name).html(a+"<strong>"+e.name+"</strong><em></em>").appendTo(i);break;default:var r=e[t[1]];$("<td/>").attr("data-value",r).html(r).appendTo(i)}}),a?i.prependTo(this.dom.tbody):i.insertBefore(this.flexgrid_ph),i}},{key:"btn_new",value:function(){this.menu_new||(this.menu_new=new _menu({target:this.dom.btn_new,items:[$('<div class="menu_fleets_new"/>').append($("<menuitem/>").html("新建配置").on("click",function(){this.action_new()}.bind(this))).append($("<menuitem/>").html("导入配置代码").on("click",function(){t.modalImport||(t.modalImport=$("<div/>").append(t.modalImportTextarea=$("<textarea/>",{placeholder:"输入配置代码..."})).append($("<p/>").html('* 配置代码兼容<a href="http://www.kancolle-calc.net/deckbuilder.html">艦載機厨デッキビルダー</a>')).append(t.modalImportBtn=$('<button class="button"/>').html("导入"))),t.modalImportTextarea.val(""),t.modalImportBtn.off("click.import").on("click",function(){var e=t.modalImportTextarea.val();e&&(e=JSON.parse(e),e.length&&e.push||(e=_g.kancolle_calc.decode(e)),this.action_new({data:e}),_frame.modal.hide(),t.modalImportTextarea.val(""))}.bind(this)),_frame.modal.show(t.modalImport,"导入配置代码",{classname:"infos_fleet infos_fleet_import"})}.bind(this))).append($("<menuitem/>").html("导入配置文件").on("click",function(){this.dbfile_selector.trigger("click")}.bind(this)))]}),this.dbfile_selector=$('<input type="file" class="none"/>').on("change",function(){var e=this.dbfile_selector.val(),t=Q.fcall(function(){});this.dbfile_selector.val(""),t.then(function(){var t=Q.defer();return node.fs.readFile(e,"utf8",function(e,a){e?t.reject("文件载入失败",new Error(e)):t.resolve(a)}),t.promise}).then(function(e){var t=[],a=Q.defer();return e.split("\n").forEach(function(e){if(e){try{t.push(JSON.parse(e))}catch(i){a.reject("文件格式错误",i)}a.resolve(t)}else a.reject("文件无内容")}),a.promise}).then(function(e){var t=[],a=0;return e.forEach(function(e){var i=Q.defer();t.push(i.promise),_db.fleets.insert(e,function(t){a++,t&&"uniqueViolated"==t.errorType?_db.fleets.update({_id:e._id},e,{},function(e,t){i.resolve(),e?_g.log(e):_g.log(t)}):i.resolve()})}),Q.all(t)})["catch"](function(e,t){_g.log(e),_g.error(t)}).done(function(){_g.log("import complete"),this.refresh()}.bind(this))}.bind(this)).appendTo(this.dom.filters)),this.menu_new.show()}},{key:"btn_settings",value:function(){t.menuOptions_show(this.dom.btn_settings,this)}},{key:"action_new",value:function(e){e=e||{},console.log(e),_db.fleets.insert(this.new_data(e),function(e,t){console.log(e,t),e?_g.error(e):"fleets"==_frame.app_main.cur_page&&(_frame.infos.show("[[FLEET::"+t._id+"]]"),this.menu_new.hide())}.bind(this))}},{key:"parse_kancolle_calc_data",value:function(e){return this.new_data(e)}},{key:"contextmenu_show",value:function(e,a,i){t.contextmenu||(t.contextmenu=new _menu({className:"contextmenu-fleet",items:[$("<menuitem/>").html("详情").on({click:function(e){t.contextmenu.curel.trigger("click",[!0])}}),$("<menuitem/>").html("导出配置代码").on({click:function(e){InfosFleet.modalExport_show(t.contextmenu.curel.data("initdata"))}}),$("<menuitem/>").html("导出配置文本").on({click:function(e){InfosFleet.modalExportText_show(t.contextmenu.curel.data("initdata"))}}),$("<menuitem/>").html("移除").on({click:function(e){var a=t.contextmenu.curel.attr("data-fleetid");_db.fleets.remove({_id:a},{multi:!0},function(e,t){_g.log("Fleet "+a+" removed.")}),t.contextmenu.curel.remove()}})]})),t.contextmenu.curel=e,i?t.contextmenu.show(i.clientX,i.clientY):t.contextmenu.show(a||e)}},{key:"genlist",value:function(){var e=Q.fcall(function(){});e.then(function(){return this.loaddata()}.bind(this)).then(function(e){return this.validdata(e)}.bind(this)).then(function(e){return this.datacheck(e)}.bind(this)).then(function(e){return this.append_all_items(e)}.bind(this)).then(function(){setTimeout(function(){_frame.app_main.loaded("tablelist_"+this._index,!0)}.bind(this),100)}.bind(this))["catch"](function(e){_g.log(e)}).done(function(){_g.log("Fleets list DONE")})}},{key:"refresh",value:function(){this.dom.tbody.empty(),this.genlist()}}]),t}(Tablelist);TablelistFleets.menuOptions_show=function(e,t){TablelistFleets.menuOptions||(TablelistFleets.menuOptions=new _menu({className:"mod-checkbox menu-tablelistfleets-options",items:[$('<menuitem class="donot_hide option-groupbytheme"/>').append($("<input/>",{type:"checkbox",id:"_input_g"+_g.inputIndex}).prop("checked",Lockr.get("fleetlist-option-groupbytheme")).on("change",function(e){Lockr.set("fleetlist-option-groupbytheme",e.target.checked),TablelistFleets.menuOptions.curTablelist&&(TablelistFleets.menuOptions.curTablelist.dom.tbody.empty(),TablelistFleets.menuOptions.curTablelist.genlist())})).append($("<label/>",{"for":"_input_g"+_g.inputIndex++,html:"按主题颜色进行分组"})),$('<menuitem class="donot_hide option-aircraftdefaultmax"/>').append($("<input/>",{type:"checkbox",id:"_input_g"+_g.inputIndex}).prop("checked",Lockr.get("fleetlist-option-aircraftdefaultmax")).on("change",function(e){Lockr.set("fleetlist-option-aircraftdefaultmax",e.target.checked)})).append($("<label/>",{"for":"_input_g"+_g.inputIndex++,html:"新增飞行器熟练度默认为"}))]})),TablelistFleets.menuOptions.curTablelist=t||null,t?TablelistFleets.menuOptions.dom.menu.addClass("is-tablelist"):TablelistFleets.menuOptions.dom.menu.removeClass("is-tablelist"),TablelistFleets.menuOptions.show(e)};var TablelistShips=function(e){function t(e,a){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,a));return i.columns=["  ",["火力","fire"],["雷装","torpedo"],["夜战","nightpower"],["对空","aa"],["对潜","asw"],["耐久","hp"],["装甲","armor"],["回避","evasion"],["搭载","carry"],["航速","speed"],["射程","range"],["索敌","los"],["运","luck"],["油耗","consum_fuel"],["弹耗","consum_ammo"],["多立绘","extra_illust"]],i.header_checkbox=[],i.checkbox=[],i.last_item=null,_frame.app_main.loading.push("tablelist_"+i._index),_frame.app_main.is_loaded=!1,e.children(".fixed-table-container").length?i.init_parse():i.init_new&&i.init_new(),i}return _inherits(t,e),_createClass(t,[{key:"compare_btn_show",value:function(e){!e&&this.dom.tbody.find('input[type="checkbox"].compare:checked').length||e?this.dom.msg_container.attr("data-msgs","comparestart"):this.dom.msg_container.removeAttr("data-msgs")}},{key:"compare_start",value:function(){this.dom.msg_container.removeAttr("data-msgs"),this.last_viewtype=this.dom.filter_container.attr("viewtype"),_config.set("shiplist-viewtype",this.last_viewtype),this.last_scrollTop=this.dom.table_container_inner.scrollTop(),this.dom.filter_container.attr("viewtype","compare"),this.dom.table_container_inner.scrollTop(0),this.dom.table.addClass("sortable"),this.mark_high(!0),this.thead_redraw(500)}},{key:"compare_off",value:function(){this.dom.filter_container.attr("viewtype",this.last_viewtype),this.sort_table_restore(),this.mark_high(),this.thead_redraw(500),this.dom.table_container_inner.scrollTop(this.last_scrollTop),this.dom.table.removeClass("sortable"),delete this.last_viewtype,delete this.last_scrollTop}},{key:"compare_end",value:function(){this.dom.tbody.find('input[type="checkbox"].compare:checked').prop("checked",!1).trigger("change"),this.dom.msg_container.removeAttr("data-msgs"),this.compare_off()}},{key:"compare_continue",value:function(){this.dom.msg_container.attr("data-msgs","comparestart"),this.compare_off()}},{key:"contextmenu_show",value:function(e,a,i){return"compare"==this.dom.filter_container.attr("viewtype")||"true"==e.attr("data-donotcompare")?!1:(t.contextmenu||(t.contextmenu=new _menu({className:"contextmenu-ship",items:[$("<menuitem/>").html("选择").on({click:function(e){_frame.app_main.is_mode_selection()&&_frame.app_main.mode_selection_callback(t.contextmenu._curid)},show:function(){_frame.app_main.is_mode_selection()?$(this).show():$(this).hide()}}),$("<menuitem/>").html("查看资料").on({click:function(e){t.contextmenu._curel.trigger("click",[!0])}}),$("<menuitem/>").html("将该舰娘加入对比").on({click:function(e){this.checkbox[t.contextmenu._curid].prop("checked",!this.checkbox[t.contextmenu._curid].prop("checked")).trigger("change")}.bind(this),show:function(e){return t.contextmenu._curid?(_g.data.ship_types[_g.data.ships[t.contextmenu._curid].type].donotcompare?$(e.target).hide():$(e.target).show(),void(this.checkbox[t.contextmenu._curid].prop("checked")?$(e.target).html("取消对比"):$(e.target).html("将该舰娘加入对比"))):!1}.bind(this)}),$("<div/>").on("show",function(e){var a=$(e.target).empty();if(t.contextmenu._curid){var i=_g.data.ships[t.contextmenu._curid].getSeriesData()||[];i.forEach(function(e,t){t||a.append($("<hr/>"));var i=null;try{i=this.checkbox[e.id]}catch(n){}a.append($('<div class="item"/>').html("<span>"+_g.data.ships[e.id].getName(!0)+"</span>").append($('<div class="group"/>').append(function(){var t=$();return _frame.app_main.is_mode_selection()&&(t=t.add($("<menuitem/>").html("选择").on({click:function(){_frame.app_main.is_mode_selection()&&_frame.app_main.mode_selection_callback(e.id)}}))),t}).append($('<menuitem data-infos="[[SHIP::'+e.id+']]"/>').html("查看资料")).append($("<menuitem/>").html(i&&i.prop("checked")?"取消对比":"加入对比").on({click:function(t){i&&this.checkbox[e.id].prop("checked",!i.prop("checked")).trigger("change")}.bind(this)}))))},this)}}.bind(this))]})),t.contextmenu._curid=a||e.data("shipid"),t.contextmenu._curel=e,void(i?t.contextmenu.show(i.clientX,i.clientY):t.contextmenu.show(e)))}},{key:"init_parse",value:function(){this.dom.filter_container=this.dom.container.children(".options"),this.dom.filters=this.dom.filter_container.children(".filters"),this.dom.exit_compare=this.dom.filter_container.children(".exit_compare"),this.dom.exit_compare.children('button[icon="arrow-set2-left"]').on("click",function(){this.compare_end()}.bind(this)),this.dom.exit_compare.children('button[icon="checkbox-checked"]').on("click",function(){this.compare_continue()}.bind(this)),this.dom.btn_compare_sort=this.dom.exit_compare.children('button[icon="sort-amount-desc"]').on("click",function(){this.dom.btn_compare_sort.hasClass("disabled")||this.sort_table_restore()}.bind(this)),this.dom.btn_hide_premodel=this.dom.filters.find('[name="hide-premodel"]').prop("checked","false"===_config.get("shiplist-filter-hide-premodel")?null:!0).on("change",function(e){_config.set("shiplist-filter-hide-premodel",this.dom.btn_hide_premodel.prop("checked")),this.dom.filter_container.attr("filter-hide-premodel",this.dom.btn_hide_premodel.prop("checked")),this.thead_redraw()}.bind(this)),this.dom.filters.find('[name="viewtype"]').each(function(e,t){t=$(t);var a=_config.get("shiplist-viewtype")||"card";t.val()==a&&t.prop("checked",!0),t.on("change",function(e){t.is(":checked")&&(_config.set("shiplist-viewtype",t.val()),this.dom.filter_container.attr("viewtype",t.val()),this.thead_redraw())}.bind(this))}.bind(this)),this.dom.filters.find("input").trigger("change"),this.dom.table_container=this.dom.container.children(".fixed-table-container"),this.dom.table_container_inner=this.dom.table_container.children(".fixed-table-container-inner"),this.dom.table=this.dom.table_container_inner.children("table.ships"),this.dom.table.find("thead td").on("click",function(e){this.sort_table_from_theadcell($(e.currentTarget))}.bind(this)),this.dom.tbody=this.dom.table.children("tbody"),this.dom.table.on("contextmenu.contextmenu_ship","tr[data-shipid]",function(e){this.contextmenu_show($(e.currentTarget),null,e),e.preventDefault()}.bind(this)).on("click.contextmenu_ship","tr[data-shipid]>th>em",function(e){this.contextmenu_show($(e.currentTarget).parent().parent()),e.stopImmediatePropagation(),e.stopPropagation()}.bind(this)),this.dom.msg_container=this.dom.container.children(".msgs"),_config.get("hide-compareinfos")?this.dom.msg_container.removeAttr("data-msgs"):this.dom.msg_container.attr("data-msgs","compareinfos"),this.parse_all_items();var e=this.dom.msg_container.children(".compareinfos");e.children("button").on("click",function(){this.dom.msg_container.removeAttr("data-msgs"),_config.set("hide-compareinfos",!0)}.bind(this)),this.dom.msg_container.children(".comparestart").on("click",function(){this.compare_start()}.bind(this))}},{key:"parse_all_items",
value:function(){var e=-1;this.dom.tbody.children("tr.typetitle,tr.row").each(function(t,a){var i=this;a=$(a),a.hasClass("typetitle")?!function(){e++,i.last_item=a;var t=a.find('input[type="checkbox"]').on({change:function(){t.data("ships").filter(":visible").each(function(e,a){$(a).data("checkbox").prop("checked",t.prop("checked")).trigger("change",[!0])})},docheck:function(){var e=t.data("ships").filter(":visible"),a=e.filter("[compare-checked=true]");a.length?a.length<e.length?t.prop({checked:!1,indeterminate:!0}):t.prop({checked:!0,indeterminate:!1}):t.prop({checked:!1,indeterminate:!1})}}).data("ships",$());i.header_checkbox[e]=t}():!function(){var t=a.attr("data-donotcompare"),n=a.attr("data-shipid"),o=a.find('input[type="checkbox"]'),r=e;a.on("click",function(e,a){!a&&"em"!=e.target.tagName.toLowerCase()&&_frame.app_main.is_mode_selection()&&(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),t||_frame.app_main.mode_selection_callback(n))}),o.prop("disabled",t).on("click change",function(e,t){e.stopImmediatePropagation(),e.stopPropagation(),o.prop("checked")?a.attr("compare-checked",!0):a.removeAttr("compare-checked"),this.compare_btn_show(o.prop("checked")),t||this.header_checkbox[r].trigger("docheck")}.bind(i)),i.header_checkbox[r].data("ships",i.header_checkbox[r].data("ships").add(a)),a.data("checkbox",o),i.checkbox[n]=o}()}.bind(this)),this.mark_high(),this.thead_redraw(),_frame.app_main.loaded("tablelist_"+this._index,!0),delete this.last_item}}]),t}(Tablelist);